var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function t(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}var r=t,i=n;function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===t||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}"function"==typeof e.setTimeout&&(r=setTimeout),"function"==typeof e.clearTimeout&&(i=clearTimeout);var s,a=[],u=!1,c=-1;function l(){u&&s&&(u=!1,s.length?a=s.concat(a):c=-1,a.length&&f())}function f(){if(!u){var e=o(l);u=!0;for(var t=a.length;t;){for(s=a,a=[];++c<t;)s&&s[c].run();c=-1,t=a.length}s=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===n||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}h.prototype.run=function(){this.fun.apply(null,this.array)};function d(){}var p=d,g=d,v=d,y=d,m=d,b=d,w=d;var _=e.performance||{},C=_.now||_.mozNow||_.msNow||_.oNow||_.webkitNow||function(){return(new Date).getTime()};var k=new Date;var A={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new h(e,t)),1!==a.length||u||o(f)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:p,addListener:g,once:v,off:y,removeListener:m,removeAllListeners:b,emit:w,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*C.call(_),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-k)/1e3}},E=!0,O=function(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}};var S="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function x(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function I(e,t){return e(t={exports:{}},t.exports),t.exports}var T,B,P=S.MutationObserver||S.WebKitMutationObserver;if(P){var j=0,R=new P(L),D=S.document.createTextNode("");R.observe(D,{characterData:!0}),T=function(){D.data=j=++j%2}}else if(S.setImmediate||void 0===S.MessageChannel)T="document"in S&&"onreadystatechange"in S.document.createElement("script")?function(){var e=S.document.createElement("script");e.onreadystatechange=function(){L(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},S.document.documentElement.appendChild(e)}:function(){setTimeout(L,0)};else{var q=new S.MessageChannel;q.port1.onmessage=L,T=function(){q.port2.postMessage(0)}}var F=[];function L(){var e,t;B=!0;for(var n=F.length;n;){for(t=F,F=[],e=-1;++e<n;)t[e]();n=F.length}B=!1}var N=function(e){1!==F.push(e)||B||T()};function M(){}function U(){U.init.call(this)}function $(e){return void 0===e._maxListeners?U.defaultMaxListeners:e._maxListeners}function z(e,t,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]):(o=e._events=new M,e._eventsCount=0),s){if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=$(e))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,console.warn}}else s=o[t]=n,++e._eventsCount;return e}function J(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function H(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function V(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}M.prototype=Object.create(null),U.EventEmitter=U,U.usingDomains=!1,U.prototype.domain=void 0,U.prototype._events=void 0,U.prototype._maxListeners=void 0,U.defaultMaxListeners=10,U.init=function(){this.domain=null,U.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new M,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},U.prototype.getMaxListeners=function(){return $(this)},U.prototype.emit=function(e){var t,n,r,i,o,s,a,u="error"===e;if(s=this._events)u=u&&null==s.error;else if(!u)return!1;if(a=this.domain,u){if(t=arguments[1],!a){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(n=s[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=V(e,r),o=0;o<r;++o)i[o].call(n)}(n,l,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=V(e,i),s=0;s<i;++s)o[s].call(n,r)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,s=V(e,o),a=0;a<o;++a)s[a].call(n,r,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var s=e.length,a=V(e,s),u=0;u<s;++u)a[u].call(n,r,i,o)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=V(e,i),s=0;s<i;++s)o[s].apply(n,r)}(n,l,this,i)}return!0},U.prototype.addListener=function(e,t){return z(this,e,t,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(e,t){return z(this,e,t,!0)},U.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,J(this,e,t)),this},U.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,J(this,e,t)),this},U.prototype.removeListener=function(e,t){var n,r,i,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new M:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new M,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,s||t)}return this},U.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new M,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new M:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new M,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},U.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},U.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):H.call(e,t)},U.prototype.listenerCount=H,U.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};for(var W=I(function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),K=I(function(e,t){e.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];n+=(r&i|~r&o)+t[0]-680876936|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[1]-389564586|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[2]+606105819|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[3]-1044525330|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[4]-176418897|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[5]+1200080426|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[6]-1473231341|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[7]-45705983|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[8]+1770035416|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[9]-1958414417|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[10]-42063|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[11]-1990404162|0,n+=((r=(r<<22|r>>>10)+i|0)&i|~r&o)+t[12]+1804603682|0,o+=((n=(n<<7|n>>>25)+r|0)&r|~n&i)+t[13]-40341101|0,i+=((o=(o<<12|o>>>20)+n|0)&n|~o&r)+t[14]-1502002290|0,r+=((i=(i<<17|i>>>15)+o|0)&o|~i&n)+t[15]+1236535329|0,n+=((r=(r<<22|r>>>10)+i|0)&o|i&~o)+t[1]-165796510|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[6]-1069501632|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[11]+643717713|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[0]-373897302|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[5]-701558691|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[10]+38016083|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[15]-660478335|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[4]-405537848|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[9]+568446438|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[14]-1019803690|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[3]-187363961|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0,n+=((r=(r<<20|r>>>12)+i|0)&o|i&~o)+t[13]-1444681467|0,o+=((n=(n<<5|n>>>27)+r|0)&i|r&~i)+t[2]-51403784|0,i+=((o=(o<<9|o>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0,r+=((i=(i<<14|i>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0,n+=((r=(r<<20|r>>>12)+i|0)^i^o)+t[5]-378558|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[8]-2022574463|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[11]+1839030562|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[14]-35309556|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[1]-1530992060|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[4]+1272893353|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[7]-155497632|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[10]-1094730640|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[13]+681279174|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[0]-358537222|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[3]-722521979|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[6]+76029189|0,n+=((r=(r<<23|r>>>9)+i|0)^i^o)+t[9]-640364487|0,o+=((n=(n<<4|n>>>28)+r|0)^r^i)+t[12]-421815835|0,i+=((o=(o<<11|o>>>21)+n|0)^n^r)+t[15]+530742520|0,r+=((i=(i<<16|i>>>16)+o|0)^o^n)+t[2]-995338651|0,n+=(i^((r=(r<<23|r>>>9)+i|0)|~o))+t[0]-198630844|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[7]+1126891415|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[14]-1416354905|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[5]-57434055|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[12]+1700485571|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[3]-1894986606|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[10]-1051523|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[1]-2054922799|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[8]+1873313359|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[15]-30611744|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[6]-1560198380|0,r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[13]+1309151649|0,n+=(i^((r=(r<<21|r>>>11)+i|0)|~o))+t[4]-145523070|0,o+=(r^((n=(n<<6|n>>>26)+r|0)|~i))+t[11]-1120210379|0,i+=(n^((o=(o<<10|o>>>22)+n|0)|~r))+t[2]+718787259|0,r=((r+=(o^((i=(i<<15|i>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function i(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function o(e){var t,i,o,s,a,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(l,r(e.substring(t-64,t)));for(e=e.substring(t-64),i=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(l,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,n(l,o),l}function s(e){var n,r="";for(n=0;n<4;n+=1)r+=t[e>>8*n+4&15]+t[e>>8*n&15];return r}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function l(){this.reset()}return a(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,r){var i,o,s,a,u=this.byteLength,c=t(n,u),l=u;return r!==e&&(l=t(r,u)),c>l?new ArrayBuffer(0):(i=l-c,o=new ArrayBuffer(i),s=new Uint8Array(o),a=new Uint8Array(this,c,i),s.set(a),o)}}(),l.prototype.append=function(e){return this.appendBinary(u(e)),this},l.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)n(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=a(this._hash),e&&(n=c(n)),this.reset(),n},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},l.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(e,t){var r,i,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(n(this._hash,e),s=0;s<16;s+=1)e[s]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=i,e[15]=o,n(this._hash,e)},l.hash=function(e,t){return l.hashBinary(u(e),t)},l.hashBinary=function(e,t){var n=a(o(e));return t?c(n):n},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(e){var t,r,o,s,a,u=(r=this._buff.buffer,o=e,s=!0,(a=new Uint8Array(r.byteLength+o.byteLength)).set(new Uint8Array(r)),a.set(new Uint8Array(o),r.byteLength),s?a:a.buffer),c=u.length;for(this._length+=e.byteLength,t=64;t<=c;t+=64)n(this._hash,i(u.subarray(t-64,t)));return this._buff=t-64<c?new Uint8Array(u.buffer.slice(t-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=a(this._hash),e&&(n=c(n)),this.reset(),n},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var e,t=l.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},l.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return t?o:i}(e.buff,!0),l.prototype.setState.call(this,e)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(e,t){var r=a(function(e){var t,r,o,s,a,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(l,i(e.subarray(t-64,t)));for(e=t-64<c?e.subarray(t-64):new Uint8Array(0),r=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(l,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),u=parseInt(s[1],16)||0,o[14]=a,o[15]=u,n(l,o),l}(new Uint8Array(e)));return t?c(r):r},l}()}),G=I(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}}),X=[],Q=0;Q<256;++Q)X[Q]=(Q+256).toString(16).substr(1);var Z,ee,te=function(e,t){var n=t||0,r=X;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]},ne=0,re=0;var ie=function(e,t,n){var r=t&&n||0,i=t||[],o=(e=e||{}).node||Z,s=void 0!==e.clockseq?e.clockseq:ee;if(null==o||null==s){var a=G();null==o&&(o=Z=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==s&&(s=ee=16383&(a[6]<<8|a[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:re+1,l=u-ne+(c-re)/1e4;if(l<0&&void 0===e.clockseq&&(s=s+1&16383),(l<0||u>ne)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ne=u,re=c,ee=s;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var h=u/4294967296*1e4&268435455;i[r++]=h>>>8&255,i[r++]=255&h,i[r++]=h>>>24&15|16,i[r++]=h>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var d=0;d<6;++d)i[r+d]=o[d];return t||te(i)};var oe=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||G)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||te(i)},se=oe;se.v1=ie,se.v4=oe;var ae=se;function ue(e,t,n){var r=n[n.length-1];e===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(e);else if(o===t.length-2){i[t.pop()]=e}else t.push(e)}var ce={stringify:function(e){var t=[];t.push({obj:e});for(var n,r,i,o,s,a,u,c,l,f,h="";n=t.pop();)if(r=n.obj,h+=n.prefix||"",i=n.val||"")h+=i;else if("object"!=typeof r)h+=void 0===r?null:JSON.stringify(r);else if(null===r)h+="null";else if(Array.isArray(r)){for(t.push({val:"]"}),o=r.length-1;o>=0;o--)s=0===o?"":",",t.push({obj:r[o],prefix:s});t.push({val:"["})}else{for(u in a=[],r)r.hasOwnProperty(u)&&a.push(u);for(t.push({val:"}"}),o=a.length-1;o>=0;o--)l=r[c=a[o]],f=o>0?",":"",f+=JSON.stringify(c)+":",t.push({obj:l,prefix:f});t.push({val:"{"})}return h},parse:function(e){for(var t,n,r,i,o,s,a,u,c,l=[],f=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,ue(null,l,f);break;case"t":h+=3,ue(!0,l,f);break;case"f":h+=4,ue(!1,l,f);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",h--;;){if(r=e[h++],!/[\d\.\-e\+]/.test(r)){h--;break}n+=r}ue(parseFloat(n),l,f);break;case'"':for(i="",o=void 0,s=0;'"'!==(a=e[h++])||"\\"===o&&s%2==1;)i+=a,"\\"===(o=a)?s++:s=0;ue(JSON.parse('"'+i+'"'),l,f);break;case"[":u={element:[],index:l.length},l.push(u.element),f.push(u);break;case"{":c={element:{},index:l.length},l.push(c.element),f.push(c);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===l.length)return l.pop();ue(l.pop(),l,f)}}};function le(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}var fe,he,de=Function.prototype.toString,pe=de.call(Object);function ge(e){var t,n,r;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=ge(e[n]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return le(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&de.call(n)==pe}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=ge(e[n]);void 0!==i&&(t[n]=i)}return t}function ve(e){var t=!1;return O(function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)})}function ye(e){return O(function(t){t=ge(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),i=new Promise(function(r,i){var o;try{var s=ve(function(e,t){e?i(e):r(t)});t.push(s),(o=e.apply(n,t))&&"function"==typeof o.then&&r(o)}catch(e){i(e)}});return r&&i.then(function(e){r(null,e)},r),i})}function me(e,t){return ye(O(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var o=n[n.length-1];n[n.length-1]=function(n,r){var i=["api",e.name,t];i=i.concat(n?["error",n]:["success",r]),e.constructor.emit("debug",i),o(n,r)}}}(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(t,i){r.taskqueue.addTask(function(o){o?i(o):t(r[e].apply(r,n))})})}))}function be(e){return"$"+e}function we(e){return e.substring(1)}function _e(){this._store={}}function Ce(e){if(this._store=new _e,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}function ke(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}_e.prototype.get=function(e){var t=be(e);return this._store[t]},_e.prototype.set=function(e,t){var n=be(e);return this._store[n]=t,!0},_e.prototype.has=function(e){return be(e)in this._store},_e.prototype.delete=function(e){var t=be(e),n=t in this._store;return delete this._store[t],n},_e.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n];e(this._store[i],i=we(i))}},Object.defineProperty(_e.prototype,"size",{get:function(){return Object.keys(this._store).length}}),Ce.prototype.add=function(e){return this._store.set(e,!0)},Ce.prototype.has=function(e){return this._store.has(e)},Ce.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(Ce.prototype,"size",{get:function(){return this._store.size}}),!function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(fe=Ce,he=_e):(fe=Set,he=Map);var Ae,Ee=6;function Oe(e){return e}function Se(e){return[{ok:e}]}function xe(e,t,n){var r=t.docs,i=new he;r.forEach(function(e){i.has(e.id)?i.get(e.id).push(e):i.set(e.id,[e])});var o=i.size,s=0,a=new Array(o);function u(){var e;++s===o&&(e=[],a.forEach(function(t){t.docs.forEach(function(n){e.push({id:t.id,docs:[n]})})}),n(null,{results:e}))}var c=[];i.forEach(function(e,t){c.push(t)});var l=0;function f(){if(!(l>=c.length)){var n=Math.min(l+Ee,c.length),r=c.slice(l,n);!function(n,r){n.forEach(function(n,o){var s=r+o,c=i.get(n),l=ke(c[0],["atts_since","attachments"]);l.open_revs=c.map(function(e){return e.rev}),l.open_revs=l.open_revs.filter(Oe);var h=Oe;0===l.open_revs.length&&(delete l.open_revs,h=Se),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(l[e]=t[e])}),e.get(n,l,function(e,t){var r,i,o;r=e?[{error:e}]:h(t),i=n,o=r,a[s]={id:i,docs:o},u(),f()})})}(r,l),l+=r.length}}f()}try{localStorage.setItem("_pouch_check_localstorage",1),Ae=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){Ae=!1}function Ie(){return Ae}function Te(){var e;U.call(this),this._listeners={},e=this,Ie()&&addEventListener("storage",function(t){e.emit(t.key)})}function Be(e){if("undefined"!=typeof console&&"function"==typeof console[e])Array.prototype.slice.call(arguments,1)}function Pe(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)}function je(e,t){Be("info","The above "+e+" is totally normal. "+t)}W(Te,U),Te.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=ke(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===o&&N(s),o=!1}).on("error",function(){o=!1})}}},Te.prototype.removeListener=function(e,t){t in this._listeners&&(U.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},Te.prototype.notifyLocalWindows=function(e){Ie()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},Te.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var Re="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};function De(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}W(De,Error),De.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new De(401,"unauthorized","Name or password is incorrect.");var qe=new De(400,"bad_request","Missing JSON list of 'docs'"),Fe=new De(404,"not_found","missing"),Le=new De(409,"conflict","Document update conflict"),Ne=new De(400,"bad_request","_id field must contain a string"),Me=new De(412,"missing_id","_id is required for puts"),Ue=new De(400,"bad_request","Only reserved document ids may start with underscore."),$e=(new De(412,"precondition_failed","Database not open"),new De(500,"unknown_error","Database encountered an unknown error")),ze=new De(500,"badarg","Some query argument is invalid"),Ye=(new De(400,"invalid_request","Request was invalid"),new De(400,"query_parse_error","Some query parameter is invalid")),Je=new De(500,"doc_validation","Bad special document member"),He=new De(400,"bad_request","Something wrong with the request"),Ve=new De(400,"bad_request","Document must be a JSON object"),We=(new De(404,"not_found","Database not found"),new De(500,"indexed_db_went_bad","unknown")),Ke=(new De(500,"web_sql_went_bad","unknown"),new De(500,"levelDB_went_went_bad","unknown"),new De(403,"forbidden","Forbidden by design doc validate_doc_update function"),new De(400,"bad_request","Invalid rev format")),Ge=(new De(412,"file_exists","The database could not be created, the file already exists."),new De(412,"missing_stub","A pre-existing attachment stub wasn't found"));new De(413,"invalid_url","Provided URL is invalid");function Xe(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=De.prototype,new n(t)}function Qe(e){if("object"!=typeof e){var t=e;(e=$e).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function Ze(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(r){r.doc||(r.doc={});var i=n&&function(e,t,n){try{return!e(t,n)}catch(e){var r="Filter function threw: "+e.toString();return Xe(He,r)}}(e.filter,r.doc,t);if("object"==typeof i)return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}else delete r.doc;return!0}}function et(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function tt(e){var t;if(e?"string"!=typeof e?t=Xe(Ne):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=Xe(Ue)):t=Xe(Me),t)throw t}function nt(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(Be("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function rt(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function it(e){var t=rt(e);return t?t.join("/"):null}var ot=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],st="queryKey",at=/(?:^|&)([^&=]*)=?([^&]*)/g,ut=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ct(e){for(var t=ut.exec(e),n={},r=14;r--;){var i=ot[r],o=t[r]||"",s=-1!==["user","password"].indexOf(i);n[i]=s?decodeURIComponent(o):o}return n[st]={},n[ot[12]].replace(at,function(e,t,r){t&&(n[st][t]=r)}),n}function lt(e,t){var n=[],r=[];for(var i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function ft(e,t,n){return new Promise(function(r,i){e.get(t,function(o,s){if(o){if(404!==o.status)return i(o);s={}}var a=s._rev,u=n(s);if(!u)return r({updated:!1,rev:a});u._id=t,u._rev=a,r(function(e,t,n){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(r){if(409!==r.status)throw r;return ft(e,t._id,n)})}(e,u,n))})})}var ht=function(e){return atob(e)},dt=function(e){return btoa(e)};function pt(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}function gt(e,t){return pt([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(e)],{type:t})}function vt(e,t){return gt(ht(e),t)}function yt(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(r)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}(n))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function mt(e,t){yt(e,function(e){t(e)})}function bt(e,t){mt(e,function(e){t(dt(e))})}var wt=e.setImmediate||e.setTimeout,_t=32768;function Ct(e,t,n,r,i){(n>0||r<t.size)&&(t=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}(t,n,r)),function(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},n.readAsArrayBuffer(e)}(t,function(t){e.append(t),i()})}function kt(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function At(e,t){var n="string"==typeof e,r=n?e.length:e.size,i=Math.min(_t,r),o=Math.ceil(r/i),s=0,a=n?new K:new K.ArrayBuffer,u=n?kt:Ct;function c(){wt(f)}function l(){var e=function(e){return dt(e)}(a.end(!0));t(e),a.destroy()}function f(){var t=s*i,n=t+i;u(a,e,t,n,++s<o?c:l)}f()}function Et(e){return K.hash(e)}function Ot(e,t){var n=ge(e);return t?(delete n._rev_tree,Et(JSON.stringify(n))):ae.v4().replace(/-/g,"").toLowerCase()}var St=ae.v4;function xt(e){for(var t,n,r,i,o=e.rev_tree.slice();i=o.pop();){var s=i.ids,a=s[2],u=i.pos;if(a.length)for(var c=0,l=a.length;c<l;c++)o.push({pos:u+1,ids:a[c]});else{var f=!!s[1].deleted,h=s[0];t&&!(r!==f?r:n!==u?n<u:t<h)||(t=h,n=u,r=f)}}return n+"-"+t}function It(e,t){for(var n,r=e.slice();n=r.pop();)for(var i=n.pos,o=n.ids,s=o[2],a=t(0===s.length,i,o[0],n.ctx,o[1]),u=0,c=s.length;u<c;u++)r.push({pos:i+1,ids:s[u],ctx:a})}function Tt(e,t){return e.pos-t.pos}function Bt(e){var t=[];It(e,function(e,n,r,i,o){e&&t.push({rev:n+"-"+r,pos:n,opts:o})}),t.sort(Tt).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function Pt(e){for(var t=xt(e),n=Bt(e.rev_tree),r=[],i=0,o=n.length;i<o;i++){var s=n[i];s.rev===t||s.opts.deleted||r.push(s.rev)}return r}function jt(e){for(var t,n=[],r=e.slice();t=r.pop();){var i=t.pos,o=t.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,l=t.history?t.history.slice():[];l.push({id:s,opts:a}),c&&n.push({pos:i+1-l.length,ids:l});for(var f=0,h=u.length;f<h;f++)r.push({pos:i+1,ids:u[f],history:l})}return n.reverse()}function Rt(e,t){return e.pos-t.pos}function Dt(e,t,n){var r=function(e,t,n){for(var r,i=0,o=e.length;i<o;)n(e[r=i+o>>>1],t)<0?i=r+1:o=r;return i}(e,t,n);e.splice(r,0,t)}function qt(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var s=e[i],a=[s.id,s.opts,[]];r?(r[2].push(a),r=a):n=r=a}return n}function Ft(e,t){return e[0]<t[0]?-1:1}function Lt(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),o=i.tree1,s=i.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===s[2][a][0]&&(n.push({tree1:o[2][c],tree2:s[2][a]}),u=!0);u||(r="new_branch",Dt(o[2],s[2][a],Ft))}else r="new_leaf",o[2][0]=s[2][a]}return{conflicts:r,tree:e}}function Nt(e,t,n){var r,i=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,u=e.length;a<u;a++){var c=e[a];if(c.pos===t.pos&&c.ids[0]===t.ids[0])r=Lt(c.ids,t.ids),i.push({pos:c.pos,ids:r.tree}),o=o||r.conflicts,s=!0;else if(!0!==n){var l=c.pos<t.pos?c:t,f=c.pos<t.pos?t:c,h=f.pos-l.pos,d=[],p=[];for(p.push({ids:l.ids,diff:h,parent:null,parentIdx:null});p.length>0;){var g=p.pop();if(0!==g.diff)for(var v=g.ids[2],y=0,m=v.length;y<m;y++)p.push({ids:v[y],diff:g.diff-1,parent:g.ids,parentIdx:y});else g.ids[0]===f.ids[0]&&d.push(g)}var b=d[0];b?(r=Lt(b.ids,f.ids),b.parent[2][b.parentIdx]=r.tree,i.push({pos:l.pos,ids:l.ids}),o=o||r.conflicts,s=!0):i.push(c)}else i.push(c)}return s||i.push(t),i.sort(Rt),{tree:i,conflicts:o||"internal_node"}}function Mt(e,t,n){var r=Nt(e,t),i=function(e,t){for(var n,r,i=jt(e),o=0,s=i.length;o<s;o++){var a,u=i[o],c=u.ids;if(c.length>t){n||(n={});var l=c.length-t;a={pos:u.pos+l,ids:qt(c,l)};for(var f=0;f<l;f++){var h=u.pos+f+"-"+c[f].id;n[h]=!0}}else a={pos:u.pos,ids:qt(c,0)};r=r?Nt(r,a,!0).tree:[a]}return n&&It(r,function(e,t,r){delete n[t+"-"+r]}),{tree:r,revs:n?Object.keys(n):[]}}(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ut(e){return e.ids}function $t(e,t){t||(t=xt(e));for(var n,r=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(Ut);n=i.pop();){if(n[0]===r)return!!n[1].deleted;i=i.concat(n[2])}}function zt(e){return/^_local/.test(e)}function Yt(e,t,n){U.call(this);var r=this;this.db=e;var i=(t=t?ge(t):{}).complete=ve(function(t,n){var i,s;t?(s="error",("listenerCount"in(i=r)?i.listenerCount(s):U.listenerCount(i,s))>0&&r.emit("error",t)):r.emit("complete",n),r.removeAllListeners(),e.removeListener("destroyed",o)});function o(){r.cancel()}n&&(r.on("complete",function(e){n(null,e)}),r.on("error",n)),e.once("destroyed",o),t.onChange=function(e,t,n){r.isCancelled||function(e,t,n,r){try{e.emit("change",t,n,r)}catch(e){Be("error",'Error in .on("change", function):',e)}}(r,e,t,n)};var s=new Promise(function(e,n){t.complete=function(t,r){t?n(t):e(r)}});r.once("cancel",function(){e.removeListener("destroyed",o),t.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then(function(e){i(null,e)},i),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):r.isCancelled?r.emit("cancel"):r.validateChanges(t)})}function Jt(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=Bt(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:r,doc:e};return $t(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Pt(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function Ht(e,t){return e<t?-1:e>t?1:0}function Vt(e,t){return function(n,r){n||r[0]&&r[0].error?((n=n||r[0]).docId=t,e(n)):e(null,r.length?r[0]:r)}}function Wt(e,t){var n=Ht(e._id,t._id);return 0!==n?n:Ht(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function Kt(){for(var e in U.call(this),Kt.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function Gt(){this.isReady=!1,this.failed=!1,this.queue=[]}function Xt(e,t){if(!(this instanceof Xt))return new Xt(e,t);var n=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=ge(t),n.auto_compaction=t.auto_compaction,n.prefix=Xt.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var r=function(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=Xt.adapters,i=Xt.preferredAdapters,o=Xt.prefix,s=t.adapter;if(!s)for(var a=0;a<i.length&&"idb"===(s=i[a])&&"websql"in r&&Ie()&&localStorage["_pouch__websqldb_"+o+e];++a)Be("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var u=r[s];return{name:u&&"use_prefix"in u&&!u.use_prefix?e:o+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=r.name,t.adapter=t.adapter||r.adapter,n.name=e,n._adapter=t.adapter,Xt.emit("debug",["adapter","Picked adapter: ",t.adapter]),!Xt.adapters[t.adapter]||!Xt.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);Kt.call(n),n.taskqueue=new Gt,n.adapter=t.adapter,Xt.adapters[t.adapter].call(n,t,function(e){if(e)return n.taskqueue.fail(e);!function(e){function t(t){e.removeListener("closed",n),t||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}(n),n.emit("created",n),Xt.emit("created",n.name),n.taskqueue.ready(n)})}W(Yt,U),Yt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Yt.prototype.validateChanges=function(e){var t=e.complete,n=this;Xt._changesFilterPlugin?Xt._changesFilterPlugin.validate(e,function(r){if(r)return t(r);n.doChanges(e)}):n.doChanges(e)},Yt.prototype.doChanges=function(e){var t=this,n=e.complete;if("live"in(e=ge(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Jt,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(Xt._changesFilterPlugin){if(Xt._changesFilterPlugin.normalize(e),Xt._changesFilterPlugin.shouldFilter(this,e))return Xt._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(t){t in e&&Be("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&"function"==typeof r.cancel){var i=t.cancel;t.cancel=O(function(e){r.cancel(),i.apply(this,e)})}}else this.db.info().then(function(r){t.isCancelled?n(null,{status:"cancelled"}):(e.since=r.update_seq,t.doChanges(e))},n)},W(Kt,U),Kt.prototype.post=me("post",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(Xe(Ve));this.bulkDocs({docs:[e]},t,Vt(n,e._id))}),Kt.prototype.put=me("put",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(Xe(Ve));if(tt(e._id),zt(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r,i,o,s,a=this;function u(n){"function"==typeof a._put&&!1!==t.new_edits?a._put(e,t,n):a.bulkDocs({docs:[e]},t,Vt(n,e._id))}t.force&&e._rev?(r=e._rev.split("-"),i=r[1],o=parseInt(r[0],10)+1,s=Ot(),e._revisions={start:o,ids:[s,i]},e._rev=o+"-"+s,t.new_edits=!1,u(function(t){var r=t?null:{ok:!0,id:e._id,rev:e._rev};n(t,r)})):u(n)}),Kt.prototype.putAttachment=me("putAttachment",function(e,t,n,r,i){var o=this;function s(e){var n="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:r,revpos:++n},o.put(e)}return"function"==typeof i&&(i=r,r=n,n=null),void 0===i&&(i=r,r=n,n=null),i||Be("warn","Attachment",t,"on document",e,"is missing content_type"),o.get(e).then(function(e){if(e._rev!==n)throw Xe(Le);return s(e)},function(t){if(t.reason===Fe.message)return s({_id:e});throw t})}),Kt.prototype.removeAttachment=me("removeAttachment",function(e,t,n,r){var i=this;i.get(e,function(e,o){if(e)r(e);else if(o._rev===n){if(!o._attachments)return r();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,i.put(o,r)}else r(Xe(Le))})}),Kt.prototype.remove=me("remove",function(e,t,n,r){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t)),(n=n||{}).was_delete=!0;var o={_id:i._id,_rev:i._rev||n.rev,_deleted:!0};if(zt(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(i,r);this.bulkDocs({docs:[o]},n,Vt(r,o._id))}),Kt.prototype.revsDiff=me("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={});var r=Object.keys(e);if(!r.length)return n(null,{});var i=0,o=new he;function s(e,t){o.has(e)||o.set(e,{missing:[]}),o.get(e).missing.push(t)}r.map(function(t){this._getRevisionTree(t,function(a,u){if(a&&404===a.status&&"missing"===a.message)o.set(t,{missing:e[t]});else{if(a)return n(a);!function(t,n){var r=e[t].slice(0);It(n,function(e,n,i,o,a){var u=n+"-"+i,c=r.indexOf(u);-1!==c&&(r.splice(c,1),"available"!==a.status&&s(t,u))}),r.forEach(function(e){s(t,e)})}(t,u)}if(++i===r.length){var c={};return o.forEach(function(e,t){c[t]=e}),n(null,c)}})},this)}),Kt.prototype.bulkGet=me("bulkGet",function(e,t){xe(this,e,t)}),Kt.prototype.compactDocument=me("compactDocument",function(e,t,n){var r=this;this._getRevisionTree(e,function(i,o){if(i)return n(i);var s=function(e){var t={},n=[];return It(e,function(e,r,i,o){var s=r+"-"+i;return e&&(t[s]=0),void 0!==o&&n.push({from:o,to:s}),s}),n.reverse(),n.forEach(function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t}(o),a=[],u=[];Object.keys(s).forEach(function(e){s[e]>t&&a.push(e)}),It(o,function(e,t,n,r,i){var o=t+"-"+n;"available"===i.status&&-1!==a.indexOf(o)&&u.push(o)}),r._doCompaction(e,u,n)})}),Kt.prototype.compact=me("compact",function(e,t){"function"==typeof e&&(t=e,e={});e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&function e(t){var n=t._compactionQueue[0],r=n.opts,i=n.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(n){n&&n.last_seq&&(r.last_seq=n.last_seq),t._compact(r,function(n,r){n?i(n):i(null,r),N(function(){t._compactionQueue.shift(),t._compactionQueue.length&&e(t)})})})}(this)}),Kt.prototype._compact=function(e,t){var n=this,r={return_docs:!1,last_seq:e.last_seq||0},i=[];n.changes(r).on("change",function(e){i.push(n.compactDocument(e.id,0))}).on("complete",function(e){var r=e.last_seq;Promise.all(i).then(function(){return ft(n,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<r)&&(e.last_seq=r,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on("error",t)},Kt.prototype.get=me("get",function(e,t,n){if("function"==typeof t&&(n=t,t={}),"string"!=typeof e)return n(Xe(Ne));if(zt(e)&&"function"==typeof this._getLocal)return this._getLocal(e,n);var r=[],i=this;function o(){var o=[],s=r.length;if(!s)return n(null,o);r.forEach(function(r){i.get(e,{rev:r,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},function(e,t){if(e)o.push({missing:r});else{for(var i,a=0,u=o.length;a<u;a++)if(o[a].ok&&o[a].ok._rev===t._rev){i=!0;break}i||o.push({ok:t})}--s||n(null,o)})})}if(!t.open_revs)return this._get(e,t,function(r,o){if(r)return r.docId=e,n(r);var s=o.doc,a=o.metadata,u=o.ctx;if(t.conflicts){var c=Pt(a);c.length&&(s._conflicts=c)}if($t(a,s._rev)&&(s._deleted=!0),t.revs||t.revs_info){for(var l=s._rev.split("-"),f=parseInt(l[0],10),h=l[1],d=jt(a.rev_tree),p=null,g=0;g<d.length;g++){var v=d[g],y=v.ids.map(function(e){return e.id}).indexOf(h);(y===f-1||!p&&-1!==y)&&(p=v)}var m=p.ids.map(function(e){return e.id}).indexOf(s._rev.split("-")[1])+1,b=p.ids.length-m;if(p.ids.splice(m,b),p.ids.reverse(),t.revs&&(s._revisions={start:p.pos+p.ids.length-1,ids:p.ids.map(function(e){return e.id})}),t.revs_info){var w=p.pos+p.ids.length;s._revs_info=p.ids.map(function(e){return{rev:--w+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&s._attachments){var _=s._attachments,C=Object.keys(_).length;if(0===C)return n(null,s);Object.keys(_).forEach(function(e){this._getAttachment(s._id,e,_[e],{rev:s._rev,binary:t.binary,ctx:u},function(t,r){var i=s._attachments[e];i.data=r,delete i.stub,delete i.length,--C||n(null,s)})},i)}else{if(s._attachments)for(var k in s._attachments)s._attachments.hasOwnProperty(k)&&(s._attachments[k].stub=!0);n(null,s)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){if(e)return n(e);r=Bt(t).map(function(e){return e.rev}),o()});else{if(!Array.isArray(t.open_revs))return n(Xe($e,"function_clause"));r=t.open_revs;for(var s=0;s<r.length;s++){var a=r[s];if("string"!=typeof a||!/^\d+-/.test(a))return n(Xe(Ke))}o()}}),Kt.prototype.getAttachment=me("getAttachment",function(e,t,n,r){var i=this;n instanceof Function&&(r=n,n={}),this._get(e,n,function(o,s){return o?r(o):s.doc._attachments&&s.doc._attachments[t]?(n.ctx=s.ctx,n.binary=!0,void i._getAttachment(e,t,s.doc._attachments[t],n,r)):r(Xe(Fe))})}),Kt.prototype.allDocs=me("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(n)return void t(Xe(Ye,"Query parameter `"+n+"` is not compatible with multi-get"));if(!nt(this)&&(function(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}(e),0===e.keys.length))return this._allDocs({limit:0},t)}return this._allDocs(e,t)}),Kt.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new Yt(this,e,t)},Kt.prototype.close=me("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),Kt.prototype.info=me("info",function(e){var t=this;this._info(function(n,r){if(n)return e(n);r.db_name=r.db_name||t.name,r.auto_compaction=!(!t.auto_compaction||nt(t)),r.adapter=t.adapter,e(null,r)})}),Kt.prototype.id=me("id",function(e){return this._id(e)}),Kt.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Kt.prototype.bulkDocs=me("bulkDocs",function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(Xe(qe));for(var r=0;r<e.docs.length;++r)if("object"!=typeof e.docs[r]||Array.isArray(e.docs[r]))return n(Xe(Ve));var i;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){i=i||function(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(t),e._attachments[t].content_type||Be("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),i)return n(Xe(He,i));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||nt(o)||e.docs.sort(Wt),function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var o=r[i];n._attachments[o]=ke(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var s=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,r){if(e)return n(e);if(t.new_edits||(r=r.filter(function(e){return e.error})),!nt(o))for(var i=0,a=r.length;i<a;i++)r[i].id=r[i].id||s[i];n(null,r)})}),Kt.prototype.registerDependentDatabase=me("registerDependentDatabase",function(e,t){var n=new this.constructor(e,this.__opts);ft(this,"_local/_pouch_dependentDbs",function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:n})}).catch(t)}),Kt.prototype.destroy=me("destroy",function(e,t){"function"==typeof e&&(t=e,e={});var n=this,r=!("use_prefix"in n)||n.use_prefix;function i(){n._destroy(e,function(e,r){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,r||{ok:!0})})}if(nt(n))return i();n.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404!==e.status?t(e):i();var s=o.dependentDbs,a=n.constructor,u=Object.keys(s).map(function(e){var t=r?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,n.__opts).destroy()});Promise.all(u).then(i,t)})}),Gt.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Gt.prototype.fail=function(e){this.failed=e,this.execute()},Gt.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Gt.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},W(Xt,Kt);var Qt="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},Zt=fetch,en=Headers;Xt.adapters={},Xt.preferredAdapters=[],Xt.prefix="_pouch_";var tn=new U;!function(e){Object.keys(U.prototype).forEach(function(t){"function"==typeof U.prototype[t]&&(e[t]=tn[t].bind(tn))});var t=e._destructionListeners=new he;e.on("ref",function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)}),e.on("unref",function(e){if(t.has(e.name)){var n=t.get(e.name),r=n.indexOf(e);r<0||(n.splice(r,1),n.length>1?t.set(e.name,n):t.delete(e.name))}}),e.on("destroyed",function(e){if(t.has(e)){var n=t.get(e);t.delete(e),n.forEach(function(e){e.emit("destroyed",!0)})}})}(Xt),Xt.adapter=function(e,t,n){t.valid()&&(Xt.adapters[e]=t,n&&Xt.preferredAdapters.push(e))},Xt.plugin=function(e){if("function"==typeof e)e(Xt);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){Xt.prototype[t]=e[t]})}return this.__defaults&&(Xt.__defaults=Re({},this.__defaults)),Xt},Xt.defaults=function(e){function t(e,n){if(!(this instanceof t))return new t(e,n);n=n||{},e&&"object"==typeof e&&(e=(n=e).name,delete n.name),n=Re({},t.__defaults,n),Xt.call(this,e,n)}return W(t,Xt),t.preferredAdapters=Xt.preferredAdapters.slice(),Object.keys(Xt).forEach(function(e){e in t||(t[e]=Xt[e])}),t.__defaults=Re({},this.__defaults,e),t},Xt.fetch=function(e,t){return Zt(e,t)};function nn(e,t){for(var n=e,r=0,i=t.length;r<i;r++){if(!(n=n[t[r]]))break}return n}function rn(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var o=e[r];"."===o?r>0&&"\\"===e[r-1]?n=n.substring(0,n.length-1)+".":(t.push(n),n=""):n+=o}return t.push(n),t}var on=["$or","$nor","$not"];function sn(e){return on.indexOf(e)>-1}function an(e){return Object.keys(e)[0]}function un(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(n){var r=e[n];if("object"!=typeof r&&(r={$eq:r}),sn(n))r instanceof Array?t[n]=r.map(function(e){return un([e])}):t[n]=un([r]);else{var i=t[n]=t[n]||{};Object.keys(r).forEach(function(e){var t=r[e];return"$gt"===e||"$gte"===e?function(e,t,n){if(void 0!==n.$eq)return;void 0!==n.$gte?"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):void 0!==n.$gt?"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t}(e,t,i):"$lt"===e||"$lte"===e?function(e,t,n){if(void 0!==n.$eq)return;void 0!==n.$lte?"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):void 0!==n.$lt?"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t}(e,t,i):"$ne"===e?function(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(t,i):"$eq"===e?function(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(t,i):void(i[e]=t)})}})}),t}var cn=-324,ln=3,fn="";function hn(e,t){if(e===t)return 0;e=dn(e),t=dn(t);var n=mn(e),r=mn(t);if(n-r!=0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=hn(e[r],t[r]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),o=0;o<i;o++){var s=hn(n[o],r[o]);if(0!==s)return s;if(0!==(s=hn(e[n[o]],t[r[o]])))return s}return n.length===r.length?0:n.length>r.length?1:-1}(e,t)}function dn(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=dn(t[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},t)if(t.hasOwnProperty(i)){var o=t[i];void 0!==o&&(e[i]=dn(o))}}}return e}function pn(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",o=(s=((r?-n:n)-cn).toString(),a="0",u=ln,function(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}(s,a,u)+s);var s,a,u;i+=fn+o;var c=Math.abs(parseFloat(t[0]));r&&(c=10-c);var l=c.toFixed(20);return l=l.replace(/\.?0+$/,""),i+=fn+l}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,o="";if(t)for(;++r<i;)o+=gn(n[r]);else for(;++r<i;){var s=n[r];o+=gn(s)+gn(e[s])}return o}return""}function gn(e){return mn(e=dn(e))+fn+pn(e)+"\0"}function vn(e,t){var n,r=t;if("1"===e[t])n=0,t++;else{var i="0"===e[t];t++;var o="",s=e.substring(t,t+ln),a=parseInt(s,10)+cn;for(i&&(a=-a),t+=ln;;){var u=e[t];if("\0"===u)break;o+=u,t++}n=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(n-=10),0!==a&&(n=parseFloat(n+"e"+a))}return{num:n,length:t-r}}function yn(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(n);else if(o===e.length-2){i[e.pop()]=n}else e.push(n)}}function mn(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function bn(e,t,n){if(e=e.filter(function(e){return wn(e.doc,t.selector,n)}),t.sort){var r=function(e){function t(t){return e.map(function(e){var n=rn(an(e));return nn(t,n)})}return function(e,n){var r,i,o=hn(t(e.doc),t(n.doc));return 0!==o?o:(r=e.doc._id,i=n.doc._id,r<i?-1:r>i?1:0)}}(t.sort);e=e.sort(r),"string"!=typeof t.sort[0]&&"desc"===(i=t.sort[0])[an(i)]&&(e=e.reverse())}var i;if("limit"in t||"skip"in t){var o=t.skip||0,s=("limit"in t?t.limit:e.length)+o;e=e.slice(o,s)}return e}function wn(e,t,n){return n.every(function(n){var r=t[n],i=rn(n),o=nn(e,i);return sn(n)?function(e,t,n){if("$or"===e)return t.some(function(e){return wn(n,e,Object.keys(e))});if("$not"===e)return!wn(n,t,Object.keys(t));return!t.find(function(e){return wn(n,e,Object.keys(e))})}(n,r,e):_n(r,e,i,o)})}function _n(e,t,n,r){return!e||Object.keys(e).every(function(i){var o=e[i];return function(e,t,n,r,i){if(!En[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return En[e](t,n,r,i)}(i,t,o,n,r)})}function Cn(e){return null!=e}function kn(e){return void 0!==e}function An(e,t){return t.some(function(t){return e instanceof Array?e.indexOf(t)>-1:e===t})}var En={$elemMatch:function(e,t,n,r){return!!Array.isArray(r)&&(0!==r.length&&("object"==typeof r[0]?r.some(function(e){return wn(e,t,Object.keys(t))}):r.some(function(r){return _n(t,e,n,r)})))},$allMatch:function(e,t,n,r){return!!Array.isArray(r)&&(0!==r.length&&("object"==typeof r[0]?r.every(function(e){return wn(e,t,Object.keys(t))}):r.every(function(r){return _n(t,e,n,r)})))},$eq:function(e,t,n,r){return kn(r)&&0===hn(r,t)},$gte:function(e,t,n,r){return kn(r)&&hn(r,t)>=0},$gt:function(e,t,n,r){return kn(r)&&hn(r,t)>0},$lte:function(e,t,n,r){return kn(r)&&hn(r,t)<=0},$lt:function(e,t,n,r){return kn(r)&&hn(r,t)<0},$exists:function(e,t,n,r){return t?kn(r):!kn(r)},$mod:function(e,t,n,r){return Cn(r)&&function(e,t){var n=t[0],r=t[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%n===r}(r,t)},$ne:function(e,t,n,r){return t.every(function(e){return 0!==hn(r,e)})},$in:function(e,t,n,r){return Cn(r)&&An(r,t)},$nin:function(e,t,n,r){return Cn(r)&&!An(r,t)},$size:function(e,t,n,r){return Cn(r)&&function(e,t){return e.length===t}(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&function(e,t){return t.every(function(t){return e.indexOf(t)>-1})}(r,t)},$regex:function(e,t,n,r){return Cn(r)&&function(e,t){return new RegExp(t).test(e)}(r,t)},$type:function(e,t,n,r){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(r,t)}};function On(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var n=bn([{doc:e}],{selector:t=function(e){var t=ge(e),n=!1;"$and"in t&&(t=un(t.$and),n=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n],i=e[r];"object"==typeof i&&null!==i||(e[r]={$eq:i})}})}),"$not"in t&&(t.$not=un([t.$not]));for(var r=Object.keys(t),i=0;i<r.length;i++){var o=r[i],s=t[o];"object"!=typeof s||null===s?s={$eq:s}:"$ne"in s&&!n&&(s.$ne=[s.$ne]),t[o]=s}return t}(t)},Object.keys(t));return n&&1===n.length}function Sn(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var n="string"==typeof e.filter?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function xn(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=it(e.view):e.filter=it(e.filter))}function In(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!nt(e.db)}function Tn(e,t){var n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var r=Xe(He,"`view` filter parameter not found or invalid.");return n(r)}var i=rt(t.view);e.db.get("_design/"+i[0],function(r,o){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(Qe(r));var s=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!s)return n(Xe(Fe,o.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=lt(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+s+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),e.doChanges(t)})}else if(t.selector)t.filter=function(e){return On(e,t.selector)},e.doChanges(t);else{var o=rt(t.filter);e.db.get("_design/"+o[0],function(r,i){if(e.isCancelled)return n(null,{status:"cancelled"});if(r)return n(Qe(r));var s=i&&i.filters&&i.filters[o[1]];if(!s)return n(Xe(Fe,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=lt('"use strict";\nreturn '+s+";",{}),e.doChanges(t)})}}function Bn(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}Xt.plugin(function(e){e._changesFilterPlugin={validate:Sn,normalize:xn,shouldFilter:In,filter:Tn}}),Xt.version="7.0.0";var Pn=Bn(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),jn=Bn(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Rn(e){if(!/^\d+-./.test(e))return Xe(Ke);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Dn(e,t,n){var r,i,o;n||(n={deterministic_revs:!0});var s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=St()),i=Ot(e,n.deterministic_revs),e._rev){if((o=Rn(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[i,s,[]]]]}],r=o.prefix+1}else e._rev_tree=[{pos:1,ids:[i,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,s=r.length;o<s;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}(e._revisions,s),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if((o=Rn(e._rev)).error)return o;r=o.prefix,i=o.id,e._rev_tree=[{pos:r,ids:[i,s,[]]}]}tt(e._id),e._rev=r+"-"+i;var a={metadata:{},data:{}};for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)){var c="_"===u[0];if(c&&!Pn[u]){var l=Xe(Je,u);throw l.message=Je.message+": "+u,l}c&&!jn[u]?a.metadata[u.slice(1)]=e[u]:a.data[u]=e[u]}return a}function qn(e,t,n){var r=function(e){try{return ht(e)}catch(e){return{error:Xe(ze,"Attachment is not a valid base64 string")}}}(e.data);if(r.error)return n(r.error);e.length=r.length,e.data="blob"===t?gt(r,e.content_type):"base64"===t?dt(r):r,At(r,function(t){e.digest="md5-"+t,n()})}function Fn(e,t,n){if(e.stub)return n();"string"==typeof e.data?qn(e,t,n):function(e,t,n){At(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,"binary"===t?mt(e.data,function(t){e.data=t,n()}):"base64"===t?bt(e.data,function(t){e.data=t,n()}):n()})}(e,t,n)}function Ln(e,t,n,r,i,o,s,a){if(function(e,t){for(var n,r=e.slice(),i=t.split("-"),o=parseInt(i[0],10),s=i[1];n=r.pop();){if(n.pos===o&&n.ids[0]===s)return!0;for(var a=n.ids[2],u=0,c=a.length;u<c;u++)r.push({pos:n.pos+1,ids:a[u]})}return!1}(t.rev_tree,n.metadata.rev)&&!a)return r[i]=n,o();var u=t.winningRev||xt(t),c="deleted"in t?t.deleted:$t(t,u),l="deleted"in n.metadata?n.metadata.deleted:$t(n.metadata),f=/^1-/.test(n.metadata.rev);if(c&&!l&&a&&f){var h=n.data;h._rev=u,h._id=n.metadata.id,n=Dn(h,a)}var d=Mt(t.rev_tree,n.metadata.rev_tree[0],e);if(a&&(c&&l&&"new_leaf"!==d.conflicts||!c&&"new_leaf"!==d.conflicts||c&&!l&&"new_branch"===d.conflicts)){var p=Xe(Le);return r[i]=p,o()}var g=n.metadata.rev;n.metadata.rev_tree=d.tree,n.stemmedRevs=d.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var v=xt(n.metadata),y=$t(n.metadata,v),m=c===y?0:c<y?-1:1;s(n,v,y,g===v?y:$t(n.metadata,g),!0,m,i,o)}function Nn(e,t,n,r,i,o,s,a,u){e=e||1e3;var c=a.new_edits,l=new he,f=0,h=t.length;function d(){++f===h&&u&&u()}t.forEach(function(e,t){if(e._id&&zt(e._id)){var r=e._deleted?"_removeLocal":"_putLocal";n[r](e,{ctx:i},function(e,n){o[t]=e||n,d()})}else{var s=e.metadata.id;l.has(s)?(h--,l.get(s).push([e,t])):l.set(s,[[e,t]])}}),l.forEach(function(t,n){var i=0;function u(){++i<t.length?l():d()}function l(){var l=t[i],f=l[0],h=l[1];if(r.has(n))Ln(e,r.get(n),f,o,h,u,s,c);else{var d=Mt([],f.metadata.rev_tree[0],e);f.metadata.rev_tree=d.tree,f.stemmedRevs=d.stemmedRevs||[],function(e,t,n){var r=xt(e.metadata),i=$t(e.metadata,r);if("was_delete"in a&&i)return o[t]=Xe(Fe,"deleted"),n();if(c&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var u=Xe(Le);return o[t]=u,n()}s(e,r,i,i,!1,i?0:1,t,n)}(f,h,u)}}l()})}var Mn=5,Un="document-store",$n="by-sequence",zn="attach-store",Yn="attach-seq-store",Jn="meta-store",Hn="local-store",Vn="detect-blob-support";function Wn(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(Xe(We,n,t.type))}}function Kn(e,t,n){return{data:function(e){try{return JSON.stringify(e)}catch(t){return ce.stringify(e)}}(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Gn(e){if(!e)return null;var t=function(e){try{return JSON.parse(e)}catch(t){return ce.parse(e)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function Xn(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Qn(e,t,n,r){n?r(e?"string"!=typeof e?e:vt(e,t):pt([""],{type:t})):e?"string"!=typeof e?yt(e,function(e){r(dt(e))}):r(e):r("")}function Zn(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var o=0;function s(){++o===i.length&&r&&r()}i.forEach(function(r){t.attachments&&t.include_docs?function(e,t){var r=e._attachments[t],i=r.digest;n.objectStore(zn).get(i).onsuccess=function(e){r.body=e.target.result.body,s()}}(e,r):(e._attachments[r].stub=!0,s())})}function er(e,t){return Promise.all(e.map(function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return Promise.all(n.map(function(n){var r=e.doc._attachments[n];if("body"in r){var i=r.body,o=r.content_type;return new Promise(function(s){Qn(i,o,t,function(t){e.doc._attachments[n]=Re(ke(r,["digest","content_type"]),{data:t}),s()})})}}))}}))}function tr(e,t,n){var r=[],i=n.objectStore($n),o=n.objectStore(zn),s=n.objectStore(Yn),a=e.length;function u(){--a||function(){if(!r.length)return;r.forEach(function(e){var t=s.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::￿",!1,!1));t.onsuccess=function(t){var n=t.target.result;n||o.delete(e)}})}()}e.forEach(function(e){var n=i.index("_doc_id_rev"),o=t+"::"+e;n.getKey(o).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return u();i.delete(t),s.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];r.push(n),s.delete(t.primaryKey),t.continue()}else u()}}})}function nr(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}var rr=new Te;function ir(e,t,n,r,i,o){for(var s,a,u,c,l,f,h,d,p=t.docs,g=0,v=p.length;g<v;g++){var y=p[g];y._id&&zt(y._id)||(y=p[g]=Dn(y,n.new_edits,e)).error&&!h&&(h=y)}if(h)return o(h);var m=!1,b=0,w=new Array(p.length),_=new he,C=!1,k=r._meta.blobSupport?"blob":"base64";function A(){m=!0,E()}function E(){d&&m&&(d.docCount+=b,f.put(d))}function O(){C||(rr.notify(r._meta.name),o(null,w))}function S(e,t,n,r,i,o,s,a){e.metadata.winningRev=t,e.metadata.deleted=n;var u=e.data;if(u._id=e.metadata.id,u._rev=e.metadata.rev,r&&(u._deleted=!0),u._attachments&&Object.keys(u._attachments).length)return function(e,t,n,r,i,o){var s=e.data,a=0,u=Object.keys(s._attachments);function l(){a===u.length&&x(e,t,n,r,i,o)}function f(){a++,l()}u.forEach(function(n){var r=e.data._attachments[n];if(r.stub)a++,l();else{var i=r.data;delete r.data,r.revpos=parseInt(t,10);var o=r.digest;!function(e,t,n){c.count(e).onsuccess=function(r){var i=r.target.result;if(i)return n();var o={digest:e,body:t},s=c.put(o);s.onsuccess=n}}(o,i,f)}})}(e,t,n,i,s,a);b+=o,E(),x(e,t,n,i,s,a)}function x(e,t,n,i,o,c){var f=e.data,h=e.metadata;function d(o){var u=e.stemmedRevs||[];i&&r.auto_compaction&&(u=u.concat(function(e){var t=[];return It(e.rev_tree,function(e,n,r,i,o){"available"!==o.status||e||(t.push(n+"-"+r),o.status="missing")}),t}(e.metadata))),u&&u.length&&tr(u,e.metadata.id,s),h.seq=o.target.result;var c=Kn(h,t,n);a.put(c).onsuccess=p}function p(){w[o]={ok:!0,id:h.id,rev:h.rev},_.set(e.metadata.id,e.metadata),function(e,t,n){var r=0,i=Object.keys(e.data._attachments||{});if(!i.length)return n();function o(){++r===i.length&&n()}function s(n){var r=e.data._attachments[n].digest,i=l.put({seq:t,digestSeq:r+"::"+t});i.onsuccess=o,i.onerror=function(e){e.preventDefault(),e.stopPropagation(),o()}}for(var a=0;a<i.length;a++)s(i[a])}(e,h.seq,c)}f._doc_id_rev=h.id+"::"+h.rev,delete f._id,delete f._rev;var g=u.put(f);g.onsuccess=d,g.onerror=function(e){e.preventDefault(),e.stopPropagation(),u.index("_doc_id_rev").getKey(f._doc_id_rev).onsuccess=function(e){u.put(f,e.target.result).onsuccess=d}}}!function(e,t,n){if(!e.length)return n();var r,i=0;function o(){i++,e.length===i&&(r?n(r):n())}e.forEach(function(e){var n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],i=0;if(!n.length)return o();function s(e){r=e,++i===n.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&Fn(e.data._attachments[a],t,s)})}(p,k,function(t){if(t)return o(t);!function(){var t=nr(i,[Un,$n,zn,Hn,Yn,Jn],"readwrite");if(t.error)return o(t.error);(s=t.txn).onabort=Wn(o),s.ontimeout=Wn(o),s.oncomplete=O,a=s.objectStore(Un),u=s.objectStore($n),c=s.objectStore(zn),l=s.objectStore(Yn),(f=s.objectStore(Jn)).get(Jn).onsuccess=function(e){d=e.target.result,E()},function(e){var t=[];if(p.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(n){var r=e.data._attachments[n];r.stub&&t.push(r.digest)})}),!t.length)return e();var n,r=0;t.forEach(function(i){!function(e,t){c.get(e).onsuccess=function(n){if(n.target.result)t();else{var r=Xe(Ge,"unknown stub attachment with digest "+e);r.status=412,t(r)}}}(i,function(i){i&&!n&&(n=i),++r===t.length&&e(n)})})}(function(t){if(t)return C=!0,o(t);!function(){if(!p.length)return;var t=0;function i(){++t===p.length&&Nn(e.revs_limit,p,r,_,s,w,S,n,A)}function o(e){var t=Gn(e.target.result);t&&_.set(t.id,t),i()}for(var u=0,c=p.length;u<c;u++){var l=p[u];if(l._id&&zt(l._id))i();else{var f=a.get(l.metadata.id);f.onsuccess=o}}}()})}()})}function or(e,t,n,r,i){var o,s,a;function u(e){s=e.target.result,o&&i(o,s,a)}function c(e){o=e.target.result,s&&i(o,s,a)}function l(e){var t=e.target.result;if(!t)return i();i([t.key],[t.value],t)}-1===r&&(r=1e3),"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&r>1&&!n?(a={continue:function(){if(!o.length)return i();var n,a=o[o.length-1];if(t&&t.upper)try{n=IDBKeyRange.bound(a,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else n=IDBKeyRange.lowerBound(a,!0);t=n,o=null,s=null,e.getAll(t,r).onsuccess=u,e.getAllKeys(t,r).onsuccess=c}},e.getAll(t,r).onsuccess=u,e.getAllKeys(t,r).onsuccess=c):n?e.openCursor(t,"prev").onsuccess=l:e.openCursor(t).onsuccess=l}function sr(e,t,n){var r,i,o="startkey"in e&&e.startkey,s="endkey"in e&&e.endkey,a="key"in e&&e.key,u="keys"in e&&e.keys,c=e.skip||0,l="number"==typeof e.limit?e.limit:-1,f=!1!==e.inclusive_end;if(!u&&(i=(r=function(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(e){return{error:e}}return null}(o,s,f,a,e.descending))&&r.error)&&("DataError"!==i.name||0!==i.code))return n(Xe(We,i.name,i.message));var h=[Un,$n,Jn];e.attachments&&h.push(zn);var d=nr(t,h,"readonly");if(d.error)return n(d.error);var p=d.txn;p.oncomplete=function(){e.attachments?er(_,e.binary).then(E):E()},p.onabort=Wn(n);var g,v,y=p.objectStore(Un),m=p.objectStore($n),b=p.objectStore(Jn),w=m.index("_doc_id_rev"),_=[];function C(t,n){var r={id:n.id,key:n.id,value:{rev:t}};n.deleted?u&&(_.push(r),r.value.deleted=!0,r.doc=null):c--<=0&&(_.push(r),e.include_docs&&function(t,n,r){var i=t.id+"::"+r;w.get(i).onsuccess=function(r){if(n.doc=Xn(r.target.result)||{},e.conflicts){var i=Pt(t);i.length&&(n.doc._conflicts=i)}Zn(n.doc,e,p)}}(n,r,t))}function k(e){for(var t=0,n=e.length;t<n&&_.length!==l;t++){var r=e[t];if(r.error&&u)_.push(r);else{var i=Gn(r);C(i.winningRev,i)}}}function A(e,t,n){n&&(k(t),_.length<l&&n.continue())}function E(){var t={total_rows:g,offset:e.skip,rows:_};e.update_seq&&void 0!==v&&(t.update_seq=v),n(null,t)}return b.get(Jn).onsuccess=function(e){g=e.target.result.docCount},e.update_seq&&function(e,t){e.openCursor(null,"prev").onsuccess=function(e){var n=e.target.result,r=void 0;n&&n.key&&(r=n.key);return t({target:{result:[r]}})}}(m,function(e){e.target.result&&e.target.result.length>0&&(v=e.target.result[0])}),i||0===l?void 0:u?function(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(o,s){t.get(o).onsuccess=function(t){t.target.result?r[s]=t.target.result:r[s]={key:o,error:"not_found"},++i===e.length&&n(e,r,{})}})}(e.keys,y,A):-1===l?function(e,t,n){if("function"!=typeof e.getAll){var r=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(r.push(t.value),t.continue()):n({target:{result:r}})}}else e.getAll(t).onsuccess=n}(y,r,function(t){var n=t.target.result;e.descending&&(n=n.reverse()),k(n)}):void or(y,r,e.descending,l+c,A)}var ar=!1,ur=[];function cr(){!ar&&ur.length&&(ar=!0,ur.shift()())}function lr(e,t,n,r){if((e=ge(e)).continuous){var i=n+":"+St();return rr.addListener(n,i,t,e),rr.notify(n),{cancel:function(){rr.removeListener(n,i)}}}var o=e.doc_ids&&new fe(e.doc_ids);e.since=e.since||0;var s=e.since,a="limit"in e?e.limit:-1;0===a&&(a=1);var u,c,l,f,h=[],d=0,p=Ze(e),g=new he;function v(e,t,n,r){if(n.seq!==t)return r();if(n.winningRev===e._rev)return r(n,e);var i=e._id+"::"+n.winningRev;f.get(i).onsuccess=function(e){r(n,Xn(e.target.result))}}function y(){e.complete(null,{results:h,last_seq:s})}var m=[Un,$n];e.attachments&&m.push(zn);var b=nr(r,m,"readonly");if(b.error)return e.complete(b.error);(u=b.txn).onabort=Wn(e.complete),u.oncomplete=function(){!e.continuous&&e.attachments?er(h).then(y):y()},c=u.objectStore($n),l=u.objectStore(Un),f=c.index("_doc_id_rev"),or(c,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,a,function(t,n,r){if(r&&t.length){var i=new Array(t.length),c=new Array(t.length),f=0;n.forEach(function(n,s){!function(e,t,n){if(o&&!o.has(e._id))return n();var r=g.get(e._id);if(r)return v(e,t,r,n);l.get(e._id).onsuccess=function(i){r=Gn(i.target.result),g.set(e._id,r),v(e,t,r,n)}}(Xn(n),t[s],function(n,o){c[s]=n,i[s]=o,++f===t.length&&function(){for(var t=[],n=0,o=i.length;n<o&&d!==a;n++){var s=i[n];if(s){var u=c[n];t.push(y(u,s))}}Promise.all(t).then(function(t){for(var n=0,r=t.length;n<r;n++)t[n]&&e.onChange(t[n])}).catch(e.complete),d!==a&&r.continue()}()})})}function y(t,n){var r=e.processChange(n,t,e);s=r.seq=t.seq;var i=p(r);return"object"==typeof i?Promise.reject(i):i?(d++,e.return_docs&&h.push(r),e.attachments&&e.include_docs?new Promise(function(t){Zn(n,e,u,function(){er([r],e.binary).then(function(){t(r)})})}):Promise.resolve(r)):Promise.resolve()}})}var fr,hr=new he,dr=new he;function pr(e,t){var n=this;!function(e,t,n){ur.push(function(){e(function(e,r){!function(e,t,n,r){try{e(t,n)}catch(t){r.emit("error",t)}}(t,e,r,n),ar=!1,N(function(){cr()})})}),cr()}(function(t){!function(e,t,n){var r=t.name,i=null;function o(e,t){var n=e.objectStore(Un);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var r=e.target.result;if(r){var i=r.value,o=$t(i);i.deletedOrLocal=o?"1":"0",n.put(i),r.continue()}else t()}}function s(e,t){var n=e.objectStore(Hn),r=e.objectStore(Un),i=e.objectStore($n),o=r.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var s=o.value,a=s.id,u=zt(a),c=xt(s);if(u){var l=a+"::"+c,f=a+"::",h=a+"::~",d=i.index("_doc_id_rev"),p=IDBKeyRange.bound(f,h,!1,!1),g=d.openCursor(p);g.onsuccess=function(e){if(g=e.target.result){var t=g.value;t._doc_id_rev===l&&n.put(t),i.delete(g.primaryKey),g.continue()}else r.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function a(e,t){var n=e.objectStore($n),r=e.objectStore(zn),i=e.objectStore(Yn),o=r.count();o.onsuccess=function(e){var r=e.target.result;if(!r)return t();n.openCursor().onsuccess=function(e){var n=e.target.result;if(!n)return t();for(var r=n.value,o=n.primaryKey,s=Object.keys(r._attachments||{}),a={},u=0;u<s.length;u++){var c=r._attachments[s[u]];a[c.digest]=!0}var l=Object.keys(a);for(u=0;u<l.length;u++){var f=l[u];i.put({seq:o,digestSeq:f+"::"+o})}n.continue()}}}function u(e){var t=e.objectStore($n),n=e.objectStore(Un),r=n.openCursor();r.onsuccess=function(e){var r=e.target.result;if(r){var i,o,s,a,u=function(e){if(!e.data)return e.deleted="1"===e.deletedOrLocal,e;return Gn(e)}(r.value);if(u.winningRev=u.winningRev||xt(u),u.seq)return c();i=u.id+"::",o=u.id+"::￿",s=t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(i,o)),a=0,s.onsuccess=function(e){var t=e.target.result;if(!t)return u.seq=a,c();var n=t.primaryKey;n>a&&(a=n),t.continue()}}function c(){var e=Kn(u,u.winningRev,u.deleted),t=n.put(e);t.onsuccess=function(){r.continue()}}}}e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=ye(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(n,r,o){ir(t,n,r,e,i,o)},e._get=function(e,t,n){var r,o,s,a=t.ctx;if(!a){var u=nr(i,[Un,$n,zn],"readonly");if(u.error)return n(u.error);a=u.txn}function c(){n(s,{doc:r,metadata:o,ctx:a})}a.objectStore(Un).get(e).onsuccess=function(e){if(!(o=Gn(e.target.result)))return s=Xe(Fe,"missing"),c();var n;if(t.rev)n=t.latest?function(e,t){for(var n,r=t.rev_tree.slice();n=r.pop();){var i=n.pos,o=n.ids,s=o[0],a=o[1],u=o[2],c=0===u.length,l=n.history?n.history.slice():[];if(l.push({id:s,pos:i,opts:a}),c)for(var f=0,h=l.length;f<h;f++){var d=l[f];if(d.pos+"-"+d.id===e)return i+"-"+s}for(var p=0,g=u.length;p<g;p++)r.push({pos:i+1,ids:u[p],history:l})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(t.rev,o):t.rev;else{n=o.winningRev;var i=$t(o);if(i)return s=Xe(Fe,"deleted"),c()}var u=a.objectStore($n),l=o.id+"::"+n;u.index("_doc_id_rev").get(l).onsuccess=function(e){if((r=e.target.result)&&(r=Xn(r)),!r)return s=Xe(Fe,"missing"),c();c()}}},e._getAttachment=function(e,t,n,r,o){var s;if(r.ctx)s=r.ctx;else{var a=nr(i,[Un,$n,zn],"readonly");if(a.error)return o(a.error);s=a.txn}var u=n.digest,c=n.content_type;s.objectStore(zn).get(u).onsuccess=function(e){var t=e.target.result.body;Qn(t,c,r.binary,function(e){o(null,e)})}},e._info=function(t){var n,r,o=nr(i,[Jn,$n],"readonly");if(o.error)return t(o.error);var s=o.txn;s.objectStore(Jn).get(Jn).onsuccess=function(e){r=e.target.result.docCount},s.objectStore($n).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0},s.oncomplete=function(){t(null,{doc_count:r,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){sr(e,i,t)},e._changes=function(t){return lr(t,e,r,i)},e._close=function(e){i.close(),hr.delete(r),e()},e._getRevisionTree=function(e,t){var n=nr(i,[Un],"readonly");if(n.error)return t(n.error);var r=n.txn,o=r.objectStore(Un).get(e);o.onsuccess=function(e){var n=Gn(e.target.result);n?t(null,n.rev_tree):t(Xe(Fe))}},e._doCompaction=function(e,t,n){var r=[Un,$n,zn,Yn],o=nr(i,r,"readwrite");if(o.error)return n(o.error);var s=o.txn,a=s.objectStore(Un);a.get(e).onsuccess=function(n){var r=Gn(n.target.result);It(r.rev_tree,function(e,n,r,i,o){var s=n+"-"+r;-1!==t.indexOf(s)&&(o.status="missing")}),tr(t,e,s);var i=r.winningRev,o=r.deleted;s.objectStore(Un).put(Kn(r,i,o))},s.onabort=Wn(n),s.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=nr(i,[Hn],"readonly");if(n.error)return t(n.error);var r=n.txn,o=r.objectStore(Hn).get(e);o.onerror=Wn(t),o.onsuccess=function(e){var n=e.target.result;n?(delete n._doc_id_rev,t(null,n)):t(Xe(Fe))}},e._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),delete e._revisions;var r=e._rev,o=e._id;e._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var s,a=t.ctx;if(!a){var u=nr(i,[Hn],"readwrite");if(u.error)return n(u.error);(a=u.txn).onerror=Wn(n),a.oncomplete=function(){s&&n(null,s)}}var c,l=a.objectStore(Hn);r?(c=l.get(o)).onsuccess=function(i){var o=i.target.result;if(o&&o._rev===r){var a=l.put(e);a.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,s)}}else n(Xe(Le))}:((c=l.add(e)).onerror=function(e){n(Xe(Le)),e.preventDefault(),e.stopPropagation()},c.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,s)})},e._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={});var r,o=t.ctx;if(!o){var s=nr(i,[Hn],"readwrite");if(s.error)return n(s.error);(o=s.txn).oncomplete=function(){r&&n(null,r)}}var a=e._id,u=o.objectStore(Hn),c=u.get(a);c.onerror=Wn(n),c.onsuccess=function(i){var o=i.target.result;o&&o._rev===e._rev?(u.delete(a),r={ok:!0,id:a,rev:"0-0"},t.ctx&&n(null,r)):n(Xe(Fe))}},e._destroy=function(e,t){rr.removeAllListeners(r);var n=dr.get(r);n&&n.result&&(n.result.close(),hr.delete(r));var i=indexedDB.deleteDatabase(r);i.onsuccess=function(){dr.delete(r),Ie()&&r in localStorage&&delete localStorage[r],t(null,{ok:!0})},i.onerror=Wn(t)};var c=hr.get(r);if(c)return i=c.idb,e._meta=c.global,N(function(){n(null,e)});var l=indexedDB.open(r,Mn);dr.set(r,l),l.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(Un,{keyPath:"id"});e.createObjectStore($n,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(zn,{keyPath:"digest"}),e.createObjectStore(Jn,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(Vn),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(Hn,{keyPath:"_id"});var n=e.createObjectStore(Yn,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n=e.currentTarget.transaction;e.oldVersion<3&&function(e){e.createObjectStore(Hn,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(t),e.oldVersion<4&&function(e){var t=e.createObjectStore(Yn,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var r=[o,s,a,u],i=e.oldVersion;!function e(){var t=r[i-1];i++;t&&t(n,e)}()},l.onsuccess=function(t){(i=t.target.result).onversionchange=function(){i.close(),hr.delete(r)},i.onabort=function(e){Be("error","Database has a global failure",e.target.error),i.close(),hr.delete(r)};var o,s,a,u,c=i.transaction([Jn,Vn,Un],"readwrite"),l=!1;function f(){void 0!==a&&l&&(e._meta={name:r,instanceId:u,blobSupport:a},hr.set(r,{idb:i,global:e._meta}),n(null,e))}function h(){if(void 0!==s&&void 0!==o){var e=r+"_id";e in o?u=o[e]:o[e]=u=St(),o.docCount=s,c.objectStore(Jn).put(o)}}c.objectStore(Jn).get(Jn).onsuccess=function(e){o=e.target.result||{id:Jn},h()},function(e,t){e.objectStore(Un).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}(c,function(e){s=e,h()}),fr||(fr=function(e){return new Promise(function(t){var n=pt([""]),r=e.objectStore(Vn).put(n,"key");r.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)},r.onerror=e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}}).catch(function(){return!1})}(c)),fr.then(function(e){a=e,f()}),c.oncomplete=function(){l=!0,f()},c.onabort=Wn(n)},l.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";Be("error",e),n(Xe(We,e))}}(n,e,t)},t,n.constructor)}pr.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var gr=25,vr=50,yr=5e3,mr=1e4,br={};function wr(e){var t=(e.doc||e.ok)._attachments;t&&Object.keys(t).forEach(function(e){var n=t[e];n.data=vt(n.data,n.content_type)})}function _r(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Cr(e){return e._attachments&&Object.keys(e._attachments)?Promise.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&"string"!=typeof n.data)return new Promise(function(e){bt(n.data,e)}).then(function(e){n.data=e})})):Promise.resolve()}function kr(e,t){if(function(e){if(!e.prefix)return!1;var t=ct(e.prefix).protocol;return"http"===t||"https"===t}(t)){var n=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)}var r=ct(e);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var i=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=i.pop(),-1===r.db.indexOf("%")&&(r.db=encodeURIComponent(r.db)),r.path=i.join("/"),r}function Ar(e,t){return Er(e,e.db+"/"+t)}function Er(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function Or(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function Sr(e,t){var n=this,r=kr(e.name,e),i=Ar(r,"");e=ge(e);var o,s=function(t,n){if((n=n||{}).headers=n.headers||new en,e.auth||r.auth){var i=e.auth||r.auth,o=i.username+":"+i.password,s=dt(unescape(encodeURIComponent(o)));n.headers.set("Authorization","Basic "+s)}var a=e.headers||{};return Object.keys(a).forEach(function(e){n.headers.append(e,a[e])}),function(e){var t="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==t.indexOf("msie"),r=-1!==t.indexOf("trident"),i=-1!==t.indexOf("edge"),o=!("method"in e)||"GET"===e.method;return(n||r||i)&&o}(n)&&(t+=(-1===t.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(e.fetch||Zt)(t,n)};function a(e,t){return me(e,O(function(e){c().then(function(){return t.apply(this,e)}).catch(function(t){e.pop()(t)})})).bind(n)}function u(e,t,n){var r={};return(t=t||{}).headers=t.headers||new en,t.headers.get("Content-Type")||t.headers.set("Content-Type","application/json"),t.headers.get("Accept")||t.headers.set("Accept","application/json"),s(e,t).then(function(e){return r.ok=e.ok,r.status=e.status,e.json()}).then(function(e){if(r.data=e,!r.ok){r.data.status=r.status;var t=Qe(r.data);if(n)return n(t);throw t}if(Array.isArray(r.data)&&(r.data=r.data.map(function(e){return e.error||e.missing?Qe(e):e})),!n)return r;n(null,r.data)})}function c(){return e.skip_setup?Promise.resolve():o||((o=u(i).catch(function(e){return e&&e.status&&404===e.status?(je(404,"PouchDB is just detecting if the remote exists."),u(i,{method:"PUT"})):Promise.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||Promise.reject(e)})).catch(function(){o=null}),o)}function l(e){return e.split("/").map(encodeURIComponent).join("/")}N(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=a("id",function(e){s(Er(r,"")).then(function(e){return e.json()}).then(function(t){var n=t&&t.uuid?t.uuid+r.db:Ar(r,"");e(null,n)}).catch(function(t){e(t)})}),n.compact=a("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=ge(e),u(Ar(r,"_compact"),{method:"POST"}).then(function(){!function r(){n.info(function(n,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(r,e.interval||200)})}()})}),n.bulkGet=me("bulkGet",function(e,t){var n=this;function i(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),u(Ar(r,"_bulk_get"+Or(n)),{method:"POST",body:JSON.stringify({docs:e.docs})}).then(function(n){e.attachments&&e.binary&&n.data.results.forEach(function(e){e.docs.forEach(wr)}),t(null,n.data)}).catch(t)}function o(){var r=vr,i=Math.ceil(e.docs.length/r),o=0,s=new Array(i);function a(e){return function(n,r){s[e]=r.results,++o===i&&t(null,{results:et(s)})}}for(var u=0;u<i;u++){var c=ke(e,["revs","attachments","binary","latest"]);c.docs=e.docs.slice(u*r,Math.min(e.docs.length,(u+1)*r)),xe(n,c,a(u))}}var s=Er(r,""),a=br[s];"boolean"!=typeof a?i(function(e,n){e?(br[s]=!1,je(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(br[s]=!0,t(null,n))}):a?i(t):o()}),n._info=function(e){c().then(function(){return s(Ar(r,""))}).then(function(e){return e.json()}).then(function(t){t.host=Ar(r,""),e(null,t)}).catch(e)},n.fetch=function(e,t){return c().then(function(){return s(Ar(r,e),t)})},n.get=a("get",function(e,t,n){"function"==typeof t&&(n=t,t={});var i={};function o(e){var n=e._attachments,i=n&&Object.keys(n);if(n&&i.length)return function(e,t){return new Promise(function(n,r){var i,o=0,s=0,a=0,u=e.length;function c(){++a===u?i?r(i):n():h()}function l(){o--,c()}function f(e){o--,i=i||e,c()}function h(){for(;o<t&&s<u;)o++,e[s++]().then(l,f)}h()})}(i.map(function(i){return function(){return function(i){var o=n[i],a=_r(e._id)+"/"+l(i)+"?rev="+e._rev;return s(Ar(r,a)).then(function(e){return void 0===A||E?e.blob():e.buffer()}).then(function(e){return t.binary?(void 0===A||E||(e.type=o.content_type),e):new Promise(function(t){bt(e,t)})}).then(function(e){delete o.stub,delete o.length,o.data=e})}(i)}}),5)}(t=ge(t)).revs&&(i.revs=!0),t.revs_info&&(i.revs_info=!0),t.latest&&(i.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),i.open_revs=t.open_revs),t.rev&&(i.rev=t.rev),t.conflicts&&(i.conflicts=t.conflicts),t.update_seq&&(i.update_seq=t.update_seq),e=_r(e),u(Ar(r,e+Or(i))).then(function(e){return Promise.resolve().then(function(){if(t.attachments)return n=e.data,Array.isArray(n)?Promise.all(n.map(function(e){if(e.ok)return o(e.ok)})):o(n);var n}).then(function(){n(null,e.data)})}).catch(function(t){t.docId=e,n(t)})}),n.remove=a("remove",function(e,t,n,i){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(o=e,"function"==typeof t?(i=t,n={}):(i=n,n=t));var s=o._rev||n.rev;u(Ar(r,_r(o._id))+"?rev="+s,{method:"DELETE"},i).catch(i)}),n.getAttachment=a("getAttachment",function(e,t,n,i){"function"==typeof n&&(i=n,n={});var o,a=n.rev?"?rev="+n.rev:"",u=Ar(r,_r(e))+"/"+l(t)+a;s(u,{method:"GET"}).then(function(e){if(o=e.headers.get("content-type"),e.ok)return void 0===A||E?e.blob():e.buffer();throw e}).then(function(e){void 0===A||E||(e.type=o),i(null,e)}).catch(function(e){i(e)})}),n.removeAttachment=a("removeAttachment",function(e,t,n,i){u(Ar(r,_r(e)+"/"+l(t))+"?rev="+n,{method:"DELETE"},i).catch(i)}),n.putAttachment=a("putAttachment",function(e,t,n,i,o,s){"function"==typeof o&&(s=o,o=i,i=n,n=null);var a=_r(e)+"/"+l(t),c=Ar(r,a);if(n&&(c+="?rev="+n),"string"==typeof i){var f;try{f=ht(i)}catch(e){return s(Xe(ze,"Attachment is not a valid base64 string"))}i=f?gt(f,o):""}u(c,{headers:new en({"Content-Type":o}),method:"PUT",body:i},s).catch(s)}),n._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,c().then(function(){return Promise.all(e.docs.map(Cr))}).then(function(){return u(Ar(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},n)}).catch(n)},n._put=function(e,t,n){c().then(function(){return Cr(e)}).then(function(){return u(Ar(r,_r(e._id)),{method:"PUT",body:JSON.stringify(e)})}).then(function(e){n(null,e.data)}).catch(function(t){t.docId=e&&e._id,n(t)})},n.allDocs=a("allDocs",function(e,t){"function"==typeof e&&(t=e,e={});var n,i={},o="GET";(e=ge(e)).conflicts&&(i.conflicts=!0),e.update_seq&&(i.update_seq=!0),e.descending&&(i.descending=!0),e.include_docs&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.key&&(i.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(i.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(i.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(i.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(i.limit=e.limit),void 0!==e.skip&&(i.skip=e.skip);var s=Or(i);void 0!==e.keys&&(o="POST",n={keys:e.keys}),u(Ar(r,"_all_docs"+s),{method:o,body:JSON.stringify(n)}).then(function(n){e.include_docs&&e.attachments&&e.binary&&n.data.rows.forEach(wr),t(null,n.data)}).catch(t)}),n._changes=function(e){var t="batch_size"in e?e.batch_size:gr;!(e=ge(e)).continuous||"heartbeat"in e||(e.heartbeat=mr);var n="timeout"in e?e.timeout:3e4;"timeout"in e&&e.timeout&&n-e.timeout<yr&&(n=e.timeout+yr),"heartbeat"in e&&e.heartbeat&&n-e.heartbeat<yr&&(n=e.heartbeat+yr);var i={};"timeout"in e&&e.timeout&&(i.timeout=e.timeout);var o=void 0!==e.limit&&e.limit,s=o;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.seq_interval&&(i.seq_interval=e.seq_interval),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.update_seq&&(i.update_seq=!0),"heartbeat"in e&&e.heartbeat&&(i.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter),e.view&&"string"==typeof e.view&&(i.filter="_view",i.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var a in e.query_params)e.query_params.hasOwnProperty(a)&&(i[a]=e.query_params[a]);var l,f="GET";e.doc_ids?(i.filter="_doc_ids",f="POST",l={doc_ids:e.doc_ids}):e.selector&&(i.filter="_selector",f="POST",l={selector:e.selector});var h,d=new Qt,p=function(n,a){if(!e.aborted){i.since=n,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),e.descending?o&&(i.limit=s):i.limit=!o||s>t?t:s;var p=Ar(r,"_changes"+Or(i)),g={signal:d.signal,method:f,body:JSON.stringify(l)};h=n,e.aborted||c().then(function(){return u(p,g,a)}).catch(a)}},g={results:[]},v=function(n,r){if(!e.aborted){var i=0;if(r&&r.results){i=r.results.length,g.last_seq=r.last_seq;var a=null,u=null;"number"==typeof r.pending&&(a=r.pending),"string"!=typeof g.last_seq&&"number"!=typeof g.last_seq||(u=g.last_seq);e.query_params,r.results=r.results.filter(function(t){s--;var n=Ze(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&wr(t),e.return_docs&&g.results.push(t),e.onChange(t,a,u)),n})}else if(n)return e.aborted=!0,void e.complete(n);r&&r.last_seq&&(h=r.last_seq);var c=o&&s<=0||r&&i<t||e.descending;(!e.continuous||o&&s<=0)&&c?e.complete(null,g):N(function(){p(h,v)})}};return p(e.since||0,v),{cancel:function(){e.aborted=!0,d.abort()}}},n.revsDiff=a("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),u(Ar(r,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},n).catch(n)}),n._close=function(e){e()},n._destroy=function(e,t){u(Ar(r,""),{method:"DELETE"}).then(function(e){t(null,e)}).catch(function(e){404===e.status?t(null,{ok:!0}):t(e)})}}function xr(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,xr)}catch(e){}}function Ir(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Ir)}catch(e){}}function Tr(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Tr)}catch(e){}}function Br(e,t){return t&&e.then(function(e){N(function(){t(null,e)})},function(e){N(function(){t(e)})}),e}function Pr(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function jr(e){var t=new fe(e),n=new Array(t.size),r=-1;return t.forEach(function(e){n[++r]=e}),n}function Rr(e){var t=new Array(e.size),n=-1;return e.forEach(function(e,r){t[++n]=r}),t}function Dr(e){return new Tr("builtin "+e+" function requires map values to be numbers or number arrays")}function qr(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if("number"!=typeof i){if(!Array.isArray(i))throw Dr("_sum");t="number"==typeof t?[t]:t;for(var o=0,s=i.length;o<s;o++){var a=i[o];if("number"!=typeof a)throw Dr("_sum");void 0===t[o]?t.push(a):t[o]+=a}}else"number"==typeof t?t+=i:t[0]+=i}return t}Sr.valid=function(){return!0},W(xr,Error),W(Ir,Error),W(Tr,Error);var Fr=Be.bind(null,"log"),Lr=Array.isArray,Nr=JSON.parse;function Mr(e,t){return lt("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:qr,log:Fr,isArray:Lr,toJSON:Nr})}function Ur(){this.promise=new Promise(function(e){e()})}function $r(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function zr(e,t,n,r,i,o){var s,a=function(e,t){return $r(e)+$r(t)+"undefined"}(n,r);if(!i&&(s=e._cachedViews=e._cachedViews||{})[a])return s[a];var u=e.info().then(function(u){var c=u.db_name+"-mrview-"+(i?"temp":Et(a));return ft(e,"_local/"+o,function(e){e.views=e.views||{};var n=t;-1===n.indexOf("/")&&(n=t+"/"+t);var r=e.views[n]=e.views[n]||{};if(!r[c])return r[c]=!0,e}).then(function(){return e.registerDependentDatabase(c).then(function(t){var i=t.db;i.auto_compaction=!0;var o={name:c,db:i,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};return o.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,s&&o.db.once("destroyed",function(){delete s[a]}),o})})})});return s&&(s[a]=u),u}Ur.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},Ur.prototype.finish=function(){return this.promise};var Yr={},Jr=new Ur,Hr=50;function Vr(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Wr(e,t){try{e.emit("error",t)}catch(e){Be("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),Be("error",t)}}var Kr={_sum:function(e,t){return qr(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:qr(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];t+=i*i}return t}(t)}}};var Gr=function(e,t,n,r){function i(e,t,n){try{t(n)}catch(t){Wr(e,t)}}function o(e,t,n,r,i){try{return{output:t(n,r,i)}}catch(t){return Wr(e,t),{error:t}}}function s(e,t){var n=hn(e.key,t.key);return 0!==n?n:hn(e.value,t.value)}function a(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function u(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var n=t[e];t[e].data=vt(n.data,n.content_type)})})}(t),t}}function c(e,t,n,r){var i=t[e];void 0!==i&&(r&&(i=encodeURIComponent(JSON.stringify(i))),n.push(e+"="+i))}function l(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function f(e,t){var n=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if(void 0!==e[n]&&void 0!==e[r]&&hn(e[n],e[r])>0)throw new xr("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new xr("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new xr("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var n=function(e){if(e){if("number"!=typeof e)return new xr('Invalid value for integer: "'+e+'"');if(e<0)return new xr('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(n)throw n})}function h(e){return function(t){if(404===t.status)return e;throw t}}function d(e,t,n){var r="_local/doc_"+e,i={_id:r,keys:[]},o=n.get(e),s=o[0];return(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(o[1])?Promise.resolve(i):t.db.get(r).catch(h(i))).then(function(e){return function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Promise.resolve({rows:[]})}(e).then(function(t){return function(e,t){for(var n=[],r=new fe,i=0,o=t.rows.length;i<o;i++){var a=t.rows[i].doc;if(a&&(n.push(a),r.add(a._id),a._deleted=!s.has(a._id),!a._deleted)){var u=s.get(a._id);"value"in u&&(a.value=u.value)}}var c=Rr(s);return c.forEach(function(e){if(!r.has(e)){var t={_id:e},i=s.get(e);"value"in i&&(t.value=i.value),n.push(t)}}),e.keys=jr(c.concat(e.keys)),n.push(e),n}(e,t)})})}function p(e){var t="string"==typeof e?e:e.name,n=Yr[t];return n||(n=Yr[t]=new Ur),n}function g(e){return Pr(p(e),function(){return function(e){var n,r,o=t(e.mapFun,function(e,t){var i={id:r._id,key:dn(e)};null!=t&&(i.value=dn(t)),n.push(i)}),a=e.seq||0;function u(t,n){return function(){return function(e,t,n){return e.db.get("_local/lastSeq").catch(h({_id:"_local/lastSeq",seq:0})).then(function(r){var i=Rr(t);return Promise.all(i.map(function(n){return d(n,e,t)})).then(function(t){var i=et(t);return r.seq=n,i.push(r),e.db.bulkDocs({docs:i})})})}(e,t,n)}}var c=new Ur;function l(){return e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:a,limit:Hr}).then(f)}function f(t){var f=t.results;if(f.length){var h=function(t){for(var u=new he,c=0,l=t.length;c<l;c++){var f=t[c];if("_"!==f.doc._id[0]){n=[],(r=f.doc)._deleted||i(e.sourceDB,o,r),n.sort(s);var h=p(n);u.set(f.doc._id,[h,f.changes])}a=f.seq}return u}(f);if(c.add(u(h,a)),!(f.length<Hr))return l()}}function p(e){for(var t,n=new he,r=0,i=e.length;r<i;r++){var o=e[r],s=[o.key,o.id];r>0&&0===hn(o.key,t)&&s.push(r),n.set(gn(s),o),t=o.key}return n}return l().then(function(){return c.finish()}).then(function(){e.seq=a})}(e)})()}function v(e,t){return Pr(p(e),function(){return function(e,t){var r,i=e.reduceFun&&!1!==t.reduce,s=t.skip||0;function u(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return r=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var r=function(e){for(var t=[],n=[],r=0;;){var i=e[r++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var o=vn(e,r);t.push(o.num),r+=o.length;break;case"4":for(var s="";;){var a=e[r];if("\0"===a)break;s+=a,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var u={element:[],index:t.length};t.push(u.element),n.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();yn(t,n)}}}(e.doc._id);return{key:r[0],id:r[1],value:"value"in e.doc?e.doc.value:null}})})}function c(u){var c;if(c=i?function(e,t,r){0===r.group_level&&delete r.group_level;var i=r.group||r.group_level,s=n(e.reduceFun),a=[],u=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;t.forEach(function(e){var t=a[a.length-1],n=i?e.key:null;if(i&&Array.isArray(n)&&(n=n.slice(0,u)),t&&0===hn(t.groupKey,n))return t.keys.push([e.key,e.id]),void t.values.push(e.value);a.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})}),t=[];for(var c=0,l=a.length;c<l;c++){var f=a[c],h=o(e.sourceDB,s,f.keys,f.values,!1);if(h.error&&h.error instanceof Tr)throw h.error;t.push({value:h.error?null:h.output,key:f.groupKey})}return{rows:function(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}(t,r.limit,r.skip)}}(e,u,t):{total_rows:r,offset:s,rows:u},t.update_seq&&(c.update_seq=e.seq),t.include_docs){var l=jr(u.map(a));return e.sourceDB.allDocs({keys:l,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new he;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),u.forEach(function(e){var n=a(e),r=t.get(n);r&&(e.doc=r)}),c})}return c}if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var l=t.keys,f=l.map(function(e){var n={startkey:gn([e]),endkey:gn([e,{}])};return t.update_seq&&(n.update_seq=!0),u(n)});return Promise.all(f).then(et).then(c)}var h,d,p={descending:t.descending};if(t.update_seq&&(p.update_seq=!0),"start_key"in t&&(h=t.start_key),"startkey"in t&&(h=t.startkey),"end_key"in t&&(d=t.end_key),"endkey"in t&&(d=t.endkey),void 0!==h&&(p.startkey=t.descending?gn([h,{}]):gn([h])),void 0!==d){var g=!1!==t.inclusive_end;t.descending&&(g=!g),p.endkey=gn(g?[d,{}]:[d])}if(void 0!==t.key){var v=gn([t.key]),y=gn([t.key,{}]);p.descending?(p.endkey=v,p.startkey=y):(p.startkey=v,p.endkey=y)}return i||("number"==typeof t.limit&&(p.limit=t.limit),p.skip=s),u(p).then(c)}(e,t)})()}function y(t,n,i){if("function"==typeof t._query)return function(e,t,n){return new Promise(function(r,i){e._query(t,n,function(e,t){if(e)return i(e);r(t)})})}(t,n,i);if(nt(t))return function(e,t,n){var r,i,o,s=[],a="GET";if(c("reduce",n,s),c("include_docs",n,s),c("attachments",n,s),c("limit",n,s),c("descending",n,s),c("group",n,s),c("group_level",n,s),c("skip",n,s),c("stale",n,s),c("conflicts",n,s),c("startkey",n,s,!0),c("start_key",n,s,!0),c("endkey",n,s,!0),c("end_key",n,s,!0),c("inclusive_end",n,s),c("key",n,s,!0),c("update_seq",n,s),s=""===(s=s.join("&"))?"":"?"+s,void 0!==n.keys){var l="keys="+encodeURIComponent(JSON.stringify(n.keys));l.length+s.length+1<=2e3?s+=("?"===s[0]?"&":"?")+l:(a="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){var f=Vr(t);return e.fetch("_design/"+f[0]+"/_view/"+f[1]+s,{headers:new en({"Content-Type":"application/json"}),method:a,body:JSON.stringify(r)}).then(function(e){return i=e.ok,o=e.status,e.json()}).then(function(e){if(!i)throw e.status=o,Qe(e);return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),e}).then(u(n))}return r=r||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()}),e.fetch("_temp_view"+s,{headers:new en({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(r)}).then(function(e){return i=e.ok,o=e.status,e.json()}).then(function(e){if(!i)throw e.status=o,Qe(e);return e}).then(u(n))}(t,n,i);if("string"!=typeof n)return f(i,n),Jr.add(function(){return zr(t,"temp_view/temp_view",n.map,n.reduce,!0,e).then(function(e){return t=g(e).then(function(){return v(e,i)}),n=function(){return e.db.destroy()},t.then(function(e){return n().then(function(){return e})},function(e){return n().then(function(){throw e})});var t,n})}),Jr.finish();var o=n,s=Vr(o),a=s[0],l=s[1];return t.get("_design/"+a).then(function(n){var s=n.views&&n.views[l];if(!s)throw new Ir("ddoc "+n._id+" has no view named "+l);return r(n,l),f(i,s),zr(t,o,s.map,s.reduce,!1,e).then(function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&N(function(){g(e)}),v(e,i)):g(e).then(function(){return v(e,i)})})})}var m;return{query:function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),t=t?function(e){return e.group_level=l(e.group_level),e.limit=l(e.limit),e.skip=l(e.skip),e}(t):{},"function"==typeof e&&(e={map:e});var i=Promise.resolve().then(function(){return y(r,e,t)});return Br(i,n),i},viewCleanup:(m=function(){var t=this;return"function"==typeof t._viewCleanup?function(e){return new Promise(function(t,n){e._viewCleanup(function(e,r){if(e)return n(e);t(r)})})}(t):nt(t)?function(e){return e.fetch("_view_cleanup",{headers:new en({"Content-Type":"application/json"}),method:"POST"}).then(function(e){return e.json()})}(t):function(t){return t.get("_local/"+e).then(function(e){var n=new he;Object.keys(e.views).forEach(function(e){var t=Vr(e),r="_design/"+t[0],i=t[1],o=n.get(r);o||(o=new fe,n.set(r,o)),o.add(i)});var r={keys:Rr(n),include_docs:!0};return t.allDocs(r).then(function(r){var i={};r.rows.forEach(function(t){var r=t.key.substring(8);n.get(t.key).forEach(function(n){var o=r+"/"+n;e.views[o]||(o=n);var s=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[n];s.forEach(function(e){i[e]=i[e]||a})})});var o=Object.keys(i).filter(function(e){return!i[e]}).map(function(e){return Pr(p(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Promise.all(o).then(function(){return{ok:!0}})})},h({ok:!0}))}(t)},O(function(e){var t=e.pop(),n=m.apply(this,e);return"function"==typeof t&&Br(n,t),n}))}}("mrviews",function(e,t){if("function"==typeof e&&2===e.length){var n=e;return function(e){return n(e,t)}}return Mr(e.toString(),t)},function(e){var t=e.toString(),n=function(e){if(/^_sum/.test(e))return Kr._sum;if(/^_count/.test(e))return Kr._count;if(/^_stats/.test(e))return Kr._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(t);return n||Mr(t)},function(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new Ir("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)});var Xr={query:function(e,t,n){return Gr.query.call(this,e,t,n)},viewCleanup:function(e){return Gr.viewCleanup.call(this,e)}};function Qr(e){return/^1-/.test(e)}function Zr(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(n){return e.getAttachment(t._id,n,{rev:t._rev})}))}function ei(e,t,n,r){n=ge(n);var i=[],o=!0;function s(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(r.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){var t;e.deleted||!e.doc||!Qr(e.value.rev)||(t=e.doc,t._attachments&&Object.keys(t._attachments).length>0)||function(e){return e._conflicts&&e._conflicts.length>0}(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,i.push(e.doc),delete n[e.id])})})}return Promise.resolve().then(function(){var e=Object.keys(n).filter(function(e){var t=n[e].missing;return 1===t.length&&Qr(t[0])});if(e.length>0)return s(e)}).then(function(){var s=function(e){var t=[];return Object.keys(e).forEach(function(n){e[n].missing.forEach(function(e){t.push({id:n,rev:e})})}),{docs:t,revs:!0,latest:!0}}(n);if(s.docs.length)return e.bulkGet(s).then(function(n){if(r.cancelled)throw new Error("cancelled");return Promise.all(n.results.map(function(n){return Promise.all(n.docs.map(function(n){var r=n.ok;return n.error&&(o=!1),r&&r._attachments?function(e,t,n){var r=nt(t)&&!nt(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(r){return Promise.all(i.map(function(i){return function(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}(r,n,i)?t.getAttachment(n._id,i):e.getAttachment(r._id,i)}))}).catch(function(e){if(404!==e.status)throw e;return Zr(t,n)}):Zr(t,n)}(t,e,r).then(function(e){var t=Object.keys(r._attachments);return e.forEach(function(e,n){var i=r._attachments[t[n]];delete i.stub,delete i.length,i.data=e}),r}):r}))})).then(function(e){i=i.concat(et(e).filter(Boolean))})})}).then(function(){return{ok:o,docs:i}})}var ti=1,ni="pouchdb",ri=5,ii=0;function oi(e,t,n,r,i){return e.get(t).catch(function(n){if(404===n.status)return"http"!==e.adapter&&"https"!==e.adapter||je(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:ni,version:ti};throw n}).then(function(o){if(!i.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter(function(e){return e.session_id!==r}),o.history.unshift({last_seq:n,session_id:r}),o.history=o.history.slice(0,ri),o.version=ti,o.replicator=ni,o.session_id=r,o.last_seq=n,e.put(o).catch(function(o){if(409===o.status)return oi(e,t,n,r,i);throw o})})}function si(e,t,n,r,i){this.src=e,this.target=t,this.id=n,this.returnValue=r,this.opts=i||{}}si.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},si.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?oi(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},si.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return oi(this.src,this.id,e,t,this.returnValue).catch(function(e){if(ci(e))return n.opts.writeSourceCheckpoint=!1,!0;throw e})}return Promise.resolve(!0)};var ai={undefined:function(e,t){return 0===hn(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){if(e.session_id===t.session_id)return{last_seq:e.last_seq,history:e.history};return function e(t,n){var r=t[0];var i=t.slice(1);var o=n[0];var s=n.slice(1);if(!r||0===n.length)return{last_seq:ii,history:[]};var a=r.session_id;if(ui(a,n))return{last_seq:r.last_seq,history:t};var u=o.session_id;if(ui(u,i))return{last_seq:o.last_seq,history:s};return e(i,s)}(e.history,t.history)}(t,e).last_seq}};function ui(e,t){var n=t[0],r=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||ui(e,r))}function ci(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}si.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(e){return e.last_seq||ii}).catch(function(e){if(404!==e.status)throw e;return ii}):e.target.get(e.id).then(function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||ii:e.src.get(e.id).then(function(e){return t.version!==e.version?ii:(n=t.version?t.version.toString():"undefined")in ai?ai[n](t,e):ii;var n},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:ii}).then(function(){return ii},function(n){return ci(n)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):ii});throw n})}).catch(function(e){if(404!==e.status)throw e;return ii})};var li=0;function fi(e,t,n){var r=n.doc_ids?n.doc_ids.sort(hn):"",i=n.filter?n.filter.toString():"",o="",s="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(function(e){return Object.keys(e).sort(hn).reduce(function(t,n){return t[n]=e[n],t},{})}(n.query_params))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+s+o+r+a;return new Promise(function(e){At(t,e)})}).then(function(e){return"_local/"+(e=e.replace(/\//g,".").replace(/\+/g,"_"))})}function hi(e,t,n,r,i){var o,s,a,u=[],c={seq:0,changes:[],docs:[]},l=!1,f=!1,h=!1,d=0,p=n.continuous||n.live||!1,g=n.batch_size||100,v=n.batches_limit||10,y=!1,m=n.doc_ids,b=n.selector,w=[],_=St();i=i||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var C={};function k(){return a?Promise.resolve():fi(e,t,n).then(function(i){s=i;var o={};o=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},a=new si(e,t,s,r,o)})}function A(){if(w=[],0!==o.docs.length){var e=o.docs,s={timeout:n.timeout};return t.bulkDocs({docs:e,new_edits:!1},s).then(function(t){if(r.cancelled)throw T(),new Error("cancelled");var n=Object.create(null);t.forEach(function(e){e.error&&(n[e.id]=e)});var o=Object.keys(n).length;i.doc_write_failures+=o,i.docs_written+=e.length-o,e.forEach(function(e){var t=n[e._id];if(t){i.errors.push(t);var o=(t.name||"").toLowerCase();if("unauthorized"!==o&&"forbidden"!==o)throw t;r.emit("denied",ge(t))}else w.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function E(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=d=o.seq;var e=ge(i);return w.length&&(e.docs=w,"number"==typeof o.pending&&(e.pending=o.pending,delete o.pending),r.emit("change",e)),l=!0,a.writeCheckpoint(o.seq,_).then(function(){if(l=!1,r.cancelled)throw T(),new Error("cancelled");o=void 0,R()}).catch(function(e){throw q(e),e})}function O(){return ei(e,t,o.diffs,r).then(function(e){o.error=!e.ok,e.docs.forEach(function(e){delete o.diffs[e._id],i.docs_read++,o.docs.push(e)})})}function S(){var e;r.cancelled||o||(0!==u.length?(o=u.shift(),(e={},o.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(r.cancelled)throw T(),new Error("cancelled");o.diffs=e})).then(O).then(A).then(E).then(S).catch(function(e){I("batch processing terminated with error",e)})):x(!0))}function x(e){0!==c.changes.length?(e||f||c.changes.length>=g)&&(u.push(c),c={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),S()):0!==u.length||o||((p&&C.live||f)&&(r.state="pending",r.emit("paused")),f&&T())}function I(e,t){h||(t.message||(t.message=e),i.ok=!1,i.status="aborting",u=[],c={seq:0,changes:[],docs:[]},T(t))}function T(o){if(!(h||r.cancelled&&(i.status="cancelled",l)))if(i.status=i.status||"complete",i.end_time=(new Date).toISOString(),i.last_seq=d,h=!0,o){(o=Xe(o)).result=i;var s=(o.name||"").toLowerCase();"unauthorized"===s||"forbidden"===s?(r.emit("error",o),r.removeAllListeners()):function(e,t,n,r){if(!1===e.retry)return t.emit("error",n),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=Pe),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=li};t.once("paused",function(){t.removeListener("active",i)}),t.once("active",i)}e.current_back_off=e.current_back_off||li,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}(n,r,o,function(){hi(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function B(e,t,i){if(r.cancelled)return T();"number"==typeof t&&(c.pending=t),Ze(n)(e)&&(c.seq=e.seq||i,c.changes.push(e),N(function(){x(0===u.length&&C.live)}))}function P(e){if(y=!1,r.cancelled)return T();if(e.results.length>0)C.since=e.results[e.results.length-1].seq,R(),x(!0);else{var t=function(){p?(C.live=!0,R()):f=!0,x(!0)};o||0!==e.results.length?t():(l=!0,a.writeCheckpoint(e.last_seq,_).then(function(){l=!1,i.last_seq=d=e.last_seq,t()}).catch(q))}}function j(e){if(y=!1,r.cancelled)return T();I("changes rejected",e)}function R(){if(!y&&!f&&u.length<v){y=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",i);var t=e.changes(C).on("change",B);t.then(o,o),t.then(P).catch(j),n.retry&&(r._changes=t,r._abortChanges=i)}function i(){t.cancel()}function o(){r.removeListener("cancel",i)}}function D(){k().then(function(){if(!r.cancelled)return a.getCheckpoint().then(function(e){C={since:d=e,limit:g,batch_size:g,style:"all_docs",doc_ids:m,selector:b,return_docs:!0},n.filter&&("string"!=typeof n.filter?C.include_docs=!0:C.filter=n.filter),"heartbeat"in n&&(C.heartbeat=n.heartbeat),"timeout"in n&&(C.timeout=n.timeout),n.query_params&&(C.query_params=n.query_params),n.view&&(C.view=n.view),R()});T()}).catch(function(e){I("getCheckpoint rejected with ",e)})}function q(e){l=!1,I("writeCheckpoint completed with error",e)}r.ready(e,t),r.cancelled?T():(r._addedListeners||(r.once("cancel",T),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(e){n.complete(null,e)})),r._addedListeners=!0),void 0===n.since?D():k().then(function(){return l=!0,a.writeCheckpoint(n.since,_)}).then(function(){l=!1,r.cancelled?T():(d=n.since,D())}).catch(q))}function di(){U.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise(function(t,n){e.once("complete",t),e.once("error",n)});e.then=function(e,n){return t.then(e,n)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function pi(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e,t):e}function gi(e,t,n,r){if("function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw Xe(He,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=ge(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var i=new di(n);return hi(pi(e,n),pi(t,n),n,i),i}function vi(e,t,n,r){return"function"==typeof n&&(r=n,n={}),void 0===n&&(n={}),(n=ge(n)).PouchConstructor=n.PouchConstructor||this,new yi(e=pi(e,n),t=pi(t,n),n,r)}function yi(e,t,n,r){var i=this;this.canceled=!1;var o=n.push?Re({},n,n.push):n,s=n.pull?Re({},n,n.pull):n;function a(e){i.emit("change",{direction:"pull",change:e})}function u(e){i.emit("change",{direction:"push",change:e})}function c(e){i.emit("denied",{direction:"push",doc:e})}function l(e){i.emit("denied",{direction:"pull",doc:e})}function f(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function h(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function d(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function p(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}this.push=gi(e,t,o),this.pull=gi(t,e,s),this.pushPaused=!0,this.pullPaused=!0;var g={};function v(e){return function(t,n){("change"===t&&(n===a||n===u)||"denied"===t&&(n===l||n===c)||"paused"===t&&(n===h||n===f)||"active"===t&&(n===p||n===d))&&(t in g||(g[t]={}),g[t][e]=!0,2===Object.keys(g[t]).length&&i.removeAllListeners(t))}}function y(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}n.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push))),this.on("newListener",function(e){"change"===e?(y(i.pull,"change",a),y(i.push,"change",u)):"denied"===e?(y(i.pull,"denied",l),y(i.push,"denied",c)):"active"===e?(y(i.pull,"active",p),y(i.push,"active",d)):"paused"===e&&(y(i.pull,"paused",h),y(i.push,"paused",f))}),this.on("removeListener",function(e){"change"===e?(i.pull.removeListener("change",a),i.push.removeListener("change",u)):"denied"===e?(i.pull.removeListener("denied",l),i.push.removeListener("denied",c)):"active"===e?(i.pull.removeListener("active",p),i.push.removeListener("active",d)):"paused"===e&&(i.pull.removeListener("paused",h),i.push.removeListener("paused",f))}),this.pull.on("removeListener",v("pull")),this.push.on("removeListener",v("push"));var m=Promise.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return i.emit("complete",t),r&&r(null,t),i.removeAllListeners(),t},function(e){if(i.cancel(),r?r(e):i.emit("error",e),i.removeAllListeners(),r)throw e});this.then=function(e,t){return m.then(e,t)},this.catch=function(e){return m.catch(e)}}function mi(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}W(di,U),di.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},di.prototype.ready=function(e,t){var n=this;function r(){n.cancel()}n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}))},W(yi,U),yi.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Xt.plugin(function(e){e.adapter("idb",pr,!0)}).plugin(function(e){e.adapter("http",Sr,!1),e.adapter("https",Sr,!1)}).plugin(Xr).plugin(function(e){e.replicate=gi,e.sync=vi,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(t,n,r){return e.constructor.replicate(t,e,n,r)},to:function(t,n,r){return e.constructor.replicate(e,t,n,r)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}}),W(mi,Error),mi.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var bi=new mi(401,"unauthorized","Name or password is incorrect."),wi=new mi(400,"bad_request","Missing JSON list of 'docs'"),_i=new mi(404,"not_found","missing"),Ci=new mi(409,"conflict","Document update conflict"),ki=new mi(400,"bad_request","_id field must contain a string"),Ai=new mi(412,"missing_id","_id is required for puts"),Ei=new mi(400,"bad_request","Only reserved document ids may start with underscore."),Oi=new mi(412,"precondition_failed","Database not open"),Si=new mi(500,"unknown_error","Database encountered an unknown error"),xi=new mi(500,"badarg","Some query argument is invalid"),Ii=new mi(400,"invalid_request","Request was invalid"),Ti=new mi(400,"query_parse_error","Some query parameter is invalid"),Bi=new mi(500,"doc_validation","Bad special document member"),Pi=new mi(400,"bad_request","Something wrong with the request"),ji=new mi(400,"bad_request","Document must be a JSON object"),Ri=new mi(404,"not_found","Database not found"),Di=new mi(500,"indexed_db_went_bad","unknown"),qi=new mi(500,"web_sql_went_bad","unknown"),Fi=new mi(500,"levelDB_went_went_bad","unknown"),Li=new mi(403,"forbidden","Forbidden by design doc validate_doc_update function"),Ni=new mi(400,"bad_request","Invalid rev format"),Mi=new mi(412,"file_exists","The database could not be created, the file already exists."),Ui=new mi(412,"missing_stub","A pre-existing attachment stub wasn't found"),$i=new mi(413,"invalid_url","Provided URL is invalid");var zi=Object.freeze({UNAUTHORIZED:bi,MISSING_BULK_DOCS:wi,MISSING_DOC:_i,REV_CONFLICT:Ci,INVALID_ID:ki,MISSING_ID:Ai,RESERVED_ID:Ei,NOT_OPEN:Oi,UNKNOWN_ERROR:Si,BAD_ARG:xi,INVALID_REQUEST:Ii,QUERY_PARSE_ERROR:Ti,DOC_VALIDATION:Bi,BAD_REQUEST:Pi,NOT_AN_OBJECT:ji,DB_MISSING:Ri,WSQ_ERROR:qi,LDB_ERROR:Fi,FORBIDDEN:Li,INVALID_REV:Ni,FILE_EXISTS:Mi,MISSING_STUB:Ui,IDB_ERROR:Di,INVALID_URL:$i,createError:function(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=mi.prototype,new n(t)},generateErrorFromResponse:function(e){if("object"!=typeof e){var t=e;(e=Si).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}});function Yi(e){return"$"+e}function Ji(e){return e.substring(1)}function Hi(){this._store={}}function Vi(e){if(this._store=new Hi,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}Hi.prototype.get=function(e){var t=Yi(e);return this._store[t]},Hi.prototype.set=function(e,t){var n=Yi(e);return this._store[n]=t,!0},Hi.prototype.has=function(e){return Yi(e)in this._store},Hi.prototype.delete=function(e){var t=Yi(e),n=t in this._store;return delete this._store[t],n},Hi.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n];e(this._store[i],i=Ji(i))}},Object.defineProperty(Hi.prototype,"size",{get:function(){return Object.keys(this._store).length}}),Vi.prototype.add=function(e){return this._store.set(e,!0)},Vi.prototype.has=function(e){return this._store.has(e)},Vi.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(Vi.prototype,"size",{get:function(){return this._store.size}});var Wi,Ki,Gi=S.MutationObserver||S.WebKitMutationObserver;if(Gi){var Xi=0,Qi=new Gi(no),Zi=S.document.createTextNode("");Qi.observe(Zi,{characterData:!0}),Wi=function(){Zi.data=Xi=++Xi%2}}else if(S.setImmediate||void 0===S.MessageChannel)Wi="document"in S&&"onreadystatechange"in S.document.createElement("script")?function(){var e=S.document.createElement("script");e.onreadystatechange=function(){no(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},S.document.documentElement.appendChild(e)}:function(){setTimeout(no,0)};else{var eo=new S.MessageChannel;eo.port1.onmessage=no,Wi=function(){eo.port2.postMessage(0)}}var to=[];function no(){var e,t;Ki=!0;for(var n=to.length;n;){for(t=to,to=[],e=-1;++e<n;)t[e]();n=to.length}Ki=!1}var ro=function(e){1!==to.push(e)||Ki||Wi()};var io=function(e){return atob(e)},oo=function(e){return btoa(e)};function so(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function ao(e,t){return function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}([so(e)],{type:t})}function uo(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(r)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}(n))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function co(e,t){uo(e,function(e){t(e)})}e.setImmediate||e.setTimeout;function lo(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}var fo,ho=Function.prototype.toString,po=ho.call(Object);function go(e){var t,n,r;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=go(e[n]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return lo(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&ho.call(n)==po}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=go(e[n]);void 0!==i&&(t[n]=i)}return t}function vo(e){return O(function(t){t=go(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),i=new Promise(function(r,i){var o,s,a;try{var u=(s=function(e,t){e?i(e):r(t)},a=!1,O(function(e){if(a)throw new Error("once called more than once");a=!0,s.apply(this,e)}));t.push(u),(o=e.apply(n,t))&&"function"==typeof o.then&&r(o)}catch(e){i(e)}});return r&&i.then(function(e){r(null,e)},r),i})}function yo(e,t){return vo(O(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var o=n[n.length-1];n[n.length-1]=function(n,r){var i=["api",e.name,t];i=i.concat(n?["error",n]:["success",r]),e.constructor.emit("debug",i),o(n,r)}}}(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(t,i){r.taskqueue.addTask(function(o){o?i(o):t(r[e].apply(r,n))})})}))}try{localStorage.setItem("_pouch_check_localstorage",1),fo=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){fo=!1}function mo(){return fo}function bo(){var e;U.call(this),this._listeners={},e=this,mo()&&addEventListener("storage",function(t){e.emit(t.key)})}function wo(e){return"write"===e}W(bo,U),bo.prototype.addListener=function(e,t,n,r){if(!this._listeners[t]){var i=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(i._listeners[t])if(o)o="waiting";else{o=!0;var e=function(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===o&&ro(s),o=!1}).on("error",function(){o=!1})}}},bo.prototype.removeListener=function(e,t){t in this._listeners&&(U.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},bo.prototype.notifyLocalWindows=function(e){mo()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},bo.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var _o=1e3,Co=60*_o,ko=60*Co,Ao=24*ko,Eo=365.25*Ao,Oo=function(e,t){t=t||{};var n,r=typeof e;if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*Eo;case"days":case"day":case"d":return n*Ao;case"hours":case"hour":case"hrs":case"hr":case"h":return n*ko;case"minutes":case"minute":case"mins":case"min":case"m":return n*Co;case"seconds":case"second":case"secs":case"sec":case"s":return n*_o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?So(n=e,Ao,"day")||So(n,ko,"hour")||So(n,Co,"minute")||So(n,_o,"second")||n+" ms":function(e){if(e>=Ao)return Math.round(e/Ao)+"d";if(e>=ko)return Math.round(e/ko)+"h";if(e>=Co)return Math.round(e/Co)+"m";if(e>=_o)return Math.round(e/_o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function So(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var xo=I(function(e,t){var n;function r(e){function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=s[u];n=i.call(e,o),s.splice(u,1),u--}return n}),t.formatArgs.call(e,s),(r.log||t.log||void 0).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Oo,t.names=[],t.skips=[],t.formatters={}}),Io=(xo.coerce,xo.disable,xo.enable,xo.enabled,xo.humanize,xo.names,xo.skips,xo.formatters,I(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==A&&"env"in A&&(e=A.env.DEBUG),e}(t=e.exports=xo).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}));Io.log,Io.formatArgs,Io.save,Io.load,Io.useColors,Io.storage,Io.colors;!function(e){e.AbstractConnector=class{constructor(t,n){if(this.y=t,null==n&&(n={}),null==n.role||"master"===n.role)this.role="master";else{if("slave"!==n.role)throw new Error("Role must be either 'master' or 'slave'!");this.role="slave"}this.log=e.debug("y:connector"),this.logMessage=e.debug("y:connector-message"),this.y.db.forwardAppliedOperations=n.forwardAppliedOperations||!1,this.role=n.role,this.connections={},this.isSynced=!1,this.userEventListeners=[],this.whenSyncedListeners=[],this.currentSyncTarget=null,this.syncingClients=[],this.forwardToSyncingClients=!1!==n.forwardToSyncingClients,this.debug=!0===n.debug,this.syncStep2=Promise.resolve(),this.broadcastOpBuffer=[],this.protocolVersion=11,this.authInfo=n.auth||null,this.checkAuth=n.checkAuth||function(){return Promise.resolve("write")},!0===n.generateUserId&&this.setUserId(e.utils.generateGuid())}resetAuth(e){this.authInfo!==e&&(this.authInfo=e,this.broadcast({type:"auth",auth:this.authInfo}))}reconnect(){return this.log("reconnecting.."),this.y.db.startGarbageCollector()}disconnect(){return this.log("discronnecting.."),this.connections={},this.isSynced=!1,this.currentSyncTarget=null,this.syncingClients=[],this.whenSyncedListeners=[],this.y.db.stopGarbageCollector(),this.y.db.whenTransactionsFinished()}repair(){for(var e in this.log("Repairing the state of Yjs. This can happen if messages get lost, and Yjs detects that something is wrong. If this happens often, please report an issue here: https://github.com/y-js/yjs/issues"),this.connections)this.connections[e].isSynced=!1;this.isSynced=!1,this.currentSyncTarget=null,this.findNextSyncTarget()}setUserId(e){return null==this.userId?(this.log('Set userId to "%s"',e),this.userId=e,this.y.db.setUserId(e)):null}onUserEvent(e){this.userEventListeners.push(e)}removeUserEventListener(e){this.userEventListeners=this.userEventListeners.filter(e=>{})}userLeft(e){if(null!=this.connections[e])for(var t of(this.log("User left: %s",e),delete this.connections[e],e===this.currentSyncTarget&&(this.currentSyncTarget=null,this.findNextSyncTarget()),this.syncingClients=this.syncingClients.filter(function(t){return t!==e}),this.userEventListeners))t({action:"userLeft",user:e})}userJoined(e,t){if(null==t)throw new Error("You must specify the role of the joined user!");if(null!=this.connections[e])throw new Error("This user already joined!");for(var n of(this.log("User joined: %s",e),this.connections[e]={isSynced:!1,role:t},this.userEventListeners))n({action:"userJoined",user:e,role:t});null==this.currentSyncTarget&&this.findNextSyncTarget()}whenSynced(e){this.isSynced?e():this.whenSyncedListeners.push(e)}findNextSyncTarget(){if(null==this.currentSyncTarget){var e=null;for(var t in this.connections)if(!this.connections[t].isSynced){e=t;break}var n=this;null!=e?(this.currentSyncTarget=e,this.y.db.requestTransaction(function*(){var t={type:"sync step 1",stateSet:yield*this.getStateSet(),deleteSet:yield*this.getDeleteSet(),protocolVersion:n.protocolVersion,auth:n.authInfo};n.send(e,t)})):n.isSynced||this.y.db.requestTransaction(function*(){if(!n.isSynced){for(var e of(n.isSynced=!0,yield*this.garbageCollectAfterSync(),n.whenSyncedListeners))e();n.whenSyncedListeners=[]}})}}send(e,t){this.log("Send '%s' to %s",t.type,e),this.logMessage("Message: %j",t)}broadcast(e){this.log("Broadcast '%s'",e.type),this.logMessage("Message: %j",e)}broadcastOps(t){t=t.map(function(t){return e.Struct[t.struct].encode(t)});var n=this;function r(){n.broadcastOpBuffer.length>0&&(n.broadcast({type:"update",ops:n.broadcastOpBuffer}),n.broadcastOpBuffer=[])}0===this.broadcastOpBuffer.length?(this.broadcastOpBuffer=t,this.y.db.transactionInProgress?this.y.db.whenTransactionsFinished().then(r):setTimeout(r,0)):this.broadcastOpBuffer=this.broadcastOpBuffer.concat(t)}receiveMessage(e,t){if(e===this.userId)return Promise.resolve();if(this.log("Receive '%s' from %s",t.type,e),this.logMessage("Message: %j",t),null!=t.protocolVersion&&t.protocolVersion!==this.protocolVersion)return this.log(`You tried to sync with a yjs instance that has a different protocol version\n          (You: ${this.protocolVersion}, Client: ${t.protocolVersion}).\n          The sync was stopped. You need to upgrade your dependencies (especially Yjs & the Connector)!\n          `),this.send(e,{type:"sync stop",protocolVersion:this.protocolVersion}),Promise.reject("Incompatible protocol version");if(null!=t.auth&&null!=this.connections[e]){var n=this.checkAuth(t.auth,this.y,e);this.connections[e].auth=n,n.then(t=>{for(var n of this.userEventListeners)n({action:"userAuthenticated",user:e,auth:t})})}else null!=this.connections[e]&&null==this.connections[e].auth&&(this.connections[e].auth=this.checkAuth(null,this.y,e));return null!=this.connections[e]&&null!=this.connections[e].auth?this.connections[e].auth.then(n=>{if("sync step 1"===t.type&&function(e){return"read"===e||"write"===e}(n)){let r=this,i=t;this.y.db.requestTransaction(function*(){var t=yield*this.getStateSet();wo(n)&&(yield*this.applyDeleteSet(i.deleteSet));var o={type:"sync step 2",stateSet:t,deleteSet:yield*this.getDeleteSet(),protocolVersion:this.protocolVersion,auth:this.authInfo};o.os=yield*this.getOperations(i.stateSet),r.send(e,o),this.forwardToSyncingClients?(r.syncingClients.push(e),setTimeout(function(){r.syncingClients=r.syncingClients.filter(function(t){return t!==e}),r.send(e,{type:"sync done"})},5e3)):r.send(e,{type:"sync done"})})}else if("sync step 2"===t.type&&wo(n)){var r=this.y.db,i={};i.promise=new Promise(function(e){i.resolve=e}),this.syncStep2=i.promise;let e=t;r.requestTransaction(function*(){yield*this.applyDeleteSet(e.deleteSet),null!=e.osUntransformed?yield*this.applyOperationsUntransformed(e.osUntransformed,e.stateSet):this.store.apply(e.os),i.resolve()})}else if("sync done"===t.type){var o=this;this.syncStep2.then(function(){o._setSyncedWith(e)})}else if("update"===t.type&&wo(n)){if(this.forwardToSyncingClients)for(var s of this.syncingClients)this.send(s,t);if(this.y.db.forwardAppliedOperations){var a=t.ops.filter(function(e){return"Delete"===e.struct});a.length>0&&this.broadcastOps(a)}this.y.db.apply(t.ops)}}):Promise.reject("Unable to deliver message")}_setSyncedWith(e){var t=this.connections[e];null!=t&&(t.isSynced=!0),e===this.currentSyncTarget&&(this.currentSyncTarget=null,this.findNextSyncTarget())}parseMessageFromXml(e){function t(e){for(var r of e.children)return"true"===r.getAttribute("isArray")?t(r):n(r)}function n(e){var r={};for(var i in e.attrs){var o=e.attrs[i],s=parseInt(o,10);isNaN(s)||""+s!==o?r[i]=o:r[i]=s}for(var a in e.children){var u=a.name;"true"===a.getAttribute("isArray")?r[u]=t(a):r[u]=n(a)}return r}n(e)}encodeMessageToXml(e,t){function n(e,t){for(var i in t){var o=t[i];null==i||(o.constructor===Object?n(e.c(i),o):o.constructor===Array?r(e.c(i),o):e.setAttribute(i,o))}}function r(e,t){for(var i of(e.setAttribute("isArray","true"),t))i.constructor===Object?n(e.c("array-element"),i):r(e.c("array-element"),i)}if(t.constructor===Object)n(e.c("y",{xmlns:"http://y.ninja/connector-stanza"}),t);else{if(t.constructor!==Array)throw new Error("I can't encode this json!");r(e.c("y",{xmlns:"http://y.ninja/connector-stanza"}),t)}}}}(Po),function(e){e.AbstractDatabase=class{constructor(e,t){this.y=e,this.dbOpts=t;var n,r=this;this.userId=null,this.userIdPromise=new Promise(function(e){n=e}),this.userIdPromise.resolve=n,this.forwardAppliedOperations=!1,this.listenersById={},this.listenersByIdExecuteNow=[],this.listenersByIdRequestPending=!1,this.initializedTypes={},this.waitingTransactions=[],this.transactionInProgress=!1,this.transactionIsFlushed=!1,"undefined"!=typeof YConcurrency_TestingMode&&(this.executeOrder=[]),this.gc1=[],this.gc2=[],this.garbageCollect=function e(){return r.whenTransactionsFinished().then(function(){return r.gc1.length>0||r.gc2.length>0?(r.y.connector.isSynced,new Promise(t=>{r.requestTransaction(function*(){if(null!=r.y.connector&&r.y.connector.isSynced){for(var n=0;n<r.gc2.length;n++){var i=r.gc2[n];yield*this.garbageCollectOperation(i)}r.gc2=r.gc1,r.gc1=[]}r.gcTimeout>0&&(r.gcInterval=setTimeout(e,r.gcTimeout)),t()})})):(r.gcTimeout>0&&(r.gcInterval=setTimeout(e,r.gcTimeout)),Promise.resolve())})},this.startGarbageCollector(),this.repairCheckInterval=t.repairCheckInterval?t.repairCheckInterval:6e3,this.opsReceivedTimestamp=new Date,this.startRepairCheck()}startGarbageCollector(){this.gc=null==this.dbOpts.gc||this.dbOpts.gc,this.gc?this.gcTimeout=this.dbOpts.gcTimeout?this.dbOpts.gcTimeout:5e4:this.gcTimeout=-1,this.gcTimeout>0&&this.garbageCollect()}startRepairCheck(){var e=this;this.repairCheckInterval>0&&(this.repairCheckIntervalHandler=setInterval(function(){new Date-e.opsReceivedTimestamp>e.repairCheckInterval&&Object.keys(e.listenersById).length>0&&(e.listenersById={},e.opsReceivedTimestamp=new Date,e.y.connector.repair())},this.repairCheckInterval))}stopRepairCheck(){clearInterval(this.repairCheckIntervalHandler)}queueGarbageCollector(e){this.y.connector.isSynced&&this.gc&&this.gc1.push(e)}emptyGarbageCollector(){return new Promise(e=>{var t=()=>{this.gc1.length>0||this.gc2.length>0?this.garbageCollect().then(t):e()};setTimeout(t,0)})}addToDebug(){if("undefined"!=typeof YConcurrency_TestingMode){var e=Array.prototype.map.call(arguments,function(e){return"string"==typeof e?e:JSON.stringify(e)}).join("").replace(/"/g,"'").replace(/,/g,", ").replace(/:/g,": ");this.executeOrder.push(e)}}getDebugData(){}stopGarbageCollector(){var e=this;return this.gc=!1,this.gcTimeout=-1,new Promise(function(t){e.requestTransaction(function*(){var n=e.gc1.concat(e.gc2);e.gc1=[],e.gc2=[];for(var r=0;r<n.length;r++){var i=yield*this.getOperation(n[r]);null!=i&&(delete i.gc,yield*this.setOperation(i))}t()})})}*addToGarbageCollector(e,t){if(null==e.gc&&!0===e.deleted&&this.store.gc&&this.store.y.connector.isSynced){var n=!1;if(null!=t&&!0===t.deleted?n=!0:null!=e.content&&e.content.length>1&&(e=yield*this.getInsertionCleanStart([e.id[0],e.id[1]+1]),n=!0),n)return e.gc=!0,yield*this.setOperation(e),this.store.queueGarbageCollector(e.id),!0}return!1}removeFromGarbageCollector(t){function n(n){return!e.utils.compareIds(n,t.id)}this.gc1=this.gc1.filter(n),this.gc2=this.gc2.filter(n),delete t.gc}destroyTypes(){for(var e in this.initializedTypes){var t=this.initializedTypes[e];null!=t._destroy&&t._destroy()}}*destroy(){clearInterval(this.gcInterval),this.gcInterval=null,this.stopRepairCheck()}setUserId(e){if(!this.userIdPromise.inProgress){this.userIdPromise.inProgress=!0;var t=this;t.requestTransaction(function*(){t.userId=e;var n=yield*this.getState(e);t.opClock=n.clock,t.userIdPromise.resolve(e)})}return this.userIdPromise}whenUserIdSet(e){this.userIdPromise.then(e)}getNextOpId(e){if(null==e)throw new Error("getNextOpId expects the number of created ids to create!");if(null==this.userId)throw new Error("OperationStore not yet initialized!");var t=[this.userId,this.opClock];return this.opClock+=e,t}apply(t){this.opsReceivedTimestamp=new Date;for(var n=0;n<t.length;n++){var r=t[n];if(null==r.id||r.id[0]!==this.y.connector.userId){var i=e.Struct[r.struct].requiredOps(r);null!=r.requires&&(i=i.concat(r.requires)),this.whenOperationsExist(i,r)}}}whenOperationsExist(e,t){if(e.length>0){let n={op:t,missing:e.length};for(let t=0;t<e.length;t++){let r=e[t],i=JSON.stringify(r),o=this.listenersById[i];null==o&&(o=[],this.listenersById[i]=o),o.push(n)}}else this.listenersByIdExecuteNow.push({op:t});if(!this.listenersByIdRequestPending){this.listenersByIdRequestPending=!0;var n=this;this.requestTransaction(function*(){var e=n.listenersByIdExecuteNow;n.listenersByIdExecuteNow=[];var t=n.listenersById;n.listenersById={},n.listenersByIdRequestPending=!1;for(let t=0;t<e.length;t++){let r=e[t].op;yield*n.tryExecute.call(this,r)}for(var r in t){var i=t[r],o=JSON.parse(r);if(null==("string"==typeof o[1]?yield*this.getOperation(o):yield*this.getInsertion(o)))n.listenersById[r]=i;else for(let e=0;e<i.length;e++){let t=i[e],r=t.op;0==--t.missing&&(yield*n.tryExecute.call(this,r))}}})}}*tryExecute(t){if(this.store.addToDebug("yield* this.store.tryExecute.call(this, ",JSON.stringify(t),")"),"Delete"===t.struct)yield*e.Struct.Delete.execute.call(this,t);else{for(var n=yield*this.getInsertion(t.id);null!=n&&null!=n.content&&n.id[1]+n.content.length<t.id[1]+t.content.length;){var r=n.content.length-(t.id[1]-n.id[1]);t.content.splice(0,r),t.id=[t.id[0],t.id[1]+r],t.left=e.utils.getLastId(n),t.origin=t.left,n=yield*this.getOperation(t.id)}if(null==n){var i=t.id;(yield*this.isGarbageCollected(i))||(yield*e.Struct[t.struct].execute.call(this,t),yield*this.addOperation(t),yield*this.store.operationAdded(this,t),t=yield*this.getOperation(i),yield*this.tryCombineWithLeft(t))}}}*operationAdded(t,n){if("Delete"===n.struct){var r=this.initializedTypes[JSON.stringify(n.targetParent)];null!=r&&(yield*r._changed(t,n))}else{yield*t.updateState(n.id[0]);var i=null!=n.content?n.content.length:1;for(let e=0;e<i;e++){var o=JSON.stringify([n.id[0],n.id[1]+e]),s=this.listenersById[o];if(delete this.listenersById[o],null!=s)for(var a in s){var u=s[a];0==--u.missing&&this.whenOperationsExist([],u.op)}}var c=this.initializedTypes[JSON.stringify(n.parent)];if(null!=n.parent&&(yield*t.isDeleted(n.parent)))return void(yield*t.deleteList(n.id));if(null!=c){let r=e.utils.copyOperation(n);yield*c._changed(t,r)}if(!n.deleted){var l=null!=n.content?n.content.length:1,f=n.id;for(let e=0;e<l;e++){var h=[f[0],f[1]+e];if(yield*t.isDeleted(h)){var d={struct:"Delete",target:h};yield*this.tryExecute.call(t,d)}}}}}whenTransactionsFinished(){if(this.transactionInProgress){if(null==this.transactionsFinished){var e,t=new Promise(function(t){e=t});this.transactionsFinished={resolve:e,promise:t}}return this.transactionsFinished.promise}return Promise.resolve()}getNextRequest(){return 0===this.waitingTransactions.length?this.transactionIsFlushed?(this.transactionInProgress=!1,this.transactionIsFlushed=!1,null!=this.transactionsFinished&&(this.transactionsFinished.resolve(),this.transactionsFinished=null),null):(this.transactionIsFlushed=!0,function*(){yield*this.flush()}):(this.transactionIsFlushed=!1,this.waitingTransactions.shift())}requestTransaction(e,t){this.waitingTransactions.push(e),this.transactionInProgress||(this.transactionInProgress=!0,setTimeout(()=>{this.transact(this.getNextRequest())},0))}getType(e){return this.initializedTypes[JSON.stringify(e)]}*initType(t,n){var r=JSON.stringify(t),i=this.store.initializedTypes[r];if(null==i){var o=yield*this.getOperation(t);null!=o&&(i=yield*e[o.type].typeDefinition.initType.call(this,this.store,o,n),this.store.initializedTypes[r]=i)}return i}createType(t,n){var r=t[0].struct;n=n||this.getNextOpId(1);var i=e.Struct[r].create(n);i.type=t[0].name,this.requestTransaction(function*(){"_"===i.id[0]?yield*this.setOperation(i):yield*this.applyCreatedOperations([i])});var o=e[i.type].typeDefinition.createType(this,i,t[1]);return this.initializedTypes[JSON.stringify(i.id)]=o,o}}}(Po),function(e){e.Transaction=class{*applyCreatedOperations(t){for(var n=[],r=0;r<t.length;r++){var i=t[r];yield*this.store.tryExecute.call(this,i),null!=i.id&&"string"==typeof i.id[1]||n.push(e.Struct[i.struct].encode(i))}n.length>0&&this.store.y.connector.broadcastOps(n)}*deleteList(e){for(;null!=e;){if(!(e=yield*this.getOperation(e)).gc){e.gc=!0,e.deleted=!0,yield*this.setOperation(e);var t=null!=e.content?e.content.length:1;yield*this.markDeleted(e.id,t),null!=e.opContent&&(yield*this.deleteOperation(e.opContent)),this.store.queueGarbageCollector(e.id)}e=e.right}}*deleteOperation(e,t,n){for(null==t&&(t=1),yield*this.markDeleted(e,t);t>0;){var r=!1,i=yield*this.os.findWithUpperBound([e[0],e[1]+t-1]),o=null!=i&&null!=i.content?i.content.length:1;if(null==i||i.id[0]!==e[0]||i.id[1]+o<=e[1]?(i=null,t=0):(i.deleted||(i.id[1]<e[1]&&(o=(i=yield*this.getInsertionCleanStart(e)).content.length),i.id[1]+o>e[1]+t&&(o=(i=yield*this.getInsertionCleanEnd([e[0],e[1]+t-1])).content.length)),t=i.id[1]-e[1]),null!=i){if(!i.deleted){if(r=!0,i.deleted=!0,null!=i.start&&(yield*this.deleteList(i.start)),null!=i.map)for(var s in i.map)yield*this.deleteList(i.map[s]);if(null!=i.opContent&&(yield*this.deleteOperation(i.opContent)),null!=i.requires)for(var a=0;a<i.requires.length;a++)yield*this.deleteOperation(i.requires[a])}var u,c;u=null!=i.left?yield*this.getInsertion(i.left):null,yield*this.setOperation(i),c=null!=i.right?yield*this.getOperation(i.right):null,r&&!n&&(yield*this.store.operationAdded(this,{struct:"Delete",target:i.id,length:o,targetParent:i.parent})),yield*this.store.addToGarbageCollector.call(this,i,u),null!=c&&(yield*this.store.addToGarbageCollector.call(this,c,i))}}}*markGarbageCollected(t,n){this.store.addToDebug("yield* this.markGarbageCollected(",t,", ",n,")");var r=yield*this.markDeleted(t,n);if(r.id[1]<t[1]&&!r.gc){var i=r.len-(t[1]-r.id[1]);r.len-=i,yield*this.ds.put(r),r={id:t,len:i,gc:!1},yield*this.ds.put(r)}var o=yield*this.ds.findPrev(t),s=yield*this.ds.findNext(t);t[1]+n<r.id[1]+r.len&&!r.gc&&(yield*this.ds.put({id:[t[0],t[1]+n],len:r.len-n,gc:!1}),r.len=n),r.gc=!0,null!=o&&o.gc&&e.utils.compareIds([o.id[0],o.id[1]+o.len],r.id)&&(o.len+=r.len,yield*this.ds.delete(r.id),r=o),null!=s&&s.gc&&e.utils.compareIds([r.id[0],r.id[1]+r.len],s.id)&&(r.len+=s.len,yield*this.ds.delete(s.id)),yield*this.ds.put(r),yield*this.updateState(r.id[0])}*markDeleted(e,t){null==t&&(t=1);var n=yield*this.ds.findWithUpperBound(e);if(null!=n&&n.id[0]===e[0])if(n.id[1]<=e[1]&&e[1]<=n.id[1]+n.len){var r=e[1]+t-(n.id[1]+n.len);if(!(r>0))return n;if(n.gc){if(!((r=n.id[1]+n.len-e[1])<t))throw new Error("Cannot happen! (it dit though.. :()");n={id:[e[0],e[1]+r],len:t-r,gc:!1},yield*this.ds.put(n)}else n.len+=r}else n={id:e,len:t,gc:!1},yield*this.ds.put(n);else n={id:e,len:t,gc:!1},yield*this.ds.put(n);var i=yield*this.ds.findNext(n.id);if(null!=i&&n.id[0]===i.id[0]&&n.id[1]+n.len>=i.id[1])for(r=n.id[1]+n.len-i.id[1];r>=0;){if(i.gc){n.len-=r,r>=i.len&&(r-=i.len)>0&&(yield*this.ds.put(n),yield*this.markDeleted([i.id[0],i.id[1]+i.len],r));break}if(!(r>i.len)){n.len+=i.len-r,yield*this.ds.delete(i.id);break}var o=yield*this.ds.findNext(i.id);if(yield*this.ds.delete(i.id),null==o||n.id[0]!==o.id[0])break;i=o,r=n.id[1]+n.len-i.id[1]}return yield*this.ds.put(n),n}*garbageCollectAfterSync(){this.store.gc1.length>0||this.store.gc2.length,this.store.gc&&(yield*this.os.iterate(this,null,null,function*(e){if(e.gc&&(delete e.gc,yield*this.setOperation(e)),null!=e.parent&&(yield*this.isDeleted(e.parent))){if(e.gc=!0,!e.deleted&&(yield*this.markDeleted(e.id,null!=e.content?e.content.length:1),e.deleted=!0,null!=e.opContent&&(yield*this.deleteOperation(e.opContent)),null!=e.requires))for(var t=0;t<e.requires.length;t++)yield*this.deleteOperation(e.requires[t]);return yield*this.setOperation(e),void this.store.gc1.push(e.id)}if(e.deleted){var n=null;null!=e.left&&(n=yield*this.getInsertion(e.left)),yield*this.store.addToGarbageCollector.call(this,e,n)}}))}*garbageCollectOperation(t){this.store.addToDebug("yield* this.garbageCollectOperation(",t,")");var n=yield*this.getOperation(t);if(yield*this.markGarbageCollected(t,null!=n&&null!=n.content?n.content.length:1),null!=n){var r,i=[];null!=n.opContent&&i.push(n.opContent),null!=n.requires&&(i=i.concat(n.requires));for(var o=0;o<i.length;o++){var s=yield*this.getOperation(i[o]);null!=s?(s.deleted||(yield*this.deleteOperation(s.id),s=yield*this.getOperation(s.id)),s.gc=!0,yield*this.setOperation(s),this.store.queueGarbageCollector(s.id)):yield*this.markGarbageCollected(i[o],1)}if(null!=n.left){var a=yield*this.getInsertion(n.left);a.right=n.right,yield*this.setOperation(a)}if(null!=n.right){var u=yield*this.getOperation(n.right);if(u.left=n.left,yield*this.setOperation(u),null!=n.originOf&&n.originOf.length>0){for(var c=n.left,l=null;null!=c&&!(l=yield*this.getInsertion(c)).deleted;)c=l.left;for(var f in n.originOf){var h=yield*this.getOperation(n.originOf[f]);null!=h&&(h.origin=c,yield*this.setOperation(h))}null!=c&&(null==l.originOf?l.originOf=n.originOf:l.originOf=n.originOf.concat(l.originOf),yield*this.setOperation(l))}}if(null!=n.origin){var d=yield*this.getInsertion(n.origin);d.originOf=d.originOf.filter(function(n){return!e.utils.compareIds(t,n)}),yield*this.setOperation(d)}if(null!=n.parent&&(r=yield*this.getOperation(n.parent)),null!=r){var p=!1;null!=n.parentSub?e.utils.compareIds(r.map[n.parentSub],n.id)&&(p=!0,null!=n.right?r.map[n.parentSub]=n.right:delete r.map[n.parentSub]):(e.utils.compareIds(r.start,n.id)&&(p=!0,r.start=n.right),e.utils.matchesId(n,r.end)&&(p=!0,r.end=n.left)),p&&(yield*this.setOperation(r))}yield*this.removeOperation(n.id)}}*checkDeleteStoreForState(e){var t=yield*this.ds.findWithUpperBound([e.user,e.clock]);null!=t&&t.id[0]===e.user&&t.gc&&(e.clock=Math.max(e.clock,t.id[1]+t.len))}*updateState(e){var t=yield*this.getState(e);yield*this.checkDeleteStoreForState(t);for(var n=yield*this.getInsertion([e,t.clock]),r=null!=n&&null!=n.content?n.content.length:1;null!=n&&e===n.id[0]&&n.id[1]<=t.clock&&n.id[1]+r>t.clock;)t.clock+=r,yield*this.checkDeleteStoreForState(t),r=null!=(n=yield*this.os.findNext(n.id))&&null!=n.content?n.content.length:1;yield*this.setState(t)}*applyDeleteSet(e){var t=[];for(var n in e){var r=e[n],i=0,o=r[i];for(yield*this.ds.iterate(this,[n,0],[n,Number.MAX_VALUE],function*(e){for(;null!=o;){var s=0;if(e.id[1]+e.len<=o[0])break;o[0]<e.id[1]?(s=Math.min(e.id[1]-o[0],o[1]),t.push([n,o[0],s,o[2]])):(s=e.id[1]+e.len-o[0],o[2]&&!e.gc&&t.push([n,o[0],Math.min(s,o[1]),o[2]])),o[1]<=s?o=r[++i]:(o[0]=o[0]+s,o[1]=o[1]-s)}});i<r.length;i++)o=r[i],t.push([n,o[0],o[1],o[2]])}for(var s=0;s<t.length;s++){var a=t[s];if(yield*this.deleteOperation([a[0],a[1]],a[2]),a[3]){yield*this.markGarbageCollected([a[0],a[1]],a[2]);for(var u=a[1]+a[2];u>=a[1];){var c=yield*this.os.findWithUpperBound([a[0],u-1]);if(null==c)break;var l=null!=c.content?c.content.length:1;if(c.id[0]!==a[0]||c.id[1]+l<=a[1])break;c.id[1]+l>a[1]+a[2]&&(c=yield*this.getInsertionCleanEnd([a[0],a[1]+a[2]-1])),c.id[1]<a[1]&&(c=yield*this.getInsertionCleanStart([a[0],a[1]])),u=c.id[1],yield*this.garbageCollectOperation(c.id)}}if(this.store.forwardAppliedOperations){var f=[];f.push({struct:"Delete",target:[a[0],a[1]],length:a[2]}),this.store.y.connector.broadcastOps(f)}}}*isGarbageCollected(e){var t=yield*this.ds.findWithUpperBound(e);return null!=t&&t.id[0]===e[0]&&e[1]<t.id[1]+t.len&&t.gc}*getDeleteSet(){var e={};return yield*this.ds.iterate(this,null,null,function*(t){var n=t.id[0],r=t.id[1],i=t.len,o=t.gc,s=e[n];void 0===s&&(s=[],e[n]=s),s.push([r,i,o])}),e}*isDeleted(e){var t=yield*this.ds.findWithUpperBound(e);return null!=t&&t.id[0]===e[0]&&e[1]<t.id[1]+t.len}*setOperation(e){return yield*this.os.put(e),e}*addOperation(e){yield*this.os.put(e),this.store.forwardAppliedOperations&&"string"!=typeof e.id[1]&&this.store.y.connector.broadcastOps([e])}*tryCombineWithLeft(t){if(null!=t&&null!=t.left&&null!=t.content&&t.left[0]===t.id[0]&&e.utils.compareIds(t.left,t.origin)){var n=yield*this.getInsertion(t.left);null==n.content||n.id[1]+n.content.length!==t.id[1]||1!==n.originOf.length||n.gc||n.deleted||t.gc||t.deleted||(null!=t.originOf?n.originOf=t.originOf:delete n.originOf,n.content=n.content.concat(t.content),n.right=t.right,yield*this.os.delete(t.id),yield*this.setOperation(n))}}*getInsertion(e){var t=yield*this.os.findWithUpperBound(e);if(null==t)return null;var n=null!=t.content?t.content.length:1;return e[0]===t.id[0]&&e[1]<t.id[1]+n?t:null}*getInsertionCleanStartEnd(e){return yield*this.getInsertionCleanStart(e),yield*this.getInsertionCleanEnd(e)}*getInsertionCleanStart(t){var n=yield*this.getInsertion(t);if(null!=n){if(n.id[1]===t[1])return n;var r=e.utils.copyObject(n);n.content=r.content.splice(t[1]-n.id[1]),n.id=t;var i=e.utils.getLastId(r);return n.origin=i,r.originOf=[n.id],r.right=n.id,n.left=i,yield*this.setOperation(r),yield*this.setOperation(n),r.gc&&this.store.queueGarbageCollector(n.id),n}return null}*getInsertionCleanEnd(t){var n=yield*this.getInsertion(t);if(null!=n){if(null==n.content||n.id[1]+n.content.length-1===t[1])return n;var r=e.utils.copyObject(n);r.content=n.content.splice(t[1]-n.id[1]+1),r.id=[t[0],t[1]+1];var i=e.utils.getLastId(n);return r.origin=i,n.originOf=[r.id],n.right=r.id,r.left=i,yield*this.setOperation(r),yield*this.setOperation(n),n.gc&&this.store.queueGarbageCollector(r.id),n}return null}*getOperation(t){var n=yield*this.os.find(t);if("_"!==t[0]||null!=n)return n;var r=t[1].split("_");if(r.length>1){var i=r[0],o=e.Struct[i].create(t);return o.type=r[1],yield*this.setOperation(o),o}return null}*removeOperation(e){yield*this.os.delete(e)}*setState(e){var t={id:[e.user],clock:e.clock};yield*this.ss.put(t)}*getState(e){var t=yield*this.ss.find([e]),n=null==t?null:t.clock;return null==n&&(n=0),{user:e,clock:n}}*getStateVector(){var e=[];return yield*this.ss.iterate(this,null,null,function*(t){e.push({user:t.id[0],clock:t.clock})}),e}*getStateSet(){var e={};return yield*this.ss.iterate(this,null,null,function*(t){e[t.id[0]]=t.clock}),e}*getOperations(t){null==t&&(t={});var n=[],r=yield*this.getStateVector();for(var i of r){var o=i.user;if("_"!==o){var s=t[o]||0;if(s>0){var a=yield*this.getInsertion([o,s]);null!=a&&(s=a.id[1],t[o]=s)}yield*this.os.iterate(this,[o,s],[o,Number.MAX_VALUE],function*(r){if("Insert"!==(r=e.Struct[r.struct].encode(r)).struct)n.push(r);else if(null==r.right||r.right[1]<(t[r.right[0]]||0))for(var i=r,o=[r],s=r.right;;){if(null==i.left){r.left=null,n.push(r),e.utils.compareIds(i.id,r.id)||((i=e.Struct[r.struct].encode(i)).right=o[o.length-1].id,n.push(i));break}for(i=yield*this.getInsertion(i.left);o.length>0&&e.utils.matchesId(i,o[o.length-1].origin);)o.pop();if(i.id[1]<(t[i.id[0]]||0)){r.left=e.utils.getLastId(i),n.push(r);break}if(e.utils.matchesId(i,r.origin))r.left=r.origin,n.push(r),(r=e.Struct[r.struct].encode(i)).right=s,o.length,o=[r];else{var a=e.Struct[r.struct].encode(i);a.right=o[o.length-1].id,a.left=a.origin,n.push(a),o.push(i)}}})}}return n.reverse()}*getOperationsUntransformed(){var e=[];return yield*this.os.iterate(this,null,null,function*(t){"_"!==t.id[0]&&e.push(t)}),{untransformed:e}}*applyOperationsUntransformed(t,n){for(var r=t.untransformed,i=0;i<r.length;i++){var o=r[i];if(null!=o.parent&&"_"===o.parent[0]&&"Insert"===o.struct)if(null!=o.parentSub&&null==o.left){let e=yield*this.getOperation(o.parent);e.map[o.parentSub]=o.id,yield*this.setOperation(e)}else if(null==o.right||null==o.left){let t=yield*this.getOperation(o.parent);null==o.right&&(t.end=e.utils.getLastId(o)),null==o.left&&(t.start=o.id),yield*this.setOperation(t)}yield*this.os.put(o)}for(var s in n)yield*this.ss.put({id:[s],clock:n[s]})}*flush(){yield*this.os.flush(),yield*this.ss.flush(),yield*this.ds.flush()}}}(Po),function(e){var t={Delete:{encode:function(e){return{target:e.target,length:e.length||0,struct:"Delete"}},requiredOps:function(e){return[]},execute:function*(e){return yield*this.deleteOperation(e.target,e.length||1)}},Insert:{encode:function(e){var t={id:e.id,left:e.left,right:e.right,origin:e.origin,parent:e.parent,struct:e.struct};return null!=e.parentSub&&(t.parentSub=e.parentSub),e.hasOwnProperty("opContent")?t.opContent=e.opContent:t.content=e.content.slice(),t},requiredOps:function(t){var n=[];return null!=t.left&&n.push(t.left),null!=t.right&&n.push(t.right),null==t.origin||e.utils.compareIds(t.left,t.origin)||n.push(t.origin),n.push(t.parent),null!=t.opContent&&n.push(t.opContent),n},getDistanceToOrigin:function*(t){if(null==t.left)return 0;for(var n=0,r=yield*this.getInsertion(t.left);!e.utils.matchesId(r,t.origin)&&(n++,null!=r.left);)r=yield*this.getInsertion(r.left);return n},execute:function*(n){var r,i=[];if(null!=n.origin){var o=yield*this.getInsertionCleanEnd(n.origin);null==o.originOf&&(o.originOf=[]),o.originOf.push(n.id),yield*this.setOperation(o),null!=o.right&&i.push(o.right)}var s,a,u=r=yield*t.Insert.getDistanceToOrigin.call(this,n);if(null!=n.left)s=yield*this.getInsertionCleanEnd(n.left),e.utils.compareIds(n.left,n.origin)||null==s.right||i.push(s.right),s=null==s.right?null:yield*this.getOperation(s.right);else{a=yield*this.getOperation(n.parent);let e=n.parentSub?a.map[n.parentSub]:a.start;s=null==e?null:yield*this.getOperation(e)}for(null!=n.right&&(i.push(n.right),yield*this.getInsertionCleanStart(n.right));null!=s&&!e.utils.compareIds(s.id,n.right);){var c=yield*t.Insert.getDistanceToOrigin.call(this,s);if(c===r)s.id[0]<n.id[0]&&(n.left=e.utils.getLastId(s),u=r+1);else{if(!(c<r))break;r-u<=c&&(n.left=e.utils.getLastId(s),u=r+1)}r++,s=null!=s.right?yield*this.getInsertion(s.right):null}var l=null,f=null;for(null==a&&(a=yield*this.getOperation(n.parent)),null!=n.left?(l=yield*this.getInsertion(n.left),n.right=l.right,l.right=n.id,yield*this.setOperation(l)):n.right=n.parentSub?a.map[n.parentSub]||null:a.start,null!=n.right&&((f=yield*this.getOperation(n.right)).left=e.utils.getLastId(n),null!=f.gc&&(null!=f.content&&f.content.length>1&&(f=yield*this.getInsertionCleanEnd(f.id)),this.store.removeFromGarbageCollector(f)),yield*this.setOperation(f)),null!=n.parentSub?(null==l&&(a.map[n.parentSub]=n.id,yield*this.setOperation(a)),null!=n.right&&(yield*this.deleteOperation(n.right,1,!0)),null!=n.left&&(yield*this.deleteOperation(n.id,1,!0))):null!=f&&null!=l||(null==f&&(a.end=e.utils.getLastId(n)),null==l&&(a.start=n.id),yield*this.setOperation(a)),r=0;r<i.length;r++){var h=yield*this.getOperation(i[r]);yield*this.tryCombineWithLeft(h)}}},List:{create:function(e){return{start:null,end:null,struct:"List",id:e}},encode:function(e){var t={struct:"List",id:e.id,type:e.type};return null!=e.requires&&(t.requires=e.requires),null!=e.info&&(t.info=e.info),t},requiredOps:function(){return[]},execute:function*(e){e.start=null,e.end=null},ref:function*(e,t){if(null==e.start)return null;for(var n=null,r=yield*this.getOperation(e.start);r.deleted||(n=r,t--),t>=0&&null!=r.right;)r=yield*this.getOperation(r.right);return n},map:function*(e,t){e=e.start;for(var n=[];null!=e;){var r=yield*this.getOperation(e);r.deleted||n.push(t(r)),e=r.right}return n}},Map:{create:function(e){return{id:e,map:{},struct:"Map"}},encode:function(e){var t={struct:"Map",type:e.type,id:e.id,map:{}};return null!=e.requires&&(t.requires=e.requires),null!=e.info&&(t.info=e.info),t},requiredOps:function(){return[]},execute:function*(){},get:function*(e,t){var n=e.map[t];if(null!=n){var r=yield*this.getOperation(n);return null==r||r.deleted?void 0:null==r.opContent?r.content[0]:yield*this.getType(r.opContent)}}}};e.Struct=t}(Po),function(e){e.utils={},e.utils.bubbleEvent=function(e,t){for(e.eventHandler.callEventListeners(t),t.path=[];null!=e&&null!=e._deepEventHandler;){e._deepEventHandler.callEventListeners(t);var n=null;null!=e._parent&&(n=e.os.getType(e._parent)),null!=n&&null!=n._getPathToChild?(t.path=[n._getPathToChild(e._model)].concat(t.path),e=n):e=null}};class t{constructor(){this.eventListeners=[]}destroy(){this.eventListeners=null}addEventListener(e){this.eventListeners.push(e)}removeEventListener(e){this.eventListeners=this.eventListeners.filter(function(t){return e!==t})}removeAllEventListeners(){this.eventListeners=[]}callEventListeners(e){for(var t=0;t<this.eventListeners.length;t++)try{var n={};for(var r in e)n[r]=e[r];this.eventListeners[t](n)}catch(e){}}}e.utils.EventListenerHandler=t;e.utils.EventHandler=class extends t{constructor(e){super(),this.waiting=[],this.awaiting=0,this.onevent=e}destroy(){super.destroy(),this.waiting=null,this.onevent=null}receivedOp(e){if(this.awaiting<=0)this.onevent(e);else if("Delete"===e.struct){var t=this;null==e.key?function e(n){if(null==n.length)throw new Error("This shouldn't happen! d.length must be defined!");for(var r=0;r<t.waiting.length;r++){var i=t.waiting[r];if("Insert"===i.struct&&i.id[0]===n.target[0]){var o=i.hasOwnProperty("content")?i.content.length:1,s=n.target[1],a=n.target[1]+(n.length||1),u=i.id[1],c=i.id[1]+o;if(c<=s||a<=u)continue;if(u<s){if(s<c){if(c<a){i.content.splice(s-u),n.length=a-c,n.target=[n.target[0],c];continue}if(c===a)return void i.content.splice(s-u);var l={id:[i.id[0],a],content:i.content.slice(a-u),struct:"Insert"};return t.waiting.push(l),void i.content.splice(s-u)}}else{if(s===u){if(c<a){n.length=a-c,n.target=[n.target[0],c],i.content=[];continue}return c===a?void t.waiting.splice(r,1):(i.content=i.content.slice(a-u),void(i.id=[i.id[0],a]))}if(u<a){if(c<a)return t.waiting.splice(r,1),e({target:[n.target[0],s],length:u-s,struct:"Delete"}),void e({target:[n.target[0],c],length:c-a,struct:"Delete"});if(c===a){t.waiting.splice(r,1),r--,n.length-=o;continue}n.length=u-s,i.content.splice(0,a-u),i.id=[i.id[0],a];continue}}}}t.waiting.push(n)}(e):this.waiting.push(e)}else this.waiting.push(e)}awaitAndPrematurelyCall(t){this.awaiting++,t.map(e.utils.copyOperation).forEach(this.onevent)}*awaitOps(t,n,r){var i=this.waiting.length;if(yield*n.apply(t,r),this.waiting.splice(i),this.awaiting>0&&this.awaiting--,0===this.awaiting&&this.waiting.length>0){for(let n=0;n<this.waiting.length;n++){var o=this.waiting[n];if("Insert"===o.struct){var s=yield*t.getInsertion(o.id);if(null!=s.parentSub&&null!=s.left)this.waiting.splice(n,1),n--;else if(e.utils.compareIds(s.id,o.id))if(null==s.left)o.left=null;else{for(var a=yield*t.getInsertion(s.left);null!=a.deleted;){if(null==a.left){a=null;break}a=yield*t.getInsertion(a.left)}o.left=null!=a?e.utils.getLastId(a):null}else o.left=[o.id[0],o.id[1]-1]}}if(null!=this._pullChanges&&this._pullChanges(),0===this.awaiting){var u=[],c=[];this.waiting.forEach(function(e){"Delete"===e.struct?c.push(e):u.push(e)}),this.waiting=[],u=function(t){for(var n=[];t.length>0;)for(var r=0;r<t.length;r++){for(var i=!0,o=0;o<t.length;o++)if(e.utils.matchesId(t[o],t[r].left)){i=!1;break}i&&(n.push(t.splice(r,1)[0]),r--)}return n}(u);for(var l=0;l<u.length;l++){if(0!==this.awaiting){this.waiting=this.waiting.concat(u.slice(l));break}this.onevent(u[l])}for(l=0;l<c.length;l++){if(0!==this.awaiting){this.waiting=this.waiting.concat(c.slice(l));break}this.onevent(c[l])}}}}awaitedInserts(t){for(var n=this.waiting.splice(this.waiting.length-t),r=0;r<n.length;r++){var i=n[r];if("Insert"!==i.struct)throw new Error("Expected Insert Operation!");for(var o=this.waiting.length-1;o>=0;o--){let t=this.waiting[o];"Insert"===t.struct&&(e.utils.matchesId(t,i.left)?(t.right=i.id,i.left=t.left):e.utils.compareIds(t.id,i.right)&&(t.left=e.utils.getLastId(i),i.right=t.right))}}this._tryCallEvents(t)}awaitedDeletes(t,n){for(var r=this.waiting.splice(this.waiting.length-t),i=0;i<r.length;i++){var o=r[i];if("Delete"!==o.struct)throw new Error("Expected Delete Operation!");if(null!=n)for(var s=0;s<this.waiting.length;s++){let t=this.waiting[s];"Insert"===t.struct&&e.utils.compareIds(o.target,t.left)&&(t.left=n)}}this._tryCallEvents(t)}_tryCallEvents(){if(this.awaiting>0&&this.awaiting--,0===this.awaiting&&this.waiting.length>0){var t=[],n=[];this.waiting.forEach(function(e){"Delete"===e.struct?n.push(e):t.push(e)}),(t=function(t){for(var n=[];t.length>0;)for(var r=0;r<t.length;r++){for(var i=!0,o=0;o<t.length;o++)if(e.utils.matchesId(t[o],t[r].left)){i=!1;break}i&&(n.push(t.splice(r,1)[0]),r--)}return n}(t)).forEach(this.onevent),n.forEach(this.onevent),this.waiting=[]}}};e.utils.CustomType=class{getPath(){var e=null;if(null!=this._parent&&(e=this.os.getType(this._parent)),null!=e&&null!=e._getPathToChild){var t=e._getPathToChild(this._model),n=e.getPath();return n.push(t),n}return[]}};function n(e){var t={};for(var n in e)t[n]=e[n];return t}function r(e){for(var t=new Array(e),n=0;n<t.length;n++)t[n]={id:[null,null]};return t}e.utils.CustomTypeDefinition=class{constructor(e){if(null==e.struct||null==e.initType||null==e.class||null==e.name||null==e.createType)throw new Error("Custom type was not initialized correctly!");this.struct=e.struct,this.initType=e.initType,this.createType=e.createType,this.class=e.class,this.name=e.name,null!=e.appendAdditionalInfo&&(this.appendAdditionalInfo=e.appendAdditionalInfo),this.parseArguments=(e.parseArguments||function(){return[this]}).bind(this),this.parseArguments.typeDefinition=this}},e.utils.isTypeDefinition=function(t){if(null!=t){if(t instanceof e.utils.CustomTypeDefinition)return[t];if(t.constructor===Array&&t[0]instanceof e.utils.CustomTypeDefinition)return t;if(t instanceof Function&&t.typeDefinition instanceof e.utils.CustomTypeDefinition)return[t.typeDefinition]}return!1},e.utils.copyObject=n,e.utils.copyOperation=function(e){return null!=(e=n(e)).content&&(e.content=e.content.map(function(e){return e})),e},e.utils.smaller=function(e,t){return e[0]<t[0]||e[0]===t[0]&&(e[1]<t[1]||typeof e[1]<typeof t[1])},e.utils.inDeletionRange=function(e,t){return e.target[0]===t[0]&&e.target[1]<=t[1]&&t[1]<e.target[1]+(e.length||1)},e.utils.compareIds=function(e,t){return null==e||null==t?e===t:e[0]===t[0]&&e[1]===t[1]},e.utils.matchesId=function(e,t){return null==t||null==e?t===e:t[0]===e.id[0]?null==e.content?t[1]===e.id[1]:t[1]>=e.id[1]&&t[1]<e.id[1]+e.content.length:void 0},e.utils.getLastId=function(e){return null==e.content||1===e.content.length?e.id:[e.id[0],e.id[1]+e.content.length-1]},e.utils.createSmallLookupBuffer=function(e){return class extends e{constructor(e,t){super(e,t),this.writeBuffer=r(5),this.readBuffer=r(10)}*find(e,t){var n,r,i;for(n=this.readBuffer.length-1;n>=0;n--)if((r=this.readBuffer[n]).id[1]===e[1]&&r.id[0]===e[0]){for(;n<this.readBuffer.length-1;n++)this.readBuffer[n]=this.readBuffer[n+1];return this.readBuffer[this.readBuffer.length-1]=r,r}for(n=this.writeBuffer.length-1;n>=0;n--)if((r=this.writeBuffer[n]).id[1]===e[1]&&r.id[0]===e[0]){i=r;break}if(n<0&&void 0===t&&(i=yield*super.find(e)),null!=i){for(n=0;n<this.readBuffer.length-1;n++)this.readBuffer[n]=this.readBuffer[n+1];this.readBuffer[this.readBuffer.length-1]=i}return i}*put(e){var t,n,r=e.id;for(t=this.writeBuffer.length-1;t>=0;t--)if((n=this.writeBuffer[t]).id[1]===r[1]&&n.id[0]===r[0]){for(;t<this.writeBuffer.length-1;t++)this.writeBuffer[t]=this.writeBuffer[t+1];this.writeBuffer[this.writeBuffer.length-1]=e;break}if(t<0){var i=this.writeBuffer[0];for(null!==i.id[0]&&(yield*super.put(i)),t=0;t<this.writeBuffer.length-1;t++)this.writeBuffer[t]=this.writeBuffer[t+1];this.writeBuffer[this.writeBuffer.length-1]=e}for(t=0;t<this.readBuffer.length-1;t++)(n=this.readBuffer[t+1]).id[1]===r[1]&&n.id[0]===r[0]?this.readBuffer[t]=e:this.readBuffer[t]=n;this.readBuffer[this.readBuffer.length-1]=e}*delete(e){var t,n;for(t=0;t<this.readBuffer.length;t++)(n=this.readBuffer[t]).id[1]===e[1]&&n.id[0]===e[0]&&(this.readBuffer[t]={id:[null,null]});yield*this.flush(),yield*super.delete(e)}*findWithLowerBound(e){var t=yield*this.find(e,!0);return null!=t?t:(yield*this.flush(),yield*super.findWithLowerBound.apply(this,arguments))}*findWithUpperBound(e){var t=yield*this.find(e,!0);return null!=t?t:(yield*this.flush(),yield*super.findWithUpperBound.apply(this,arguments))}*findNext(){return yield*this.flush(),yield*super.findNext.apply(this,arguments)}*findPrev(){return yield*this.flush(),yield*super.findPrev.apply(this,arguments)}*iterate(){yield*this.flush(),yield*super.iterate.apply(this,arguments)}*flush(){for(var e=0;e<this.writeBuffer.length;e++){var t=this.writeBuffer[e];null!==t.id[0]&&(yield*super.put(t),this.writeBuffer[e]={id:[null,null]})}}}},e.utils.generateGuid=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}}(Po),function(e){var t={users:{},buffers:{},removeUser:function(e){for(var t in this.users)this.users[t].userLeft(e);delete this.users[e],delete this.buffers[e]},addUser:function(e){for(var t in this.users[e.userId]=e,this.buffers[e.userId]={},this.users)if(t!==e.userId){var n=this.users[t];n.userJoined(e.userId,"master"),e.userJoined(n.userId,"master")}},whenTransactionsFinished:function(){var e=this;return new Promise(function(t,n){setTimeout(function(){var r=[];for(var i in e.users)r.push(e.users[i].y.db.whenTransactionsFinished());Promise.all(r).then(t,n)},10)})},flushOne:function(){var e=[];for(var n in t.buffers){let i=t.buffers[n];var r=!1;for(let e in i)if(i[e].length>0){r=!0;break}r&&e.push(n)}if(e.length>0){var i=getRandom(e);let n=t.buffers[i],r=getRandom(Object.keys(n));var o=n[r].shift();0===n[r].length&&delete n[r];var s=t.users[i];return s.receiveMessage(o[0],o[1]).then(function(){return s.y.db.whenTransactionsFinished()},function(){})}return!1},flushAll:function(){return new Promise(function(e){t.whenTransactionsFinished().then(function n(){var r=t.flushOne();if(r){for(;r;)r=t.flushOne();t.whenTransactionsFinished().then(n)}else(r=t.flushOne())?r.then(function(){t.whenTransactionsFinished().then(n)}):e()})})}};e.utils.globalRoom=t;var n=0;e.Test=class extends e.AbstractConnector{constructor(e,r){if(void 0===r)throw new Error("Options must not be undefined!");r.role="master",r.forwardToSyncingClients=!1,super(e,r),this.setUserId(n+++"").then(()=>{t.addUser(this)}),this.globalRoom=t,this.syncingClientDuration=0}receiveMessage(e,t){return super.receiveMessage(e,JSON.parse(JSON.stringify(t)))}send(e,n){var r=t.buffers[e];null!=r&&(null==r[this.userId]&&(r[this.userId]=[]),r[this.userId].push(JSON.parse(JSON.stringify([this.userId,n]))))}broadcast(e){for(var n in t.buffers){var r=t.buffers[n];null==r[this.userId]&&(r[this.userId]=[]),r[this.userId].push(JSON.parse(JSON.stringify([this.userId,e])))}}isDisconnected(){return null==t.users[this.userId]}reconnect(){return this.isDisconnected()&&(t.addUser(this),super.reconnect()),e.utils.globalRoom.flushAll()}disconnect(){var e=Promise.resolve();this.isDisconnected()||(t.removeUser(this.userId),e=super.disconnect());var n=this;return e.then(function(){return n.y.db.whenTransactionsFinished()})}flush(){var e=this;return async(function*(){for(var n=t.buffers[e.userId];Object.keys(n).length>0;){var r=getRandom(Object.keys(n)),i=n[r].shift();0===n[r].length&&delete n[r],yield this.receiveMessage(i[0],i[1])}yield e.whenTransactionsFinished()})}}}(Po),Po.debug=Io;var To={},Bo=Po;function Po(e){e.hasOwnProperty("sourceDir")&&(Po.sourceDir=e.sourceDir),e.types=null!=e.types?e.types:[];var t=[e.db.name,e.connector.name].concat(e.types);for(var n in e.share)t.push(e.share[n]);return new Promise(function(n,r){null==e?r("An options object is expected! "):null==e.connector?r("You must specify a connector! (missing connector property)"):null==e.connector.name?r("You must specify connector name! (missing connector.name property)"):null==e.db?r("You must specify a database! (missing db property)"):null==e.connector.name?r("You must specify db name! (missing db.name property)"):((e=Po.utils.copyObject(e)).connector=Po.utils.copyObject(e.connector),e.db=Po.utils.copyObject(e.db),e.share=Po.utils.copyObject(e.share),setTimeout(function(){Po.requestModules(t).then(function(){var t=new jo(e);t.db.whenUserIdSet(function(){t.init(function(){n(t)})})}).catch(r)},0))})}Po.requiringModules=To,Po.extend=function(e,t){if(2===arguments.length&&"string"==typeof e)t instanceof Po.utils.CustomTypeDefinition?Po[e]=t.parseArguments:Po[e]=t,null!=To[e]&&(To[e].resolve(),delete To[e]);else for(var n=0;n<arguments.length;n++){var r=arguments[n];if("function"!=typeof r)throw new Error("Expected function!");r(Po)}},Po.requestModules=function(e){var t;t=null===Po.sourceDir?null:Po.sourceDir||"/bower_components";for(var n="undefined"!=typeof regeneratorRuntime?".js":".es6",r=[],i=0;i<e.length;i++){var o=e[i].split("(")[0],s="y-"+o.toLowerCase();if(null==Po[o])if(null==To[o])if("undefined"!=typeof window&&"undefined"!==window.Y){if(null!=t){var a=document.createElement("script");a.src=t+"/"+s+"/"+s+n,document.head.appendChild(a)}let e={};To[o]=e,e.promise=new Promise(function(t){e.resolve=t}),r.push(e.promise)}else x()(Po);else r.push(To[e[i]].promise)}return Promise.all(r)};class jo{constructor(e,t){this.options=e,this.db=new Po[e.db.name](this,e.db),this.connector=new Po[e.connector.name](this,e.connector),this.connected=!0}init(e){var t=this.options,n={};this.share=n,this.db.requestTransaction(function*(){for(var r in t.share){var i=t.share[r].split("("),o=i.splice(0,1),s=Po[o],a=s.typeDefinition,u=["_",a.struct+"_"+o+"_"+r+"_"+i],c=[];if(1===i.length){try{c=JSON.parse("["+i[0].split(")")[0]+"]")}catch(e){throw new Error("Was not able to parse type definition! (share."+r+")")}if(null==s.typeDefinition.parseArguments)throw new Error(o+" does not expect arguments!");c=a.parseArguments(c[0])[1]}n[r]=yield*this.store.initType.call(this,u,c)}this.store.whenTransactionsFinished().then(e)})}isConnected(){return this.connector.isSynced}disconnect(){return this.connected?(this.connected=!1,this.connector.disconnect()):Promise.resolve()}reconnect(){return this.connected?Promise.resolve():(this.connected=!0,this.connector.reconnect())}destroy(){var e=this;return this.close().then(function(){return null!=e.db.deleteDB?e.db.deleteDB():Promise.resolve()})}close(){var e=this;return this.share=null,null!=this.connector.destroy?this.connector.destroy():this.connector.disconnect(),this.db.whenTransactionsFinished(function(){return this.db.destroyTypes(),this.db.requestTransaction(function*(){yield*e.db.destroy()}),this.db.whenTransactionsFinished()})}}var Ro=function(e){class t{constructor(e){if(this.val=e,this.color=!0,this._left=null,this._right=null,this._parent=null,null===e.id)throw new Error("You must define id!")}isRed(){return this.color}isBlack(){return!this.color}redden(){return this.color=!0,this}blacken(){return this.color=!1,this}get grandparent(){return this.parent.parent}get parent(){return this._parent}get sibling(){return this===this.parent.left?this.parent.right:this.parent.left}get left(){return this._left}get right(){return this._right}set left(e){null!==e&&(e._parent=this),this._left=e}set right(e){null!==e&&(e._parent=this),this._right=e}rotateLeft(e){var t=this.parent,n=this.right,r=this.right.left;if(n.left=this,this.right=r,null===t)e.root=n,n._parent=null;else if(t.left===this)t.left=n;else{if(t.right!==this)throw new Error("The elements are wrongly connected!");t.right=n}}next(){if(null!==this.right){for(var e=this.right;null!==e.left;)e=e.left;return e}for(var t=this;null!==t.parent&&t!==t.parent.left;)t=t.parent;return t.parent}prev(){if(null!==this.left){for(var e=this.left;null!==e.right;)e=e.right;return e}for(var t=this;null!==t.parent&&t!==t.parent.right;)t=t.parent;return t.parent}rotateRight(e){var t=this.parent,n=this.left,r=this.left.right;if(n.right=this,this.left=r,null===t)e.root=n,n._parent=null;else if(t.left===this)t.left=n;else{if(t.right!==this)throw new Error("The elements are wrongly connected!");t.right=n}}getUncle(){return this.parent===this.parent.parent.left?this.parent.parent.right:this.parent.parent.left}}e.utils.RBTree=class{constructor(){this.root=null,this.length=0}*findNext(e){return yield*this.findWithLowerBound([e[0],e[1]+1])}*findPrev(e){return yield*this.findWithUpperBound([e[0],e[1]-1])}findNodeWithLowerBound(t){if(void 0===t)throw new Error("You must define from!");var n=this.root;if(null===n)return null;for(;;)if(null!==t&&!e.utils.smaller(t,n.val.id)||null===n.left){if(null===t||!e.utils.smaller(n.val.id,t))return n;if(null===n.right)return n.next();n=n.right}else n=n.left}findNodeWithUpperBound(t){if(void 0===t)throw new Error("You must define from!");var n=this.root;if(null===n)return null;for(;;)if(null!==t&&!e.utils.smaller(n.val.id,t)||null===n.right){if(null===t||!e.utils.smaller(t,n.val.id))return n;if(null===n.left)return n.prev();n=n.left}else n=n.right}findSmallestNode(){for(var e=this.root;null!=e&&null!=e.left;)e=e.left;return e}*findWithLowerBound(e){var t=this.findNodeWithLowerBound(e);return null==t?null:t.val}*findWithUpperBound(e){var t=this.findNodeWithUpperBound(e);return null==t?null:t.val}*iterate(t,n,r,i){var o;for(o=null===n?this.findSmallestNode():this.findNodeWithLowerBound(n);null!==o&&(null===r||e.utils.smaller(o.val.id,r)||e.utils.compareIds(o.val.id,r));)yield*i.call(t,o.val),o=o.next();return!0}*logTable(e,t,n){null==n&&(n=function(){return!0}),null==e&&(e=null),null==t&&(t=null);var r=[];yield*this.iterate(this,e,t,function*(e){if(n(e)){var t={};for(var i in e)"object"==typeof e[i]?t[i]=JSON.stringify(e[i]):t[i]=e[i];r.push(t)}}),console.table}*find(e){var t;return(t=this.findNode(e))?t.val:null}findNode(t){if(null==t||t.constructor!==Array)throw new Error("Expect id to be an array!");var n=this.root;if(null===n)return!1;for(;;){if(null===n)return!1;if(e.utils.smaller(t,n.val.id))n=n.left;else{if(!e.utils.smaller(n.val.id,t))return n;n=n.right}}}*delete(e){if(null==e||e.constructor!==Array)throw new Error("id is expected to be an Array!");var n=this.findNode(e);if(null!=n){if(this.length--,null!==n.left&&null!==n.right){for(var r=n.left;null!==r.right;)r=r.right;n.val=r.val,n=r}var i,o=n.left||n.right;if(null===o?(i=!0,(o=new t({id:0})).blacken(),n.right=o):i=!1,null!==n.parent){if(n.parent.left===n)n.parent.left=o;else{if(n.parent.right!==n)throw new Error("Impossible!");n.parent.right=o}if(n.isBlack()&&(o.isRed()?o.blacken():this._fixDelete(o)),this.root.blacken(),i)if(o.parent.left===o)o.parent.left=null;else{if(o.parent.right!==o)throw new Error("Impossible #3");o.parent.right=null}}else i?this.root=null:(this.root=o,o.blacken(),o._parent=null)}}_fixDelete(e){function t(e){return null===e||e.isBlack()}function n(e){return null!==e&&e.isRed()}if(null!==e.parent){var r=e.sibling;if(n(r)){if(e.parent.redden(),r.blacken(),e===e.parent.left)e.parent.rotateLeft(this);else{if(e!==e.parent.right)throw new Error("Impossible #2");e.parent.rotateRight(this)}r=e.sibling}e.parent.isBlack()&&r.isBlack()&&t(r.left)&&t(r.right)?(r.redden(),this._fixDelete(e.parent)):e.parent.isRed()&&r.isBlack()&&t(r.left)&&t(r.right)?(r.redden(),e.parent.blacken()):(e===e.parent.left&&r.isBlack()&&n(r.left)&&t(r.right)?(r.redden(),r.left.blacken(),r.rotateRight(this),r=e.sibling):e===e.parent.right&&r.isBlack()&&n(r.right)&&t(r.left)&&(r.redden(),r.right.blacken(),r.rotateLeft(this),r=e.sibling),r.color=e.parent.color,e.parent.blacken(),e===e.parent.left?(r.right.blacken(),e.parent.rotateLeft(this)):(r.left.blacken(),e.parent.rotateRight(this)))}}*put(n){if(null==n||null==n.id||n.id.constructor!==Array)throw new Error("v is expected to have an id property which is an Array!");var r=new t(n);if(null!==this.root){for(var i=this.root;;)if(e.utils.smaller(r.val.id,i.val.id)){if(null===i.left){i.left=r;break}i=i.left}else{if(!e.utils.smaller(i.val.id,r.val.id))return i.val=r.val,i;if(null===i.right){i.right=r;break}i=i.right}this._fixInsert(r)}else this.root=r;return this.length++,this.root.blacken(),r}_fixInsert(e){if(null!==e.parent){if(!e.parent.isBlack()){var t=e.getUncle();null!==t&&t.isRed()?(e.parent.blacken(),t.blacken(),e.grandparent.redden(),this._fixInsert(e.grandparent)):(e===e.parent.right&&e.parent===e.grandparent.left?(e.parent.rotateLeft(this),e=e.left):e===e.parent.left&&e.parent===e.grandparent.right&&(e.parent.rotateRight(this),e=e.right),e.parent.blacken(),e.grandparent.redden(),e===e.parent.left?e.grandparent.rotateRight(this):e.grandparent.rotateLeft(this))}}else e.blacken()}*flush(){}}};function Do(e){Ro(e);class t extends e.Transaction{constructor(e){super(e),this.store=e,this.ss=e.ss,this.os=e.os,this.ds=e.ds}}var n=e.utils.RBTree,r=e.utils.createSmallLookupBuffer(n);e.extend("memory",class extends e.AbstractDatabase{constructor(e,t){super(e,t),this.os=new r,this.ds=new n,this.ss=new r}logTable(){this.requestTransaction(function*(){yield*this.os.logTable(),yield*this.ds.logTable(),this.store.gc1.length>0||this.store.gc2.length,JSON.stringify(this.store.listenersById),JSON.stringify(this.store.listenersByIdExecuteNow),this.store.transactionInProgress},!0)}transact(e){for(var n=new t(this);null!==e;){for(var r=e.call(n),i=r.next();!i.done;)i=r.next(i.value);e=this.getNextRequest()}}*destroy(){yield*super.destroy(),delete this.os,delete this.ss,delete this.ds}})}var qo=Do;function Fo(e){class YMap extends e.utils.CustomType{constructor(t,n,r,i){super(),this._model=n.id,this._parent=null,this._deepEventHandler=new e.utils.EventListenerHandler,this.os=t,this.map=e.utils.copyObject(n.map),this.contents=r,this.opContents=i,this.eventHandler=new e.utils.EventHandler(t=>{var n,r="Delete"===t.struct?t.key:t.parentSub;if(n=null!=this.opContents[r]?this.os.getType(this.opContents[r]):this.contents[r],"Insert"===t.struct){var i;if(null===t.left&&!e.utils.compareIds(t.id,this.map[r]))null!=t.opContent?((i=this.os.getType(t.opContent))._parent=this._model,delete this.contents[r],t.deleted?delete this.opContents[r]:this.opContents[r]=t.opContent):(i=t.content[0],delete this.opContents[r],t.deleted?delete this.contents[r]:this.contents[r]=t.content[0]),this.map[r]=t.id,void 0===n?e.utils.bubbleEvent(this,{name:r,object:this,type:"add",value:i}):e.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"update",value:i})}else{if("Delete"!==t.struct)throw new Error("Unexpected Operation!");e.utils.compareIds(this.map[r],t.target)&&(delete this.opContents[r],delete this.contents[r],e.utils.bubbleEvent(this,{name:r,object:this,oldValue:n,type:"delete"}))}})}_getPathToChild(t){return Object.keys(this.opContents).find(n=>e.utils.compareIds(this.opContents[n],t))}_destroy(){this.eventHandler.destroy(),this.eventHandler=null,this.contents=null,this.opContents=null,this._model=null,this._parent=null,this.os=null,this.map=null}get(e){if(null==e||"string"!=typeof e)throw new Error("You must specify a key (as string)!");return null==this.opContents[e]?this.contents[e]:this.os.getType(this.opContents[e])}keys(){return Object.keys(this.contents).concat(Object.keys(this.opContents))}keysPrimitives(){return Object.keys(this.contents)}keysTypes(){return Object.keys(this.opContents)}getPrimitive(t){if(null==t)return e.utils.copyObject(this.contents);if("string"!=typeof t)throw new Error("Key is expected to be a string!");return this.contents[t]}getType(e){if(null==e||"string"!=typeof e)throw new Error("You must specify a key (as string)!");return null!=this.opContents[e]?this.os.getType(this.opContents[e]):null}delete(t){var n=this.map[t];if(null!=n){var r={target:n,struct:"Delete"},i=this.eventHandler,o=e.utils.copyObject(r);o.key=t,this.os.requestTransaction(function*(){yield*i.awaitOps(this,this.applyCreatedOperations,[[r]])}),i.awaitAndPrematurelyCall([o])}}set(t,n){var r=this.map[t]||null,i={id:this.os.getNextOpId(1),left:null,right:r,origin:null,parent:this._model,parentSub:t,struct:"Insert"},o=this.eventHandler,s=e.utils.isTypeDefinition(n);if(!1!==s){var a=this.os.createType(s);return i.opContent=a._model,this.os.requestTransaction(function*(){yield*o.awaitOps(this,this.applyCreatedOperations,[[i]])}),o.awaitAndPrematurelyCall([i]),a}return i.content=[n],this.os.requestTransaction(function*(){yield*o.awaitOps(this,this.applyCreatedOperations,[[i]])}),o.awaitAndPrematurelyCall([i]),n}observe(e){this.eventHandler.addEventListener(e)}observeDeep(e){this._deepEventHandler.addEventListener(e)}unobserve(e){this.eventHandler.removeEventListener(e)}unobserveDeep(e){this._deepEventHandler.removeEventListener(e)}observePath(t,n){var r,i=this;if(t.length<1)return n(this),function(){};if(1===t.length)return r=t[0],n(i.get(r)),this.observe(function(e){e.name===r&&n(i.get(r))}),function(){i.unobserve(n)};var o,s=function(){var r=i.get(t[0]);r instanceof YMap||(r=i.set(t[0],e.Map)),o=r.observePath(t.slice(1),n)},a=function(e){e.name===t[0]&&(null!=o&&o(),"add"!==e.type&&"update"!==e.type||s())};return i.observe(a),s(),function(){null!=o&&o(),i.unobserve(a)}}*_changed(e,t){if("Delete"===t.struct){if(null==t.key){var n=yield*e.getOperation(t.target);t.key=n.parentSub}}else null!=t.opContent&&(yield*e.store.initType.call(e,t.opContent));this.eventHandler.receivedOp(t)}}e.extend("Map",new e.utils.CustomTypeDefinition({name:"Map",class:YMap,struct:"Map",initType:function*(e,t){var n={},r={},i=t.map;for(var o in i){var s=yield*this.getOperation(i[o]);if(!s.deleted)if(null!=s.opContent)r[o]=s.opContent,(yield*this.store.initType.call(this,s.opContent))._parent=t.id;else n[o]=s.content[0]}return new YMap(e,t,n,r)},createType:function(e,t){return new YMap(e,t,{},{})}}))}"undefined"!=typeof Y&&Do(Y);var Lo=Fo;function No(e){class t extends e.utils.CustomType{constructor(t,n,r){super(),this.os=t,this._model=n,this._content=r,this._parent=null,this._deepEventHandler=new e.utils.EventListenerHandler,this.eventHandler=new e.utils.EventHandler(t=>{if("Insert"===t.struct){if(this._content.some(function(n){return e.utils.compareIds(n.id,t.id)}))return;let o;if(null===t.left)o=0;else if((o=1+this._content.findIndex(function(n){return e.utils.compareIds(n.id,t.left)}))<=0)throw new Error("Unexpected operation!");var n,r;if(t.hasOwnProperty("opContent")){this._content.splice(o,0,{id:t.id,type:t.opContent}),r=1;let e=this.os.getType(t.opContent);e._parent=this._model,n=[e]}else{var i=t.content.map(function(e,n){return{id:[t.id[0],t.id[1]+n],val:e}});i.length<3e4?this._content.splice.apply(this._content,[o,0].concat(i)):this._content=this._content.slice(0,o).concat(i).concat(this._content.slice(o)),n=t.content,r=t.content.length}e.utils.bubbleEvent(this,{type:"insert",object:this,index:o,values:n,length:r})}else{if("Delete"!==t.struct)throw new Error("Unexpected struct!");for(var o=0;o<this._content.length&&t.length>0;o++){var s=this._content[o];if(e.utils.inDeletionRange(t,s.id)){var a;for(a=1;a<t.length&&o+a<this._content.length&&e.utils.inDeletionRange(t,this._content[o+a].id);a++);s=this._content[o+a-1],t.length-=s.id[1]-t.target[1]+1,t.target=[s.id[0],s.id[1]+1];let n=this._content.splice(o,a),r=n.map(e=>null!=e.val?e.val:this.os.getType(e.type));e.utils.bubbleEvent(this,{type:"delete",object:this,index:o,values:r,_content:n,length:a})}}}})}_getPathToChild(t){return this._content.findIndex(n=>null!=n.type&&e.utils.compareIds(n.type,t))}_destroy(){this.eventHandler.destroy(),this.eventHandler=null,this._content=null,this._model=null,this._parent=null,this.os=null}get length(){return this._content.length}get(e){if(null==e||"number"!=typeof e)throw new Error("pos must be a number!");if(!(e>=this._content.length))return null==this._content[e].type?this._content[e].val:this.os.getType(this._content[e].type)}toArray(){return this._content.map((e,t)=>null!=e.type?this.os.getType(e.type):e.val)}push(e){return this.insert(this._content.length,e)}insert(t,n){if("number"!=typeof t)throw new Error("pos must be a number!");if(!Array.isArray(n))throw new Error("contents must be an Array of objects!");if(0!==n.length){if(t>this._content.length||t<0)throw new Error("This position exceeds the range of the array!");for(var r=0===t?null:this._content[t-1].id,i=[],o=r,s=0;s<n.length;){for(var a,u={left:o,origin:o,parent:this._model,struct:"Insert"},c=[];s<n.length;){var l=n[s++];if(a=e.utils.isTypeDefinition(l)){if(c.length>0){s--;break}break}c.push(l)}if(c.length>0)u.content=c,u.id=this.os.getNextOpId(c.length);else{var f=this.os.getNextOpId(1);this.os.createType(a,f),u.opContent=f,u.id=this.os.getNextOpId(1)}i.push(u),o=u.id}var h=this.eventHandler;this.os.requestTransaction(function*(){var e;null!=r?e=(yield*this.getInsertionCleanEnd(r)).right:e=(yield*this.getOperation(i[0].parent)).start;for(var t=0;t<i.length;t++){i[t].right=e}yield*h.awaitOps(this,this.applyCreatedOperations,[i])}),h.awaitAndPrematurelyCall(i)}}delete(t,n){if(null==n&&(n=1),"number"!=typeof n)throw new Error("length must be a number!");if("number"!=typeof t)throw new Error("pos must be a number!");if(t+n>this._content.length||t<0||n<0)throw new Error("The deletion range exceeds the range of the array!");if(0!==n){for(var r=this.eventHandler,i=[],o=0;o<n;o+=s){var s,a=this._content[t+o].id;for(s=1;o+s<n&&e.utils.compareIds(this._content[t+o+s].id,[a[0],a[1]+s]);s++);i.push({target:a,struct:"Delete",length:s})}this.os.requestTransaction(function*(){yield*r.awaitOps(this,this.applyCreatedOperations,[i])}),r.awaitAndPrematurelyCall(i)}}observe(e){this.eventHandler.addEventListener(e)}observeDeep(e){this._deepEventHandler.addEventListener(e)}unobserve(e){this.eventHandler.removeEventListener(e)}unobserveDeep(e){this._deepEventHandler.removeEventListener(e)}*_changed(e,t){if(!t.deleted){if("Insert"===t.struct){for(var n,r=t.left;null!=r&&(n=yield*e.getInsertion(r)).deleted;)r=n.left;t.left=r,null!=t.opContent&&(yield*e.store.initType.call(e,t.opContent))}this.eventHandler.receivedOp(t)}}}e.extend("Array",new e.utils.CustomTypeDefinition({name:"Array",class:t,struct:"List",initType:function*(n,r){var i=[],o=[];yield*e.Struct.List.map.call(this,r,function(e){e.hasOwnProperty("opContent")?(i.push({id:e.id,type:e.opContent}),o.push(e.opContent)):e.content.forEach(function(t,n){i.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})});for(var s=0;s<o.length;s++){(yield*this.store.initType.call(this,o[s]))._parent=r.id}return new t(n,r.id,i)},createType:function(e,n){return new t(e,n.id,[])}}))}"undefined"!=typeof Y&&Fo(Y);var Mo=No;"undefined"!=typeof Y&&No(Y);var Uo=-1,$o=1,zo=0;function Yo(e,t,n){if(e==t)return e?[[zo,e]]:[];(n<0||e.length<n)&&(n=null);var r=Ho(e,t),i=e.substring(0,r);r=Vo(e=e.substring(r),t=t.substring(r));var o=e.substring(e.length-r),s=function(e,t){var n;if(!e)return[[$o,t]];if(!t)return[[Uo,e]];var r=e.length>t.length?e:t,i=e.length>t.length?t:e,o=r.indexOf(i);if(-1!=o)return n=[[$o,r.substring(0,o)],[zo,i],[$o,r.substring(o+i.length)]],e.length>t.length&&(n[0][0]=n[2][0]=Uo),n;if(1==i.length)return[[Uo,e],[$o,t]];var s=function(e,t){var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(n.length<4||2*r.length<n.length)return null;function i(e,t,n){for(var r,i,o,s,a=e.substring(n,n+Math.floor(e.length/4)),u=-1,c="";-1!=(u=t.indexOf(a,u+1));){var l=Ho(e.substring(n),t.substring(u)),f=Vo(e.substring(0,n),t.substring(0,u));c.length<f+l&&(c=t.substring(u-f,u)+t.substring(u,u+l),r=e.substring(0,n-f),i=e.substring(n+l),o=t.substring(0,u-f),s=t.substring(u+l))}return 2*c.length>=e.length?[r,i,o,s,c]:null}var o,s,a,u,c,l=i(n,r,Math.ceil(n.length/4)),f=i(n,r,Math.ceil(n.length/2));if(!l&&!f)return null;o=f?l&&l[4].length>f[4].length?l:f:l;e.length>t.length?(s=o[0],a=o[1],u=o[2],c=o[3]):(u=o[0],c=o[1],s=o[2],a=o[3]);var h=o[4];return[s,a,u,c,h]}(e,t);if(s){var a=s[0],u=s[1],c=s[2],l=s[3],f=s[4],h=Yo(a,c),d=Yo(u,l);return h.concat([[zo,f]],d)}return function(e,t){for(var n=e.length,r=t.length,i=Math.ceil((n+r)/2),o=i,s=2*i,a=new Array(s),u=new Array(s),c=0;c<s;c++)a[c]=-1,u[c]=-1;a[o+1]=0,u[o+1]=0;for(var l=n-r,f=l%2!=0,h=0,d=0,p=0,g=0,v=0;v<i;v++){for(var y=-v+h;y<=v-d;y+=2){for(var m=o+y,b=(A=y==-v||y!=v&&a[m-1]<a[m+1]?a[m+1]:a[m-1]+1)-y;A<n&&b<r&&e.charAt(A)==t.charAt(b);)A++,b++;if(a[m]=A,A>n)d+=2;else if(b>r)h+=2;else if(f){var w=o+l-y;if(w>=0&&w<s&&-1!=u[w]){var _=n-u[w];if(A>=_)return Jo(e,t,A,b)}}}for(var C=-v+p;C<=v-g;C+=2){for(var w=o+C,k=(_=C==-v||C!=v&&u[w-1]<u[w+1]?u[w+1]:u[w-1]+1)-C;_<n&&k<r&&e.charAt(n-_-1)==t.charAt(r-k-1);)_++,k++;if(u[w]=_,_>n)g+=2;else if(k>r)p+=2;else if(!f){var m=o+l-C;if(m>=0&&m<s&&-1!=a[m]){var A=a[m],b=o+A-m;if(A>=(_=n-_))return Jo(e,t,A,b)}}}}return[[Uo,e],[$o,t]]}(e,t)}(e=e.substring(0,e.length-r),t=t.substring(0,t.length-r));return i&&s.unshift([zo,i]),o&&s.push([zo,o]),function e(t){t.push([zo,""]);var n=0;var r=0;var i=0;var o="";var s="";var a;for(;n<t.length;)switch(t[n][0]){case $o:i++,s+=t[n][1],n++;break;case Uo:r++,o+=t[n][1],n++;break;case zo:r+i>1?(0!==r&&0!==i&&(0!==(a=Ho(s,o))&&(n-r-i>0&&t[n-r-i-1][0]==zo?t[n-r-i-1][1]+=s.substring(0,a):(t.splice(0,0,[zo,s.substring(0,a)]),n++),s=s.substring(a),o=o.substring(a)),0!==(a=Vo(s,o))&&(t[n][1]=s.substring(s.length-a)+t[n][1],s=s.substring(0,s.length-a),o=o.substring(0,o.length-a))),0===r?t.splice(n-i,r+i,[$o,s]):0===i?t.splice(n-r,r+i,[Uo,o]):t.splice(n-r-i,r+i,[Uo,o],[$o,s]),n=n-r-i+(r?1:0)+(i?1:0)+1):0!==n&&t[n-1][0]==zo?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,i=0,r=0,o="",s=""}""===t[t.length-1][1]&&t.pop();var u=!1;n=1;for(;n<t.length-1;)t[n-1][0]==zo&&t[n+1][0]==zo&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),u=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),u=!0)),n++;u&&e(t)}(s),null!=n&&(s=function(e,t){var n=function(e,t){if(0===t)return[zo,e];for(var n=0,r=0;r<e.length;r++){var i=e[r];if(i[0]===Uo||i[0]===zo){var o=n+i[1].length;if(t===o)return[r+1,e];if(t<o){e=e.slice();var s=t-n,a=[i[0],i[1].slice(0,s)],u=[i[0],i[1].slice(s)];return e.splice(r,1,a,u),[r+1,e]}n=o}}throw new Error("cursor_pos is out of bounds!")}(e,t),r=n[1],i=n[0],o=r[i],s=r[i+1];if(null==o)return e;if(o[0]!==zo)return e;if(null!=s&&o[1]+s[1]===s[1]+o[1])return r.splice(i,2,s,o),Go(r,i,2);if(null!=s&&0===s[1].indexOf(o[1])){r.splice(i,2,[s[0],o[1]],[0,o[1]]);var a=s[1].slice(o[1].length);return a.length>0&&r.splice(i+2,0,[s[0],a]),Go(r,i,3)}return e}(s,n)),s=function(e){for(var t=!1,n=function(e){return e.charCodeAt(0)>=56320&&e.charCodeAt(0)<=57343},r=2;r<e.length;r+=1)e[r-2][0]===zo&&((i=e[r-2][1]).charCodeAt(i.length-1)>=55296&&i.charCodeAt(i.length-1)<=56319)&&e[r-1][0]===Uo&&n(e[r-1][1])&&e[r][0]===$o&&n(e[r][1])&&(t=!0,e[r-1][1]=e[r-2][1].slice(-1)+e[r-1][1],e[r][1]=e[r-2][1].slice(-1)+e[r][1],e[r-2][1]=e[r-2][1].slice(0,-1));var i;if(!t)return e;for(var o=[],r=0;r<e.length;r+=1)e[r][1].length>0&&o.push(e[r]);return o}(s)}function Jo(e,t,n,r){var i=e.substring(0,n),o=t.substring(0,r),s=e.substring(n),a=t.substring(r),u=Yo(i,o),c=Yo(s,a);return u.concat(c)}function Ho(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(o,i)==t.substring(o,i)?o=n=i:r=i,i=Math.floor((r-n)/2+n);return i}function Vo(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?o=n=i:r=i,i=Math.floor((r-n)/2+n);return i}var Wo=Yo;Wo.INSERT=$o,Wo.DELETE=Uo,Wo.EQUAL=zo;var Ko=Wo;function Go(e,t,n){for(var r=t+n-1;r>=0&&r>=t-1;r--)if(r+1<e.length){var i=e[r],o=e[r+1];i[0]===o[1]&&e.splice(r,2,[i[0],i[1]+o[1]])}return e}var Xo={major:0,minor:0};function Qo(e){e.requestModules(["Array"]).then(function(){class t extends e.Array.typeDefinition.class{constructor(e,t,n){super(e,t,n),this.textfields=[],this.aceInstances=[],this.codeMirrorInstances=[],this.monacoInstances=[]}toString(){return this._content.map(function(e){return e.val}).join("")}insert(e,t){for(var n=t.split(""),r=0;r<n.length;r++)/[\uD800-\uDFFF]/.test(n[r])&&(n[r]=n[r]+n[r+1],n[r+1]="",r++);super.insert(e,n)}delete(e,t){if(null==t&&(t=1),"number"!=typeof t)throw new Error("length must be a number!");if("number"!=typeof e)throw new Error("pos must be a number!");if(e+t>this._content.length||e<0||t<0)throw new Error("The deletion range exceeds the range of the array!");if(0!==t)if(this._content.length>e+t&&""===this._content[e+t].val&&2===this._content[e+t-1].val.length){let n=this._content[e+t-1].val[0];super.delete(e,t+1),super.insert(e,[n])}else if(e>0&&""===this._content[e].val&&2===this._content[e-1].val.length){let n=this._content[e-1].val[1];super.delete(e-1,t+1),super.insert(e-1,[n])}else super.delete(e,t)}unbindAll(){this.unbindTextareaAll(),this.unbindAceAll(),this.unbindCodeMirrorAll(),this.unbindMonacoAll()}unbindMonaco(e){var t=this.monacoInstances.findIndex(function(t){return t.editor===e});if(t>=0){var n=this.monacoInstances[t];this.unobserve(n.yCallback),n.disposeBinding(),this.monacoInstances.splice(t,1)}}unbindMonacoAll(){for(let e=this.monacoInstances.length-1;e>=0;e--)this.unbindMonaco(this.monacoInstances[e].editor)}bindMonaco(e,t){var n=this;t=t||{};var r=!0;function i(e){if(r){r=!1;try{e()}catch(e){throw r=!0,new Error(e)}r=!0}}function o(e){i(function(){for(var t=0,r=1;r<e.range.startLineNumber;t++)"\n"===n._content[t].val&&r++;var i=t+e.range.startColumn-1;e.rangeLength>0&&n.delete(i,e.rangeLength),n.insert(i,e.text)})}e.setValue(this.toString());var s=e.onDidChangeModelContent(o).dispose;function a(t){i(function(){let n=e.model.getPositionAt(t.index);var r,i;"insert"===t.type?(r=n,i=t.values.join("")):"delete"===t.type&&(r=e.model.modifyPosition(n,t.length),i="");var o={startLineNumber:n.lineNumber,startColumn:n.column,endLineNumber:r.lineNumber,endColumn:r.column},s={major:Xo.major,minor:Xo.minor++};e.executeEdits("Yjs",[{id:s,range:o,text:i,forceMoveMarkers:!0}])})}this.observe(a),this.monacoInstances.push({editor:e,yCallback:a,monacoCallback:o,disposeBinding:s})}unbindCodeMirror(e){var t=this.codeMirrorInstances.findIndex(function(t){return t.editor===e});if(t>=0){var n=this.codeMirrorInstances[t];this.unobserve(n.yCallback),n.editor.off("changes",n.codeMirrorCallback),this.codeMirrorInstances.splice(t,1)}}unbindCodeMirrorAll(){for(let e=this.codeMirrorInstances.length-1;e>=0;e--)this.unbindCodeMirror(this.codeMirrorInstances[e].editor)}bindCodeMirror(e,t){var n=this;t=t||{};var r=!0;function i(e){if(r){r=!1;try{e()}catch(e){throw r=!0,new Error(e)}r=!0}}function o(t,r){i(function(){for(var t=0;t<r.length;t++){var i=r[t],o=e.indexFromPos(i.from);if(i.removed.length>0){for(var s=0,a=0;a<i.removed.length;a++)s+=i.removed[a].length;s+=i.removed.length-1,n.delete(o,s)}n.insert(o,i.text.join("\n"))}})}function s(t){i(function(){let n=e.posFromIndex(t.index);if("insert"===t.type){let r=n;e.replaceRange(t.values.join(""),n,r)}else if("delete"===t.type){let r=e.posFromIndex(t.index+t.length);e.replaceRange("",n,r)}})}e.setValue(this.toString()),e.on("changes",o),this.observe(s),this.codeMirrorInstances.push({editor:e,yCallback:s,codeMirrorCallback:o})}unbindAce(e){var t=this.aceInstances.findIndex(function(t){return t.editor===e});if(t>=0){var n=this.aceInstances[t];this.unobserve(n.yCallback),n.editor.off("change",n.aceCallback),this.aceInstances.splice(t,1)}}unbindAceAll(){for(let e=this.aceInstances.length-1;e>=0;e--)this.unbindAce(this.aceInstances[e].editor)}bindAce(e,t){var n=this;t=t||{};var r,i=!0;function o(e){if(i){i=!1;try{e()}catch(e){throw i=!0,new Error(e)}i=!0}}function s(t){o(function(){var r,i,o=e.getSession().getDocument();"insert"===t.action?(r=o.positionToIndex(t.start,0),n.insert(r,t.lines.join("\n"))):"remove"===t.action&&(r=o.positionToIndex(t.start,0),i=t.lines.join("\n").length,n.delete(r,i))})}e.setValue(this.toString()),e.on("change",s),e.selection.clearSelection(),r="undefined"!=typeof ace&&null==t.aceClass?ace:t.aceClass;var a=(t.aceRequire||r.require)("ace/range").Range;function u(t){var n=e.getSession().getDocument();o(function(){if("insert"===t.type){let e=n.indexToPosition(t.index,0);n.insert(e,t.values.join(""))}else if("delete"===t.type){let r=n.indexToPosition(t.index,0),i=n.indexToPosition(t.index+t.length,0);var e=new a(r.row,r.column,i.row,i.column);n.remove(e)}})}this.observe(u),this.aceInstances.push({editor:e,yCallback:u,aceCallback:s})}bind(){var e=arguments[0];e instanceof Element?this.bindTextarea.apply(this,arguments):null!=e&&null!=e.session&&null!=e.getSession&&null!=e.setValue?this.bindAce.apply(this,arguments):null!=e&&null!=e.posFromIndex&&null!=e.replaceRange?this.bindCodeMirror.apply(this,arguments):null!=e&&null!=e.onDidChangeModelContent&&this.bindMonaco.apply(this,arguments)}unbindTextarea(e){var t=this.textfields.findIndex(function(t){return t.editor===e});if(t>=0){var n=this.textfields[t];this.unobserve(n.yCallback),n.editor.removeEventListener("input",n.eventListener),this.textfields.splice(t,1)}}unbindTextareaAll(){for(let e=this.textfields.length-1;e>=0;e--)this.unbindTextarea(this.textfields[e].editor)}bindTextarea(e,t){null==(t=t||window).getSelection&&(t=window);for(var n=0;n<this.textfields.length;n++)if(this.textfields[n].editor===e)return;var r=!0;function i(e){if(r){r=!1;try{e()}catch(e){throw r=!0,new Error(e)}r=!0}}var o,s,a,u,c=this;function l(e){i(()=>{var t;if("insert"===e.type){t=e.index;var n=o(function(e){return e<=t?e:e+=1});s(n)}else"delete"===e.type&&(t=e.index,n=o(function(e){return e<t?e:e-=1}),s(n))})}e.value=this.toString(),null!=e.selectionStart&&null!=e.setSelectionRange?(o=function(t){var n=e.selectionStart,r=e.selectionEnd;return null!=t&&(n=t(n),r=t(r)),{left:n,right:r}},s=function(t){a(c.toString()),e.setSelectionRange(t.left,t.right)},a=function(t){e.value=t},u=function(){return e.value}):(o=function(n){var r={},i=t.getSelection(),o=e.textContent.length;r.left=Math.min(i.anchorOffset,o),r.right=Math.min(i.focusOffset,o),null!=n&&(r.left=n(r.left),r.right=n(r.right));var s=i.focusNode;return s===e||s===e.childNodes[0]?r.isReal=!0:r.isReal=!1,r},s=function(n){a(c.toString());var r=e.childNodes[0];if(n.isReal&&null!=r){n.left<0&&(n.left=0),n.right=Math.max(n.left,n.right),n.right>r.length&&(n.right=r.length),n.left=Math.min(n.left,n.right);var i=document.createRange();i.setStart(r,n.left),i.setEnd(r,n.right);var o=t.getSelection();o.removeAllRanges(),o.addRange(i)}},a=function(t){e.innerText=t},u=function(){return e.innerText}),a(this.toString()),this.observe(l);var f=function(){i(function(){for(var e=o(function(e){return e}),t=c.toString(),n=u(),r=Ko(t,n,e.left),i=0,s=0;s<r.length;s++){var a=r[s];0===a[0]?i+=a[1].length:-1===a[0]?c.delete(i,a[1].length):(c.insert(i,a[1]),i+=a[1].length)}})};e.addEventListener("input",f),this.textfields.push({editor:e,yCallback:l,eventListener:f})}_destroy(){this.unbindAll(),this.textfields=null,this.aceInstances=null,super._destroy()}}e.extend("Text",new e.utils.CustomTypeDefinition({name:"Text",class:t,struct:"List",initType:function*(n,r){var i=[];return yield*e.Struct.List.map.call(this,r,function(e){if(e.hasOwnProperty("opContent"))throw new Error("Text must not contain types!");e.content.forEach(function(t,n){i.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),new t(n,r.id,i)},createType:function(e,n){return new t(e,n.id,[])}}))})}var Zo=Qo;"undefined"!=typeof Y&&Qo(Y);var es=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ns=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var i=es.exec(e||""),o={},s=14;s--;)o[ts[s]]=i[s]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o},rs=I(function(e,t){function n(e){var n;function i(){if(i.enabled){var e=i,r=+new Date,o=r-(n||r);e.diff=o,e.prev=n,e.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=s[u];n=i.call(e,o),s.splice(u,1),u--}return n}),t.formatArgs.call(e,s),(i.log||t.log||void 0).apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),i.destroy=r,"function"==typeof t.init&&t.init(i),t.instances.push(i),i}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Oo,t.instances=[],t.names=[],t.skips=[],t.formatters={}}),is=(rs.coerce,rs.disable,rs.enable,rs.enabled,rs.humanize,rs.instances,rs.names,rs.skips,rs.formatters,I(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==A&&"env"in A&&(e=A.env.DEBUG),e}(t=e.exports=rs).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())})),os=(is.log,is.formatArgs,is.save,is.load,is.useColors,is.storage,is.colors,is("socket.io-client:url")),ss=function(e,t){var n=e;t=t||S.location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(os("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),os("parse %s",e),n=ns(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n};var as=I(function(e,t){function n(e){var n;function i(){if(i.enabled){var e=i,r=+new Date,o=r-(n||r);e.diff=o,e.prev=n,e.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=s[u];n=i.call(e,o),s.splice(u,1),u--}return n}),t.formatArgs.call(e,s),(i.log||t.log||void 0).apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),i.destroy=r,"function"==typeof t.init&&t.init(i),t.instances.push(i),i}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Oo,t.instances=[],t.names=[],t.skips=[],t.formatters={}}),us=(as.coerce,as.disable,as.enable,as.enabled,as.humanize,as.instances,as.names,as.skips,as.formatters,I(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==A&&"env"in A&&(e=A.env.DEBUG),e}(t=e.exports=as).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())})),cs=(us.log,us.formatArgs,us.save,us.load,us.useColors,us.storage,us.colors,I(function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}})),ls={}.toString,fs=Array.isArray||function(e){return"[object Array]"==ls.call(e)},hs=function(e){return ds&&S.Buffer.isBuffer(e)||ps&&(e instanceof S.ArrayBuffer||gs(e))},ds="function"==typeof S.Buffer&&"function"==typeof S.Buffer.isBuffer,ps="function"==typeof S.ArrayBuffer,gs=ps&&"function"==typeof S.ArrayBuffer.isView?S.ArrayBuffer.isView:function(e){return e.buffer instanceof S.ArrayBuffer};var vs=Object.prototype.toString,ys="function"==typeof S.Blob||"[object BlobConstructor]"===vs.call(S.Blob),ms="function"==typeof S.File||"[object FileConstructor]"===vs.call(S.File);var bs={deconstructPacket:function(e){var t=[],n=e.data,r=e;return r.data=function e(t,n){if(!t)return t;if(hs(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(fs(t)){for(var i=new Array(t.length),o=0;o<t.length;o++)i[o]=e(t[o],n);return i}if("object"==typeof t&&!(t instanceof Date)){var i={};for(var s in t)i[s]=e(t[s],n);return i}return t}(n,t),r.attachments=t.length,{packet:r,buffers:t}},reconstructPacket:function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(fs(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var i in t)t[i]=e(t[i],n);return t}(e.data,t),e.attachments=void 0,e},removeBlobs:function(e,t){var n=0,r=e;!function e(i,o,s){if(!i)return i;if(ys&&i instanceof Blob||ms&&i instanceof File){n++;var a=new FileReader;a.onload=function(){s?s[o]=this.result:r=this.result,--n||t(r)},a.readAsArrayBuffer(i)}else if(fs(i))for(var u=0;u<i.length;u++)e(i[u],u,i);else if("object"==typeof i&&!hs(i))for(var c in i)e(i[c],c,i)}(r),n||t(r)}},ws=I(function(e,t){var n=us("socket.io-parser");function r(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=s;var i=t.ERROR+'"encode error"';function o(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var o=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===o)return i;r+=o}return n("encoded %j as %s",e,r),r}function s(){this.reconstructor=null}function a(e){this.reconPack=e,this.buffers=[]}function u(e){return{type:t.ERROR,data:"parser error: "+e}}r.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){bs.removeBlobs(e,function(e){var n=bs.deconstructPacket(e),r=o(n.packet),i=n.buffers;i.unshift(r),t(i)})}(e,r):r([o(e)])},cs(s.prototype),s.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,i={type:Number(e.charAt(0))};if(null==t.types[i.type])return u("unknown packet type "+i.type);if(t.BINARY_EVENT===i.type||t.BINARY_ACK===i.type){for(var o="";"-"!==e.charAt(++r)&&(o+=e.charAt(r),r!=e.length););if(o!=Number(o)||"-"!==e.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(r+1))for(i.nsp="";++r;){var s=e.charAt(r);if(","===s)break;if(i.nsp+=s,r===e.length)break}else i.nsp="/";var a=e.charAt(r+1);if(""!==a&&Number(a)==a){for(i.id="";++r;){var s=e.charAt(r);if(null==s||Number(s)!=s){--r;break}if(i.id+=e.charAt(r),r===e.length)break}i.id=Number(i.id)}if(e.charAt(++r)){var c=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r)),l=!1!==c&&(i.type===t.ERROR||fs(c));if(!l)return u("invalid payload");i.data=c}return n("decoded %s as %j",e,i),i}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new a(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!hs(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=bs.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),_s=(ws.protocol,ws.types,ws.CONNECT,ws.DISCONNECT,ws.EVENT,ws.ACK,ws.ERROR,ws.BINARY_EVENT,ws.BINARY_ACK,ws.Encoder,ws.Decoder,I(function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}})),Cs=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||_s))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(S[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},ks=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},As=[],Es=[],Os="undefined"!=typeof Uint8Array?Uint8Array:Array,Ss=!1;function xs(){Ss=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)As[t]=e[t],Es[e.charCodeAt(t)]=t;Es["-".charCodeAt(0)]=62,Es["_".charCodeAt(0)]=63}function Is(e,t,n){for(var r,i,o=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(As[(i=r)>>18&63]+As[i>>12&63]+As[i>>6&63]+As[63&i]);return o.join("")}function Ts(e){var t;Ss||xs();for(var n=e.length,r=n%3,i="",o=[],s=0,a=n-r;s<a;s+=16383)o.push(Is(e,s,s+16383>a?a:s+16383));return 1===r?(t=e[n-1],i+=As[t>>2],i+=As[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=As[t>>10],i+=As[t>>4&63],i+=As[t<<2&63],i+="="),o.push(i),o.join("")}function Bs(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,d=e[t+f];for(f+=h,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)}function Ps(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*u-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+d]=255&s,d+=p,s/=256,c-=8);e[n+d-p]|=128*g}var js={}.toString,Rs=Array.isArray||function(e){return"[object Array]"==js.call(e)};function Ds(){return Fs.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function qs(e,t){if(Ds()<t)throw new RangeError("Invalid typed array length");return Fs.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Fs.prototype:(null===e&&(e=new Fs(t)),e.length=t),e}function Fs(e,t,n){if(!(Fs.TYPED_ARRAY_SUPPORT||this instanceof Fs))return new Fs(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Ms(this,e)}return Ls(this,e,t,n)}function Ls(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);Fs.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Fs.prototype:e=Us(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!Fs.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|Ys(t,n),i=(e=qs(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(zs(t)){var n=0|$s(t.length);return 0===(e=qs(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?qs(e,0):Us(e,t);if("Buffer"===t.type&&Rs(t.data))return Us(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Ns(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Ms(e,t){if(Ns(t),e=qs(e,t<0?0:0|$s(t)),!Fs.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Us(e,t){var n=t.length<0?0:0|$s(t.length);e=qs(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function $s(e){if(e>=Ds())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ds().toString(16)+" bytes");return 0|e}function zs(e){return!(null==e||!e._isBuffer)}function Ys(e,t){if(zs(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return va(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ya(e).length;default:if(r)return va(e).length;t=(""+t).toLowerCase(),r=!0}}function Js(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Hs(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=Fs.from(t,r)),zs(t))return 0===t.length?-1:Vs(e,t,n,r,i);if("number"==typeof t)return t&=255,Fs.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Vs(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function Vs(e,t,n,r,i){var o,s=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(e,o+h)!==c(t,h)){f=!1;break}if(f)return o}return-1}function Ws(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function Ks(e,t,n,r){return ma(va(t,e.length-n),e,n,r)}function Gs(e,t,n,r){return ma(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function Xs(e,t,n,r){return Gs(e,t,n,r)}function Qs(e,t,n,r){return ma(ya(t),e,n,r)}function Zs(e,t,n,r){return ma(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function ea(e,t,n){return 0===t&&n===e.length?Ts(e):Ts(e.slice(t,n))}function ta(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=na)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=na));return n}(r)}Fs.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT,Fs.poolSize=8192,Fs._augment=function(e){return e.__proto__=Fs.prototype,e},Fs.from=function(e,t,n){return Ls(null,e,t,n)},Fs.TYPED_ARRAY_SUPPORT&&(Fs.prototype.__proto__=Uint8Array.prototype,Fs.__proto__=Uint8Array),Fs.alloc=function(e,t,n){return function(e,t,n,r){return Ns(t),t<=0?qs(e,t):void 0!==n?"string"==typeof r?qs(e,t).fill(n,r):qs(e,t).fill(n):qs(e,t)}(null,e,t,n)},Fs.allocUnsafe=function(e){return Ms(null,e)},Fs.allocUnsafeSlow=function(e){return Ms(null,e)},Fs.isBuffer=ba,Fs.compare=function(e,t){if(!zs(e)||!zs(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},Fs.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Fs.concat=function(e,t){if(!Rs(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Fs.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=Fs.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!zs(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},Fs.byteLength=Ys,Fs.prototype._isBuffer=!0,Fs.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Js(this,t,t+1);return this},Fs.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Js(this,t,t+3),Js(this,t+1,t+2);return this},Fs.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Js(this,t,t+7),Js(this,t+1,t+6),Js(this,t+2,t+5),Js(this,t+3,t+4);return this},Fs.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?ta(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return oa(this,t,n);case"utf8":case"utf-8":return ta(this,t,n);case"ascii":return ra(this,t,n);case"latin1":case"binary":return ia(this,t,n);case"base64":return ea(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return sa(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},Fs.prototype.equals=function(e){if(!zs(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Fs.compare(this,e)},Fs.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Fs.prototype.compare=function(e,t,n,r,i){if(!zs(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),c=e.slice(t,n),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],s=c[l];break}return o<s?-1:s<o?1:0},Fs.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Fs.prototype.indexOf=function(e,t,n){return Hs(this,e,t,n,!0)},Fs.prototype.lastIndexOf=function(e,t,n){return Hs(this,e,t,n,!1)},Fs.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return Ws(this,e,t,n);case"utf8":case"utf-8":return Ks(this,e,t,n);case"ascii":return Gs(this,e,t,n);case"latin1":case"binary":return Xs(this,e,t,n);case"base64":return Qs(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Zs(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Fs.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var na=4096;function ra(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function ia(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function oa(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=ga(e[o]);return i}function sa(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function aa(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function ua(e,t,n,r,i,o){if(!zs(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function ca(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function la(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function fa(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function ha(e,t,n,r,i){return i||fa(e,0,n,4),Ps(e,t,n,r,23,4),n+4}function da(e,t,n,r,i){return i||fa(e,0,n,8),Ps(e,t,n,r,52,8),n+8}Fs.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),Fs.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Fs.prototype;else{var i=t-e;n=new Fs(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},Fs.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||aa(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},Fs.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||aa(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},Fs.prototype.readUInt8=function(e,t){return t||aa(e,1,this.length),this[e]},Fs.prototype.readUInt16LE=function(e,t){return t||aa(e,2,this.length),this[e]|this[e+1]<<8},Fs.prototype.readUInt16BE=function(e,t){return t||aa(e,2,this.length),this[e]<<8|this[e+1]},Fs.prototype.readUInt32LE=function(e,t){return t||aa(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Fs.prototype.readUInt32BE=function(e,t){return t||aa(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Fs.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||aa(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},Fs.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||aa(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},Fs.prototype.readInt8=function(e,t){return t||aa(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Fs.prototype.readInt16LE=function(e,t){t||aa(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Fs.prototype.readInt16BE=function(e,t){t||aa(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Fs.prototype.readInt32LE=function(e,t){return t||aa(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Fs.prototype.readInt32BE=function(e,t){return t||aa(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Fs.prototype.readFloatLE=function(e,t){return t||aa(e,4,this.length),Bs(this,e,!0,23,4)},Fs.prototype.readFloatBE=function(e,t){return t||aa(e,4,this.length),Bs(this,e,!1,23,4)},Fs.prototype.readDoubleLE=function(e,t){return t||aa(e,8,this.length),Bs(this,e,!0,52,8)},Fs.prototype.readDoubleBE=function(e,t){return t||aa(e,8,this.length),Bs(this,e,!1,52,8)},Fs.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||ua(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},Fs.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||ua(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},Fs.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,1,255,0),Fs.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Fs.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,2,65535,0),Fs.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ca(this,e,t,!0),t+2},Fs.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,2,65535,0),Fs.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ca(this,e,t,!1),t+2},Fs.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,4,4294967295,0),Fs.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):la(this,e,t,!0),t+4},Fs.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,4,4294967295,0),Fs.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):la(this,e,t,!1),t+4},Fs.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);ua(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},Fs.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);ua(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},Fs.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,1,127,-128),Fs.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Fs.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,2,32767,-32768),Fs.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ca(this,e,t,!0),t+2},Fs.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,2,32767,-32768),Fs.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ca(this,e,t,!1),t+2},Fs.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,4,2147483647,-2147483648),Fs.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):la(this,e,t,!0),t+4},Fs.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||ua(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Fs.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):la(this,e,t,!1),t+4},Fs.prototype.writeFloatLE=function(e,t,n){return ha(this,e,t,!0,n)},Fs.prototype.writeFloatBE=function(e,t,n){return ha(this,e,t,!1,n)},Fs.prototype.writeDoubleLE=function(e,t,n){return da(this,e,t,!0,n)},Fs.prototype.writeDoubleBE=function(e,t,n){return da(this,e,t,!1,n)},Fs.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!Fs.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},Fs.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Fs.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=zs(e)?e:va(new Fs(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var pa=/[^+\/0-9A-Za-z-_]/g;function ga(e){return e<16?"0"+e.toString(16):e.toString(16)}function va(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function ya(e){return function(e){var t,n,r,i,o,s;Ss||xs();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new Os(3*a/4-o),r=o>0?a-4:a;var u=0;for(t=0,n=0;t<r;t+=4,n+=3)i=Es[e.charCodeAt(t)]<<18|Es[e.charCodeAt(t+1)]<<12|Es[e.charCodeAt(t+2)]<<6|Es[e.charCodeAt(t+3)],s[u++]=i>>16&255,s[u++]=i>>8&255,s[u++]=255&i;return 2===o?(i=Es[e.charCodeAt(t)]<<2|Es[e.charCodeAt(t+1)]>>4,s[u++]=255&i):1===o&&(i=Es[e.charCodeAt(t)]<<10|Es[e.charCodeAt(t+1)]<<4|Es[e.charCodeAt(t+2)]>>2,s[u++]=i>>8&255,s[u++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(pa,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function ma(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function ba(e){return null!=e&&(!!e._isBuffer||wa(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&wa(e.slice(0,0))}(e))}function wa(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var _a={}.toString,Ca=Array.isArray||function(e){return"[object Array]"==_a.call(e)},ka=Object.prototype.toString,Aa="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ka.call(Blob),Ea="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ka.call(File),Oa=function e(t){if(!t||"object"!=typeof t)return!1;if(Ca(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if(ba&&ba(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||Aa&&t instanceof Blob||Ea&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e(t[i]))return!0;return!1};var Sa=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)o[a]=i[s];return o.buffer},xa=function(e,t,n){var r=!1;return n=n||Ia,i.count=e,0===e?t():i;function i(e,o){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(r=!0,t(e),t=n):0!==i.count||r||t(null,o)}};function Ia(){}var Ta=I(function(e,t){!function(n){var r=t,i=e&&e.exports==r&&e,o="object"==typeof S&&S;o.global!==o&&o.window!==o||(n=o);var s,a,u,c=String.fromCharCode;function l(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function f(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function h(e,t){return c(e>>t&63|128)}function d(e,t){if(0==(4294967168&e))return c(e);var n="";return 0==(4294965248&e)?n=c(e>>6&31|192):0==(4294901760&e)?(f(e,t)||(e=65533),n=c(e>>12&15|224),n+=h(e,6)):0==(4292870144&e)&&(n=c(e>>18&7|240),n+=h(e,12),n+=h(e,6)),n+=c(63&e|128)}function p(){if(u>=a)throw Error("Invalid byte index");var e=255&s[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function g(e){var t,n;if(u>a)throw Error("Invalid byte index");if(u==a)return!1;if(t=255&s[u],u++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|p())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|p()<<6|p())>=2048)return f(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|p()<<12|p()<<6|p())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var v={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=l(e),i=r.length,o=-1,s="";++o<i;)s+=d(r[o],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;s=l(e),a=s.length,u=0;for(var r,i=[];!1!==(r=g(n));)i.push(r);return function(e){for(var t,n=e.length,r=-1,i="";++r<n;)(t=e[r])>65535&&(i+=c((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=c(t);return i}(i)}};if(r&&!r.nodeType)if(i)i.exports=v;else{var y={}.hasOwnProperty;for(var m in v)y.call(v,m)&&(r[m]=v[m])}else n.utf8=v}(S)}),Ba=I(function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,i,o,s,a=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var l=new ArrayBuffer(a),f=new Uint8Array(l);for(t=0;t<u;t+=4)r=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],f[c++]=r<<2|i>>4,f[c++]=(15&i)<<4|o>>2,f[c++]=(3&o)<<6|63&s;return l}}()}),Pa=(Ba.encode,Ba.decode,S.BlobBuilder||S.WebKitBlobBuilder||S.MSBlobBuilder||S.MozBlobBuilder),ja=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),Ra=ja&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),Da=Pa&&Pa.prototype.append&&Pa.prototype.getBlob;function qa(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function Fa(e,t){t=t||{};var n=new Pa;qa(e);for(var r=0;r<e.length;r++)n.append(e[r]);return t.type?n.getBlob(t.type):n.getBlob()}function La(e,t){return qa(e),new Blob(e,t||{})}var Na=ja?Ra?S.Blob:La:Da?Fa:void 0,Ma=I(function(e,t){var n;S&&S.ArrayBuffer&&(n=Ba);var r="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),i="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),o=r||i;t.protocol=3;var s=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},a=ks(s),u={type:"error",data:"parser error"};function c(e,t,n){for(var r=new Array(e.length),i=xa(e.length,n),o=function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})},s=0;s<e.length;s++)o(s,e[s],i)}t.encodePacket=function(e,n,r,i){"function"==typeof n&&(i=n,n=!1),"function"==typeof r&&(i=r,r=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if(S.ArrayBuffer&&a instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=s[e.type];for(var u=0;u<o.length;u++)a[u+1]=o[u];return r(a.buffer)}(e,n,i);if(Na&&a instanceof S.Blob)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(o)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,n,!0,r)},i.readAsArrayBuffer(e.data)}(e,n,r);var i=new Uint8Array(1);i[0]=s[e.type];var a=new Na([i.buffer,e.data]);return r(a)}(e,n,i);if(a&&a.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,i);var u=s[e.type];return void 0!==e.data&&(u+=r?Ta.encode(String(e.data),{strict:!1}):String(e.data)),i(""+u)},t.encodeBase64Packet=function(e,n){var r,i="b"+t.packets[e.type];if(Na&&e.data instanceof S.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];n(i+e)},o.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),u=0;u<s.length;u++)a[u]=s[u];r=String.fromCharCode.apply(null,a)}return i+=S.btoa(r),n(i)},t.decodePacket=function(e,n,r){if(void 0===e)return u;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=Ta.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return u;var i=e.charAt(0);return Number(i)==i&&a[i]?e.length>1?{type:a[i],data:e.substring(1)}:{type:a[i]}:u}i=new Uint8Array(e)[0];var o=Sa(e,1);return Na&&"blob"===n&&(o=new Na([o])),{type:a[i],data:o}},t.decodeBase64Packet=function(e,t){var r=a[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=n.decode(e.substr(1));return"blob"===t&&Na&&(i=new Na([i])),{type:r,data:i}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var i=Oa(e);if(n&&i)return Na&&!o?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");c(e,function(e,r){t.encodePacket(e,!!i&&n,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===e)return r(u,0,1);for(var o,s,a="",c=0,l=e.length;c<l;c++){var f=e.charAt(c);if(":"===f){if(""===a||a!=(o=Number(a)))return r(u,0,1);if(a!=(s=e.substr(c+1,o)).length)return r(u,0,1);if(s.length){if(i=t.decodePacket(s,n,!1),u.type===i.type&&u.data===i.data)return r(u,0,1);if(!1===r(i,c+o,l))return}c+=o,a=""}else a+=f}return""!==a?r(u,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));c(e,function(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})},function(e,t){var r=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),i=new Uint8Array(r),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}i[o++]=t?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(r=new Uint8Array(n),s=0;s<r.length;s++)i[o++]=r[s]}),n(i.buffer)})},t.encodePayloadAsBlob=function(e,n){c(e,function(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,Na){var a=new Na([t.buffer,s.buffer,e]);n(null,a)}})},function(e,t){return n(new Na(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var s=new Uint8Array(i),a=0===s[0],c="",l=1;255!==s[l];l++){if(c.length>310)return r(u,0,1);c+=s[l]}i=Sa(i,2+c.length),c=parseInt(c);var f=Sa(i,0,c);if(a)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(e){var h=new Uint8Array(f);f="";for(l=0;l<h.length;l++)f+=String.fromCharCode(h[l])}o.push(f),i=Sa(i,c)}var d=o.length;o.forEach(function(e,i){r(t.decodePacket(e,n,!0),i,d)})}}),Ua=(Ma.protocol,Ma.packets,Ma.encodePacket,Ma.encodeBase64Packet,Ma.decodePacket,Ma.decodeBase64Packet,Ma.encodePayload,Ma.decodePayload,Ma.encodePayloadAsArrayBuffer,Ma.encodePayloadAsBlob,Ma.decodePayloadAsBinary,$a);function $a(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}cs($a.prototype),$a.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},$a.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},$a.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},$a.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},$a.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},$a.prototype.onData=function(e){var t=Ma.decodePacket(e,this.socket.binaryType);this.onPacket(t)},$a.prototype.onPacket=function(e){this.emit("packet",e)},$a.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var za,Ya={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},Ja=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Ha="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Va=64,Wa={},Ka=0,Ga=0;function Xa(e){var t="";do{t=Ha[e%Va]+t,e=Math.floor(e/Va)}while(e>0);return t}function Qa(){var e=Xa(+new Date);return e!==za?(Ka=0,za=e):e+"."+Xa(Ka++)}for(;Ga<Va;Ga++)Wa[Ha[Ga]]=Ga;Qa.encode=Xa,Qa.decode=function(e){var t=0;for(Ga=0;Ga<e.length;Ga++)t=t*Va+Wa[e.charAt(Ga)];return t};var Za=Qa,eu=I(function(e,t){function n(e){var n;function i(){if(i.enabled){var e=i,r=+new Date,o=r-(n||r);e.diff=o,e.prev=n,e.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=s[u];n=i.call(e,o),s.splice(u,1),u--}return n}),t.formatArgs.call(e,s),(i.log||t.log||void 0).apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),i.destroy=r,"function"==typeof t.init&&t.init(i),t.instances.push(i),i}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Oo,t.instances=[],t.names=[],t.skips=[],t.formatters={}}),tu=(eu.coerce,eu.disable,eu.enable,eu.enabled,eu.humanize,eu.instances,eu.names,eu.skips,eu.formatters,I(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==A&&"env"in A&&(e=A.env.DEBUG),e}(t=e.exports=eu).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())})),nu=(tu.log,tu.formatArgs,tu.save,tu.load,tu.useColors,tu.storage,tu.colors,tu("engine.io-client:polling")),ru=ou,iu=null!=new Cs({xdomain:!1}).responseType;function ou(e){var t=e&&e.forceBase64;iu&&!t||(this.supportsBinary=!1),Ua.call(this,e)}Ja(ou,Ua),ou.prototype.name="polling",ou.prototype.doOpen=function(){this.poll()},ou.prototype.pause=function(e){var t=this;function n(){nu("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(nu("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){nu("pre-pause polling complete"),--r||n()})),this.writable||(nu("we are currently writing - waiting to pause"),r++,this.once("drain",function(){nu("pre-pause writing complete"),--r||n()}))}else n()},ou.prototype.poll=function(){nu("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},ou.prototype.onData=function(e){var t=this;nu("polling got data %s",e);Ma.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():nu('ignoring poll - transport state "%s"',this.readyState))},ou.prototype.doClose=function(){var e=this;function t(){nu("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(nu("transport open - closing"),t()):(nu("transport not open - deferring close"),this.once("open",t))},ou.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};Ma.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},ou.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=Za()),this.supportsBinary||e.sid||(e.b64=1),e=Ya.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var su=tu("engine.io-client:polling-xhr"),au=lu,uu=fu;function cu(){}function lu(e){if(ru.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,S.location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!==S.location.hostname||n!==e.port,this.xs=e.secure!==t}}function fu(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function hu(){for(var e in fu.requests)fu.requests.hasOwnProperty(e)&&fu.requests[e].abort()}Ja(lu,ru),lu.prototype.supportsBinary=!0,lu.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new fu(e)},lu.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},lu.prototype.doPoll=function(){su("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},cs(fu.prototype),fu.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new Cs(e),n=this;try{su("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},su("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}S.document&&(this.index=fu.requestsCount++,fu.requests[this.index]=this)},fu.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},fu.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},fu.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},fu.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=cu:this.xhr.onreadystatechange=cu,e)try{this.xhr.abort()}catch(e){}S.document&&delete fu.requests[this.index],this.xhr=null}},fu.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},fu.prototype.hasXDR=function(){return void 0!==S.XDomainRequest&&!this.xs&&this.enablesXDR},fu.prototype.abort=function(){this.cleanup()},fu.requestsCount=0,fu.requests={},S.document&&(S.attachEvent?S.attachEvent("onunload",hu):S.addEventListener&&S.addEventListener("beforeunload",hu,!1)),au.Request=uu;var du,pu=mu,gu=/\n/g,vu=/\\n/g;function yu(){}function mu(e){ru.call(this,e),this.query=this.query||{},du||(S.___eio||(S.___eio=[]),du=S.___eio),this.index=du.length;var t=this;du.push(function(e){t.onData(e)}),this.query.j=this.index,S.document&&S.addEventListener&&S.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=yu)},!1)}Ja(mu,ru),mu.prototype.supportsBinary=!1,mu.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),ru.prototype.doClose.call(this)},mu.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},mu.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,i=document.createElement("form"),o=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=s,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function a(){u(),t()}function u(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),u(),e=e.replace(vu,"\\\n"),this.area.value=e.replace(gu,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};var bu,wu={},_u=Object.freeze({default:wu}),Cu=_u&&wu||_u,ku=tu("engine.io-client:websocket"),Au=S.WebSocket||S.MozWebSocket;if("undefined"==typeof window)try{bu=Cu}catch(e){}var Eu=Au;Eu||"undefined"!=typeof window||(Eu=bu);var Ou=Su;function Su(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=Au&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(Eu=bu),Ua.call(this,e)}Ja(Su,Ua),Su.prototype.name="websocket",Su.prototype.supportsBinary=!0,Su.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new Eu(e,t):new Eu(e):new Eu(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Su.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Su.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,i=n;r<i;r++)!function(e){Ma.encodePacket(e,t.supportsBinary,function(r){if(!t.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),t.perMessageDeflate)("string"==typeof r?S.Buffer.byteLength(r):r.length)<t.perMessageDeflate.threshold&&(i.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,i)}catch(e){ku("websocket closed before onclose event")}--n||o()})}(e[r]);function o(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},Su.prototype.onClose=function(){Ua.prototype.onClose.call(this)},Su.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},Su.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=Za()),this.supportsBinary||(e.b64=1),(e=Ya.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},Su.prototype.check=function(){return!(!Eu||"__initialize"in Eu&&this.name===Su.prototype.name)};var xu={polling:function(e){var t=!1,n=!1,r=!1!==e.jsonp;if(S.location){var i="https:"===location.protocol,o=location.port;o||(o=i?443:80),t=e.hostname!==location.hostname||o!==e.port,n=e.secure!==i}if(e.xdomain=t,e.xscheme=n,"open"in new Cs(e)&&!e.forceJSONP)return new au(e);if(!r)throw new Error("JSONP disabled");return new pu(e)},websocket:Ou},Iu=[].indexOf,Tu=function(e,t){if(Iu)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Bu=tu("engine.io-client:socket"),Pu=ju;function ju(e,t){if(!(this instanceof ju))return new ju(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=ns(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=ns(t.host).host),this.secure=null!=t.secure?t.secure:S.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(S.location?location.hostname:"localhost"),this.port=t.port||(S.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=Ya.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var n="object"==typeof S&&S;n.global===n&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}ju.priorWebsocketSuccess=!1,cs(ju.prototype),ju.protocol=Ma.protocol,ju.Socket=ju,ju.Transport=Ua,ju.transports=xu,ju.parser=Ma,ju.prototype.createTransport=function(e){Bu('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=Ma.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new xu[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},ju.prototype.open=function(){var e;if(this.rememberUpgrade&&ju.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},ju.prototype.setTransport=function(e){Bu("setting transport %s",e.name);var t=this;this.transport&&(Bu("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},ju.prototype.probe=function(e){Bu('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(Bu('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(Bu('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;ju.priorWebsocketSuccess="websocket"===t.name,Bu('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(Bu("changing transport and sending upgrade packet"),l(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{Bu('probe transport "%s" failed',e);var o=new Error("probe error");o.transport=t.name,r.emit("upgradeError",o)}}))}function o(){n||(n=!0,l(),t.close(),t=null)}function s(n){var i=new Error("probe error: "+n);i.transport=t.name,o(),Bu('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",i)}function a(){s("transport closed")}function u(){s("socket closed")}function c(e){t&&e.name!==t.name&&(Bu('"%s" works - aborting "%s"',e.name,t.name),o())}function l(){t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),r.removeListener("close",u),r.removeListener("upgrading",c)}ju.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",u),this.once("upgrading",c),t.open()},ju.prototype.onOpen=function(){if(Bu("socket open"),this.readyState="open",ju.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Bu("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},ju.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Bu('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Bu('packet received with socket readyState "%s"',this.readyState)},ju.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},ju.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},ju.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){Bu("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},ju.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},ju.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},ju.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Bu("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},ju.prototype.write=ju.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},ju.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},ju.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),Bu("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},ju.prototype.onError=function(e){Bu("socket error %j",e),ju.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},ju.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Bu('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},ju.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~Tu(this.transports,e[n])&&t.push(e[n]);return t};var Ru=Pu,Du=Ma;Ru.parser=Du;var qu=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n};var Fu=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}};var Lu=[].slice,Nu=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=Lu.call(arguments,2);return function(){return t.apply(e,n.concat(Lu.call(arguments)))}},Mu=I(function(e,t){var n=is("socket.io-client:socket");e.exports=o;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},i=cs.prototype.emit;function o(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}cs(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[Fu(e,"open",Nu(this,"onopen")),Fu(e,"packet",Nu(this,"onpacket")),Fu(e,"close",Nu(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},o.prototype.send=function(){var e=qu(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(r.hasOwnProperty(e))return i.apply(this,arguments),this;var t=qu(arguments),o={type:(void 0!==this.flags.binary?this.flags.binary:Oa(t))?ws.BINARY_EVENT:ws.EVENT,data:t,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?Ya.encode(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:ws.CONNECT,query:e})}else this.packet({type:ws.CONNECT})},o.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===ws.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case ws.CONNECT:this.onconnect();break;case ws.EVENT:case ws.BINARY_EVENT:this.onevent(e);break;case ws.ACK:case ws.BINARY_ACK:this.onack(e);break;case ws.DISCONNECT:this.ondisconnect();break;case ws.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?i.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=qu(arguments);n("sending ack %j",i),t.packet({type:Oa(i)?ws.BINARY_ACK:ws.ACK,id:e,data:i})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)i.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:ws.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags.compress=e,this},o.prototype.binary=function(e){return this.flags.binary=e,this}}),Uu=$u;function $u(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}$u.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},$u.prototype.reset=function(){this.attempts=0},$u.prototype.setMin=function(e){this.ms=e},$u.prototype.setMax=function(e){this.max=e},$u.prototype.setJitter=function(e){this.jitter=e};var zu=is("socket.io-client:manager"),Yu=Object.prototype.hasOwnProperty,Ju=Hu;function Hu(e,t){if(!(this instanceof Hu))return new Hu(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new Uu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||ws;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}Hu.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)Yu.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},Hu.prototype.updateSocketIds=function(){for(var e in this.nsps)Yu.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},Hu.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},cs(Hu.prototype),Hu.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},Hu.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},Hu.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},Hu.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},Hu.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},Hu.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},Hu.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Hu.prototype.open=Hu.prototype.connect=function(e,t){if(zu("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;zu("opening %s",this.uri),this.engine=Ru(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=Fu(n,"open",function(){r.onopen(),e&&e()}),o=Fu(n,"error",function(t){if(zu("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;zu("connect attempt will timeout after %d",s);var a=setTimeout(function(){zu("connect attempt timed out after %d",s),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(i),this.subs.push(o),this},Hu.prototype.onopen=function(){zu("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Fu(e,"data",Nu(this,"ondata"))),this.subs.push(Fu(e,"ping",Nu(this,"onping"))),this.subs.push(Fu(e,"pong",Nu(this,"onpong"))),this.subs.push(Fu(e,"error",Nu(this,"onerror"))),this.subs.push(Fu(e,"close",Nu(this,"onclose"))),this.subs.push(Fu(this.decoder,"decoded",Nu(this,"ondecoded")))},Hu.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Hu.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Hu.prototype.ondata=function(e){this.decoder.add(e)},Hu.prototype.ondecoded=function(e){this.emit("packet",e)},Hu.prototype.onerror=function(e){zu("error",e),this.emitAll("error",e)},Hu.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new Mu(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",i),n.on("connect",function(){n.id=r.generateId(e)}),this.autoConnect&&i()}function i(){~Tu(r.connecting,n)||r.connecting.push(n)}return n},Hu.prototype.destroy=function(e){var t=Tu(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},Hu.prototype.packet=function(e){zu("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},Hu.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},Hu.prototype.cleanup=function(){zu("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Hu.prototype.close=Hu.prototype.disconnect=function(){zu("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Hu.prototype.onclose=function(e){zu("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},Hu.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)zu("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();zu("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(zu("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(zu("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(zu("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},Hu.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var Vu=I(function(e,t){var n=is("socket.io-client");e.exports=t=i;var r=t.managers={};function i(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,o=ss(e),s=o.source,a=o.id,u=o.path,c=r[a]&&u in r[a].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||c?(n("ignoring socket cache for %s",s),i=Ju(s,t)):(r[a]||(n("new io instance for %s",s),r[a]=Ju(s,t)),i=r[a]),o.query&&!t.query&&(t.query=o.query),i.socket(o.path,t)}t.protocol=ws.protocol,t.connect=i,t.Manager=Ju,t.Socket=Mu});Vu.managers,Vu.protocol,Vu.connect,Vu.Manager,Vu.Socket;const Wu={binaryStringToBlobOrBuffer:ao,readAsBinaryString:uo,binaryStringToArrayBuffer:so,blobOrBufferToBinaryString:co,blobOrBufferToBase64:function(e,t){co(e,function(e){t(oo(e))})},base64StringToBlobOrBuffer:function(e,t){return ao(io(e),t)}};export{Wu as binUtils,Xt as PouchDB,zi as PouchDBErrors,Mo as extendUsingYArray,Lo as extendUsingYMap,qo as extendUsingYMemory,Zo as extendUsingYText,Bo as Y,yo as adapterFun,go as clone,U as EventEmitter,Vu as SocketIO};